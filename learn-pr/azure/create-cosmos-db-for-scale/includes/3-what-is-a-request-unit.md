<span data-ttu-id="dc481-101">A questo punto è opportuno prendere in considerazione i dati per il database in questione.</span><span class="sxs-lookup"><span data-stu-id="dc481-101">Next, let's consider the data for your database.</span></span> <span data-ttu-id="dc481-102">Una velocità effettiva adeguata è importante assicurarsi di poter gestire il volume delle transazioni per le esigenze aziendali.</span><span class="sxs-lookup"><span data-stu-id="dc481-102">Adequate throughput is important to ensure you can handle the volume of transactions for your business needs.</span></span> <span data-ttu-id="dc481-103">I requisiti relativi alla velocità effettiva non sono sempre uniformi.</span><span class="sxs-lookup"><span data-stu-id="dc481-103">Throughput requirements aren't always consistent.</span></span> <span data-ttu-id="dc481-104">Si consideri ad esempio un sito Web per gli acquisti, che deve essere ridimensionato durante il periodo dei saldi o delle festività natalizie.</span><span class="sxs-lookup"><span data-stu-id="dc481-104">For example, you may be building a shopping website that needs to scale during sales or holidays.</span></span> <span data-ttu-id="dc481-105">Per iniziare, verranno presentate le unità richiesta e si apprenderà come stimare i requisiti di velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="dc481-105">We'll start by learning about request units and how to estimate throughput requirements.</span></span>

## <a name="what-is-database-throughput"></a><span data-ttu-id="dc481-106">Che cos'è la velocità effettiva del database?</span><span class="sxs-lookup"><span data-stu-id="dc481-106">What is database throughput?</span></span> 

<span data-ttu-id="dc481-107">La velocità effettiva del database è il numero di operazioni di lettura e scrittura che il database può eseguire in un secondo.</span><span class="sxs-lookup"><span data-stu-id="dc481-107">Database throughput is the number of reads and writes that your database can perform in a single second.</span></span>

<span data-ttu-id="dc481-108">Per ridimensionare la velocità effettiva in modo strategico, è necessario stimare la velocità effettiva necessaria valutando il numero di operazioni di lettura e scrittura da supportare in momenti diversi e per documenti con diverse dimensioni.</span><span class="sxs-lookup"><span data-stu-id="dc481-108">To scale throughput strategically, you need to estimate your throughput needs by estimating the number of reads and writes you'll have to support at different times and for different document sizes.</span></span> <span data-ttu-id="dc481-109">Una stima corretta contribuisce a non deludere gli utenti nei momenti di picco della domanda.</span><span class="sxs-lookup"><span data-stu-id="dc481-109">If you estimate correctly, you'll keep your users happy when demand spikes.</span></span> <span data-ttu-id="dc481-110">Una stima non accurata può invece limitare la velocità delle richieste, causando operazioni in attesa e tentativi ripetuti e conseguenti latenze elevate e clienti insoddisfatti.</span><span class="sxs-lookup"><span data-stu-id="dc481-110">If you estimate incorrectly, your requests can get rate-limited and operations will have to wait and retry, likely causing high latency and unhappy customers.</span></span>

## <a name="what-is-a-request-unit"></a><span data-ttu-id="dc481-111">Cos'è un'unità richiesta?</span><span class="sxs-lookup"><span data-stu-id="dc481-111">What is a request unit?</span></span>

<span data-ttu-id="dc481-112">Azure Cosmos DB misura la velocità effettiva usando l'**unità richiesta (UR)**.</span><span class="sxs-lookup"><span data-stu-id="dc481-112">Azure Cosmos DB measures throughput using something called a **request unit (RU)**.</span></span> <span data-ttu-id="dc481-113">L'utilizzo delle unità richiesta è misurato al secondo, pertanto l'unità di misura è l'**unità richiesta al secondo (UR/sec)**.</span><span class="sxs-lookup"><span data-stu-id="dc481-113">Request unit usage is measured per second, so the unit of measure is **request units per second (RU/s)**.</span></span> <span data-ttu-id="dc481-114">È necessario prevedere in anticipo il numero di UR/sec di cui Azure Cosmos DB dovrà eseguire il provisioning, in modo che la soluzione possa gestire il carico stimato e aumentare o diminuire le UR/sec in qualsiasi momento per soddisfare la domanda corrente.</span><span class="sxs-lookup"><span data-stu-id="dc481-114">You must reserve the number of RU/s you want Azure Cosmos DB to provision in advance, so it can handle the load you've estimated, and you can scale your RU/s up or down at any time to meet current demand.</span></span>

## <a name="request-unit-basics"></a><span data-ttu-id="dc481-115">Nozioni di base sulle unità richiesta</span><span class="sxs-lookup"><span data-stu-id="dc481-115">Request unit basics</span></span>

<span data-ttu-id="dc481-116">Una singola unità richiesta, ovvero 1 UR, equivale al costo approssimativo dell'esecuzione di una singola richiesta GET su un documento di 1 KB usando l'ID del documento.</span><span class="sxs-lookup"><span data-stu-id="dc481-116">A single request unit, 1 RU, is equal to the approximate cost of performing a single GET request on a 1-KB document using a document's ID.</span></span> <span data-ttu-id="dc481-117">L'esecuzione di una richiesta GET con l'ID di un documento è un metodo efficiente per recuperare un documento e implica un costo contenuto.</span><span class="sxs-lookup"><span data-stu-id="dc481-117">Performing a GET by using a document's ID is an efficient means for retrieving a document, and thus the cost is small.</span></span> <span data-ttu-id="dc481-118">Una richiesta di creazione, sostituzione o eliminazione dello stesso elemento usa più capacità di elaborazione del servizio e quindi richiede più unità richiesta.</span><span class="sxs-lookup"><span data-stu-id="dc481-118">Creating, replacing, or deleting the same item requires additional processing by the service, and therefore requires more request units.</span></span>

<span data-ttu-id="dc481-119">Il numero di unità richiesta impiegato per un'operazione varia in funzione delle dimensioni e del numero di proprietà del documento, dell'operazione eseguita e di altri concetti complessi come la coerenza e i criteri di indicizzazione.</span><span class="sxs-lookup"><span data-stu-id="dc481-119">The number of request units used for an operation changes depending on the document size, the number of properties in the document, the operation being performed, and some additional complex concepts such as consistency and indexing policy.</span></span>

<span data-ttu-id="dc481-120">La tabella riportata di seguito mostra il numero di unità richiesta per elementi con tre dimensioni diverse, ovvero 1 KB, 4 KB e 64 KB, e due livelli di prestazioni diversi, ovvero 500 letture al secondo + 100 scritture al secondo e 500 letture al secondo + 500 scritture al secondo.</span><span class="sxs-lookup"><span data-stu-id="dc481-120">The following table shows the number of request units required for items of three different sizes (1 KB, 4 KB, and 64 KB) and at two different performance levels (500 reads/second + 100 writes/second and 500 reads/second + 500 writes/second).</span></span> <span data-ttu-id="dc481-121">In questo esempio la coerenza dei dati è impostata su **Sessione** e i criteri di indicizzazione sono impostati su **Nessuno**.</span><span class="sxs-lookup"><span data-stu-id="dc481-121">In this example, the data consistency is set to **Session**, and the indexing policy is set to **None**.</span></span>

| <span data-ttu-id="dc481-122">Dimensioni dell'elemento</span><span class="sxs-lookup"><span data-stu-id="dc481-122">Item size</span></span> | <span data-ttu-id="dc481-123">Letture al secondo</span><span class="sxs-lookup"><span data-stu-id="dc481-123">Reads/second</span></span> | <span data-ttu-id="dc481-124">Scritture al secondo</span><span class="sxs-lookup"><span data-stu-id="dc481-124">Writes/second</span></span> | <span data-ttu-id="dc481-125">Unità richiesta</span><span class="sxs-lookup"><span data-stu-id="dc481-125">Request units</span></span>
| --- | --- | --- | --- |
| <span data-ttu-id="dc481-126">1 KB</span><span class="sxs-lookup"><span data-stu-id="dc481-126">1 KB</span></span> | <span data-ttu-id="dc481-127">500</span><span class="sxs-lookup"><span data-stu-id="dc481-127">500</span></span> | <span data-ttu-id="dc481-128">100</span><span class="sxs-lookup"><span data-stu-id="dc481-128">100</span></span> | <span data-ttu-id="dc481-129">(500 \* 1) + (100 \* 5) = 1.000 UR/sec</span><span class="sxs-lookup"><span data-stu-id="dc481-129">(500 \* 1) + (100 \* 5) = 1,000 RU/s</span></span>
| <span data-ttu-id="dc481-130">1 KB</span><span class="sxs-lookup"><span data-stu-id="dc481-130">1 KB</span></span> | <span data-ttu-id="dc481-131">500</span><span class="sxs-lookup"><span data-stu-id="dc481-131">500</span></span> | <span data-ttu-id="dc481-132">500</span><span class="sxs-lookup"><span data-stu-id="dc481-132">500</span></span> | <span data-ttu-id="dc481-133">(500 \* 1) + (500 \* 5) = 3.000 UR/sec</span><span class="sxs-lookup"><span data-stu-id="dc481-133">(500 \* 1) + (500 \* 5) = 3,000 RU/s</span></span>
| <span data-ttu-id="dc481-134">4 KB</span><span class="sxs-lookup"><span data-stu-id="dc481-134">4 KB</span></span> | <span data-ttu-id="dc481-135">500</span><span class="sxs-lookup"><span data-stu-id="dc481-135">500</span></span> | <span data-ttu-id="dc481-136">100</span><span class="sxs-lookup"><span data-stu-id="dc481-136">100</span></span> | <span data-ttu-id="dc481-137">(500 \* 1,3) + (100 \* 7) = 1.350 UR/sec</span><span class="sxs-lookup"><span data-stu-id="dc481-137">(500 \* 1.3) + (100 \* 7) = 1,350 RU/s</span></span>
| <span data-ttu-id="dc481-138">4 KB</span><span class="sxs-lookup"><span data-stu-id="dc481-138">4 KB</span></span> | <span data-ttu-id="dc481-139">500</span><span class="sxs-lookup"><span data-stu-id="dc481-139">500</span></span> | <span data-ttu-id="dc481-140">500</span><span class="sxs-lookup"><span data-stu-id="dc481-140">500</span></span> | <span data-ttu-id="dc481-141">(500 \* 1,3) + (500 \* 7) = 4.150 UR/sec</span><span class="sxs-lookup"><span data-stu-id="dc481-141">(500 \* 1.3) + (500 \* 7) = 4,150 RU/s</span></span>
| <span data-ttu-id="dc481-142">64 KB</span><span class="sxs-lookup"><span data-stu-id="dc481-142">64 KB</span></span> | <span data-ttu-id="dc481-143">500</span><span class="sxs-lookup"><span data-stu-id="dc481-143">500</span></span> | <span data-ttu-id="dc481-144">100</span><span class="sxs-lookup"><span data-stu-id="dc481-144">100</span></span> | <span data-ttu-id="dc481-145">(500 \* 10) + (100 \* 48) = 9.800 UR/sec</span><span class="sxs-lookup"><span data-stu-id="dc481-145">(500 \* 10) + (100 \* 48) = 9,800 RU/s</span></span>
| <span data-ttu-id="dc481-146">64 KB</span><span class="sxs-lookup"><span data-stu-id="dc481-146">64 KB</span></span> | <span data-ttu-id="dc481-147">500</span><span class="sxs-lookup"><span data-stu-id="dc481-147">500</span></span> | <span data-ttu-id="dc481-148">500</span><span class="sxs-lookup"><span data-stu-id="dc481-148">500</span></span> | <span data-ttu-id="dc481-149">(500 \* 10) + (500 \* 48) = 29.000 UR/sec</span><span class="sxs-lookup"><span data-stu-id="dc481-149">(500 \* 10) + (500 \* 48) = 29,000 RU/s</span></span>
 
<span data-ttu-id="dc481-150">Come si può notare, maggiori sono le dimensioni dell'elemento, maggiore è il numero di letture e scritture necessarie e delle unità richiesta da riservare.</span><span class="sxs-lookup"><span data-stu-id="dc481-150">As you can see, the larger the item is, and the more reads and writes are required, the more request units you need to reserve.</span></span> <span data-ttu-id="dc481-151">Per stimare le esigenze di velocità effettiva di un'applicazione, è utile [Capacity Planner](https://www.documentdb.com/capacityplanner) di Azure Cosmos DB, uno strumento online che consente di caricare un documento JSON di esempio e stabilire il numero di operazioni da completare al secondo.</span><span class="sxs-lookup"><span data-stu-id="dc481-151">If you need to estimate the throughput needs of an application, the Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) is an online tool that enables you to upload a sample JSON document and set the number of operations you need to complete per second.</span></span> <span data-ttu-id="dc481-152">Lo strumento offre una stima del totale da riservare.</span><span class="sxs-lookup"><span data-stu-id="dc481-152">It then provides an estimated total to reserve.</span></span>

## <a name="exceeding-throughput-limits"></a><span data-ttu-id="dc481-153">Superamento dei limiti di velocità effettiva</span><span class="sxs-lookup"><span data-stu-id="dc481-153">Exceeding throughput limits</span></span>

<span data-ttu-id="dc481-154">Se non viene riservata una quantità sufficiente di unità richiesta e si tenta di leggere o scrivere più dati di quelli consentiti dalla velocità effettiva di cui viene eseguito il provisioning, la velocità della richiesta risulterà limitata.</span><span class="sxs-lookup"><span data-stu-id="dc481-154">If you don’t reserve enough request units, and you attempt to read or write more data than your provisioned throughput allows, your request will be rate-limited.</span></span> <span data-ttu-id="dc481-155">In questo caso, è necessario eseguire un nuovo tentativo di richiesta dopo un intervallo specificato.</span><span class="sxs-lookup"><span data-stu-id="dc481-155">When a request is rate-limited, the request has to be retried again after a specified interval.</span></span> <span data-ttu-id="dc481-156">Se si usa .NET SDK, il tentativo viene eseguito automaticamente dopo l'attesa specificata nell'intestazione retry-after.</span><span class="sxs-lookup"><span data-stu-id="dc481-156">If you use the .NET SDK, the request will be retried automatically after waiting the amount of time specified in the retry-after header.</span></span>

## <a name="creating-an-account-built-to-scale"></a><span data-ttu-id="dc481-157">Creazione di un account per la scalabilità</span><span class="sxs-lookup"><span data-stu-id="dc481-157">Creating an account built to scale</span></span>

<span data-ttu-id="dc481-158">È possibile modificare il numero di unità richiesta di cui viene eseguito il provisioning in un database in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="dc481-158">You can change the number of request units provisioned to a database at any time.</span></span> <span data-ttu-id="dc481-159">Nei periodi di picco è possibile aumentare tale valore per venire incontro alle maggiori esigenze, per poi ridurre la velocità effettiva di cui viene eseguito il provisioning nelle ore non di punta, riducendo di conseguenza i costi.</span><span class="sxs-lookup"><span data-stu-id="dc481-159">So, during heavy volume periods, you can scale up to accommodate those high demands, and then reduce provisioned throughput during off peak times to reduce costs.</span></span>

<span data-ttu-id="dc481-160">Quando si crea un account, nel portale è possibile eseguire il provisioning di un minimo di 400 UR/sec e di un massimo di 250.000 UR/sec.</span><span class="sxs-lookup"><span data-stu-id="dc481-160">When you create an account, you can provision a minimum of 400 RU/s, or a maximum of 250,000 RU/s in the portal.</span></span> <span data-ttu-id="dc481-161">Se la velocità effettiva necessaria è maggiore, compilare un ticket nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="dc481-161">If you need even more throughput, fill out a ticket in the Azure portal.</span></span> <span data-ttu-id="dc481-162">L'impostazione della velocità effettiva iniziale su 1.000 UR/sec è consigliabile per quasi tutti gli account, essendo questo il valore minimo in base al quale il database viene ridimensionato automaticamente nel caso in cui siano necessari più di 10 GB di spazio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="dc481-162">Setting the initial throughput to 1000 RU/s is recommended for almost all accounts, as it is the minimum value in which your database will autoscale should you need more than 10 GB of storage.</span></span> <span data-ttu-id="dc481-163">Se si imposta la velocità effettiva iniziale su un valore inferiore a 1.000 UR/sec, il database non sarà in grado di raggiungere dimensioni superiori ai 10 GB a meno che non venga eseguito un nuovo provisioning del database e fornita una chiave di partizione.</span><span class="sxs-lookup"><span data-stu-id="dc481-163">If you set the initial throughput to any value less than 1000 RU/s, your database will not be able to scale to larger than 10 GB unless you reprovision the database and provide a partition key.</span></span> <span data-ttu-id="dc481-164">Le chiavi di partizione consentono la ricerca rapida dei dati in Azure Cosmos DB e la scalabilità automatica del database quando necessario.</span><span class="sxs-lookup"><span data-stu-id="dc481-164">Partition keys enable quick lookup of data in Azure Cosmos DB and enable it to autoscale your database when needed.</span></span> <span data-ttu-id="dc481-165">Le chiavi di partizione sono illustrate più avanti nel modulo.</span><span class="sxs-lookup"><span data-stu-id="dc481-165">Partition keys are discussed a bit later in the module.</span></span>

## <a name="summary"></a><span data-ttu-id="dc481-166">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="dc481-166">Summary</span></span>

<span data-ttu-id="dc481-167">A questo punto si sa come stimare la velocità effettiva per Azure Cosmos DB e definirne l'ambito tramite unità richiesta, quindi sarà possibile effettuare una selezione appropriata quando si crea una nuova raccolta di Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="dc481-167">You now understand how to estimate and scope throughput for an Azure Cosmos DB using request units, and can make an appropriate selection when creating a new Azure Cosmos DB collection.</span></span> <span data-ttu-id="dc481-168">È possibile modificare le unità richiesta in qualsiasi momento, ma l'impostazione su 1000 UR/sec al momento della creazione dell'account aiuta a garantire la scalabilità del database in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="dc481-168">Request units can be modified at any time, but setting them to 1000 RU/s when you create an account helps ensure your database is ready to scale later.</span></span>