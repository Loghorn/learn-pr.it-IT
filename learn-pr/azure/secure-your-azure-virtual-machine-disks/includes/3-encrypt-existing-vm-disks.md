<span data-ttu-id="18e3f-101">Si supponga che l'azienda abbia deciso di implementare Crittografia dischi di Azure in tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="18e3f-101">Suppose your company has decided to implement Azure Disk Encryption (ADE) across all VMs.</span></span> <span data-ttu-id="18e3f-102">È necessario valutare come implementare la crittografia nei volumi delle macchine virtuali esistenti.</span><span class="sxs-lookup"><span data-stu-id="18e3f-102">You need to evaluate how to roll out encryption to existing VM volumes.</span></span>

<span data-ttu-id="18e3f-103">In questo modulo si esamineranno i requisiti per Crittografia dischi di Azure e i passaggi necessari per la crittografia dei dischi nelle macchine virtuali Windows esistenti.</span><span class="sxs-lookup"><span data-stu-id="18e3f-103">Here, we'll look at the requirements for ADE, and the steps involved in encrypting disks on existing Windows VMs.</span></span>

## <a name="azure-disk-encryption-prerequisites"></a><span data-ttu-id="18e3f-104">Prerequisiti di Crittografia dischi di Azure</span><span class="sxs-lookup"><span data-stu-id="18e3f-104">Azure Disk Encryption prerequisites</span></span>

<span data-ttu-id="18e3f-105">Per poter crittografare il primo disco di una macchina virtuale è necessario:</span><span class="sxs-lookup"><span data-stu-id="18e3f-105">Before you can encrypt your first VM disk, you need to:</span></span>

1. <span data-ttu-id="18e3f-106">Creare un insieme di credenziali delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="18e3f-106">Create a key vault.</span></span>
1. <span data-ttu-id="18e3f-107">Configurare oggetti applicazione e oggetti entità servizio in Azure Active Directory (Azure AD)</span><span class="sxs-lookup"><span data-stu-id="18e3f-107">Set up an Azure Active Directory (Azure AD) application and service principal.</span></span>
1. <span data-ttu-id="18e3f-108">Configurare i criteri di accesso all'insieme di credenziali delle chiavi per l'app Azure AD.</span><span class="sxs-lookup"><span data-stu-id="18e3f-108">Set the key vault access policy for the Azure AD app.</span></span>
1. <span data-ttu-id="18e3f-109">Impostare i criteri di accesso avanzati all'insieme di credenziali delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="18e3f-109">Set key vault advanced access policies.</span></span>

### <a name="azure-key-vault"></a><span data-ttu-id="18e3f-110">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="18e3f-110">Azure Key Vault</span></span>

<span data-ttu-id="18e3f-111">Le chiavi di crittografia usate da Crittografia dischi di Azure possono essere archiviate in Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="18e3f-111">The encryption keys used by ADE can be stored in Azure Key Vault.</span></span> <span data-ttu-id="18e3f-112">Azure Key Vault è uno strumento che consente di archiviare i segreti e di accedervi in modo sicuro.</span><span class="sxs-lookup"><span data-stu-id="18e3f-112">Azure Key Vault is a tool for securely storing and accessing secrets.</span></span> <span data-ttu-id="18e3f-113">Un segreto è qualsiasi elemento per cui si vuole controllare rigorosamente l'accesso, ad esempio chiavi API, password o certificati.</span><span class="sxs-lookup"><span data-stu-id="18e3f-113">A secret is anything that you want to tightly control access to, such as API keys, passwords, or certificates.</span></span> <span data-ttu-id="18e3f-114">Questa soluzione garantisce archiviazione sicura, scalabile e a disponibilità elevata in moduli di protezione hardware conformi a FIPS (Federal Information Processing Standards) 140-2, livello 2.</span><span class="sxs-lookup"><span data-stu-id="18e3f-114">This provides highly available and scalable secure storage, in Federal Information Processing Standards (FIPS) 140-2 Level 2 validated Hardware Security Modules (HSMs).</span></span> <span data-ttu-id="18e3f-115">Con Key Vault è possibile avere il controllo completo delle chiavi usate per crittografare i dati e gestire e controllare l'uso delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="18e3f-115">Using Key Vault, you keep full control of the keys used to encrypt your data, and you can manage and audit your key usage.</span></span> <span data-ttu-id="18e3f-116">È possibile configurare e gestire un insieme di credenziali delle chiavi usando il portale di Azure, Azure PowerShell e l'interfaccia della riga di comando di Azure.</span><span class="sxs-lookup"><span data-stu-id="18e3f-116">You can configure and manage your key vault using the Azure portal, Azure PowerShell, and the Azure CLI.</span></span>

>[!NOTE]
> <span data-ttu-id="18e3f-117">Per Crittografia dischi di Azure è necessario che l'istanza dell'insieme di credenziali delle chiavi e le macchine virtuali si trovino nella stessa area di Azure, in modo che i segreti di crittografia non debbano attraversare confini a livello di area.</span><span class="sxs-lookup"><span data-stu-id="18e3f-117">Azure Disk Encryption requires that your key vault and your VMs are in the same Azure region; this ensures that encryption secrets do not cross regional boundaries.</span></span>

### <a name="azure-ad-application-and-service-principal"></a><span data-ttu-id="18e3f-118">Applicazione Azure AD ed entità servizio</span><span class="sxs-lookup"><span data-stu-id="18e3f-118">Azure AD application and service principal</span></span>

<span data-ttu-id="18e3f-119">Per accedere alle risorse o modificarle, ad esempio per configurare la crittografia per una macchina virtuale con script o codice, è prima necessario configurare un'**applicazione Azure Active Directory (AD)**.</span><span class="sxs-lookup"><span data-stu-id="18e3f-119">To access or modify resources, such as the encryption configuration for a VM with scripts or code, you must first set up an **Azure Active Directory (AD) application**.</span></span> <span data-ttu-id="18e3f-120">Azure AD è un servizio di gestione di identità e directory multi-tenant basato sul cloud.</span><span class="sxs-lookup"><span data-stu-id="18e3f-120">Azure AD is a multi-tenant, cloud-based directory, and identity management service.</span></span> <span data-ttu-id="18e3f-121">Combina servizi directory di base, gestione dell'accesso alle applicazioni e protezione delle identità in un'unica soluzione.</span><span class="sxs-lookup"><span data-stu-id="18e3f-121">It combines core directory services, application access management, and identity protection into a single solution.</span></span>

<span data-ttu-id="18e3f-122">È necessaria anche un'**entità servizio** di Azure.</span><span class="sxs-lookup"><span data-stu-id="18e3f-122">You'll also need an Azure **service principal**.</span></span> <span data-ttu-id="18e3f-123">Le entità servizio sono gli account del servizio usati per eseguire lo script o il codice.</span><span class="sxs-lookup"><span data-stu-id="18e3f-123">Service principals are the service accounts you use to run the script or code.</span></span> <span data-ttu-id="18e3f-124">Consentono di assegnare le autorizzazioni specifiche e l'ambito necessari per eseguire l'attività su una risorsa di Azure specifica.</span><span class="sxs-lookup"><span data-stu-id="18e3f-124">They allow you to assign the specific permissions and scope that are needed to run the task against a particular Azure resource.</span></span>

<span data-ttu-id="18e3f-125">In Azure AD sono presenti due elementi: l'oggetto applicazione è la **_definizione_** dell'applicazione (la sua funzione) e l'entità servizio è l'**_istanza specifica_** dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="18e3f-125">There are two elements in Azure AD: the application object is the **_definition_** of the application (what it does), and the service principal is the **_specific instance_** of the application.</span></span>

<span data-ttu-id="18e3f-126">Questo approccio è in linea con il principio dei **privilegi minimi**, in base a cui le autorizzazioni assegnate all'app sono limitate al minimo richiesto per consentire all'app di svolgere le attività previste.</span><span class="sxs-lookup"><span data-stu-id="18e3f-126">This approach aligns with the principle of **least privilege**, where the permissions assigned to the app are restricted to the bare minimum required to enable the app to perform its tasks.</span></span>

<span data-ttu-id="18e3f-127">È possibile configurare e gestire entità servizio e applicazioni Azure AD usando il portale di Azure, Azure PowerShell e l'interfaccia della riga di comando di Azure.</span><span class="sxs-lookup"><span data-stu-id="18e3f-127">You can configure and manage Azure AD applications and service principals using the Azure portal, Azure PowerShell, and the Azure CLI.</span></span>

### <a name="key-vault-access-policies"></a><span data-ttu-id="18e3f-128">Criteri di accesso per gli insiemi di credenziali delle chiavi</span><span class="sxs-lookup"><span data-stu-id="18e3f-128">Key vault access policies</span></span>

<span data-ttu-id="18e3f-129">Per poter archiviare le chiavi di crittografia in un insieme di credenziali delle chiavi, Crittografia dischi di Azure richiede le informazioni relative aPer poter archiviare le chiavi di crittografia in un insieme di credenziali delle chiavi, Crittografia dischi di Azure richiede le informazioni relative agli elementi **ID client** e **Segreto client** dell'applicazione Azure AD che ha le autorizzazioni per scrivere in Key Vault.</span><span class="sxs-lookup"><span data-stu-id="18e3f-129">Before you can store encryption keys in a key vault, ADE requires details on the **Client ID** and the **Client Secret** of the Azure AD application that is permitted to write to the key vault.</span></span>

<span data-ttu-id="18e3f-130">È anche necessario consentire ad Azure l'accesso alle chiavi di crittografia nell'insieme di credenziali delle chiavi, in modo che vengano rese disponibili alla macchina virtuale per l'avvio e la decrittografia dei volumi.</span><span class="sxs-lookup"><span data-stu-id="18e3f-130">You'll also need to provide Azure access to the encryption keys in your key vault, so they are made available to the VM for booting and decrypting the volumes.</span></span>

## <a name="set-key-vault-advanced-access-policies"></a><span data-ttu-id="18e3f-131">Impostare i criteri di accesso avanzati per l'insieme di credenziali delle chiavi</span><span class="sxs-lookup"><span data-stu-id="18e3f-131">Set key vault advanced access policies</span></span>

<span data-ttu-id="18e3f-132">I **criteri di accesso avanzati** consentono la crittografia dei dischi nell'insieme di credenziali delle chiavi e in loro assenza le distribuzioni della crittografia hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="18e3f-132">**Advanced access policies** enable disk encryption on the key vault, and without them, encryption deployments will fail.</span></span> 

<span data-ttu-id="18e3f-133">È necessario abilitare tre criteri:</span><span class="sxs-lookup"><span data-stu-id="18e3f-133">There are three policies that need to be enabled:</span></span>

- <span data-ttu-id="18e3f-134">**Insieme di credenziali delle chiavi per la crittografia del disco**.</span><span class="sxs-lookup"><span data-stu-id="18e3f-134">**Key Vault for disk encryption**.</span></span> <span data-ttu-id="18e3f-135">Obbligatorio per Crittografia dischi di Azure.</span><span class="sxs-lookup"><span data-stu-id="18e3f-135">Required for Azure Disk Encryption.</span></span>
- <span data-ttu-id="18e3f-136">**Insieme di credenziali delle chiavi per la distribuzione**.</span><span class="sxs-lookup"><span data-stu-id="18e3f-136">**Key Vault for deployment**.</span></span> <span data-ttu-id="18e3f-137">Consente al provider di risorse Microsoft.Compute di recuperare segreti dall'insieme di credenziali delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="18e3f-137">Enables the Microsoft.Compute resource provider to retrieve secrets from the key vault.</span></span> <span data-ttu-id="18e3f-138">Questo criterio è necessario quando si crea una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="18e3f-138">This policy is needed when you are creating a VM.</span></span>
- <span data-ttu-id="18e3f-139">**Insieme di credenziali delle chiavi per la distribuzione del modello, se necessario**.</span><span class="sxs-lookup"><span data-stu-id="18e3f-139">**Key Vault for template deployment, if needed**.</span></span> <span data-ttu-id="18e3f-140">Consente ad Azure Resource Manager di ottenere segreti dall'Insieme di credenziali delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="18e3f-140">Enables Azure Resource Manager to get secrets from the key vault.</span></span> <span data-ttu-id="18e3f-141">Questo criterio è necessario quando si usano modelli di Azure Resource Manager per la distribuzione della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="18e3f-141">This policy is required when you are using Azure Resource Manager templates for VM deployment.</span></span>

<span data-ttu-id="18e3f-142">I criteri di accesso dell'insieme di credenziali delle chiavi possono essere configurati e gestiti usando il portale di Azure, Azure PowerShell o l'interfaccia della riga di comando di Azure.</span><span class="sxs-lookup"><span data-stu-id="18e3f-142">Key vault access policies can be configured and managed using the Azure portal, Azure PowerShell, or the Azure CLI.</span></span>

### <a name="what-is-the-azure-disk-encryption-prerequisites-configuration-script"></a><span data-ttu-id="18e3f-143">Informazioni sullo script di configurazione dei prerequisiti di Crittografia dischi di Azure</span><span class="sxs-lookup"><span data-stu-id="18e3f-143">What is the Azure Disk Encryption prerequisites configuration script</span></span>

<span data-ttu-id="18e3f-144">Lo **script di configurazione dei prerequisiti di Crittografia dischi di Azure** consente di configurare tutti i prerequisiti di crittografia (o quelli desiderati).</span><span class="sxs-lookup"><span data-stu-id="18e3f-144">The **Azure Disk Encryption prerequisites configuration script** sets up all (or as many as you want) of the encryption prerequisites.</span></span> <span data-ttu-id="18e3f-145">Lo script garantisce anche che l'insieme di credenziali delle chiavi si trovi nella stessa area della macchina virtuale da crittografare.</span><span class="sxs-lookup"><span data-stu-id="18e3f-145">The script also ensures that your key vault is in the same region as the VM you are going to encrypt.</span></span> <span data-ttu-id="18e3f-146">Lo script crea un gruppo di risorse e un insieme di credenziali delle chiavi e imposta i criteri di accesso dell'insieme di credenziali delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="18e3f-146">It will create a resource group and key vault, and set the key vault access policy.</span></span> <span data-ttu-id="18e3f-147">Lo script crea anche un blocco delle risorse nell'insieme di credenziali delle chiavi, per la protezione da eliminazioni accidentali.</span><span class="sxs-lookup"><span data-stu-id="18e3f-147">The script also creates a resource lock on the key vault to help protect it from accidental deletion.</span></span>

## <a name="encrypting-an-existing-vm-disk"></a><span data-ttu-id="18e3f-148">Crittografia di un disco di una macchina virtuale esistente</span><span class="sxs-lookup"><span data-stu-id="18e3f-148">Encrypting an existing VM disk</span></span>

<span data-ttu-id="18e3f-149">Per la crittografia di un disco di una macchina virtuale esistente usando lo script di configurazione dei prerequisiti di Crittografia dischi di Azure sono necessari due passaggi:</span><span class="sxs-lookup"><span data-stu-id="18e3f-149">There are two steps for encrypting an existing VM disk, when you are using the Azure Disk Encryption prerequisites configuration script:</span></span>

1. <span data-ttu-id="18e3f-150">Eseguire lo script di configurazione dei prerequisiti di Crittografia dischi di Azure.</span><span class="sxs-lookup"><span data-stu-id="18e3f-150">Run the Azure Disk Encryption prerequisites configuration script.</span></span>
1. <span data-ttu-id="18e3f-151">Crittografare la macchina virtuale di Azure in PowerShell.</span><span class="sxs-lookup"><span data-stu-id="18e3f-151">Encrypt the Azure virtual machine in PowerShell.</span></span>
