<span data-ttu-id="64cee-101">Il rivenditore online per cui si sta lavorando prevede di espandersi presto in una nuova area geografica.</span><span class="sxs-lookup"><span data-stu-id="64cee-101">The online retailer that you work for plans to expand to a new geographical area soon.</span></span> <span data-ttu-id="64cee-102">Questo passaggio aumenterà la base clienti e il volume delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="64cee-102">This move will increase your customer base and transaction volume.</span></span> <span data-ttu-id="64cee-103">È necessario assicurarsi che il database sia predisposto per gestire l'espansione secondo le necessità.</span><span class="sxs-lookup"><span data-stu-id="64cee-103">You must ensure that your database is equipped to handle expansion whenever required.</span></span>

<span data-ttu-id="64cee-104">Disporre di una strategia di partizione assicura che nel momento in cui il database dovrà aumentare le sue dimensioni, sarà in grado di farlo facilmente e continuare a eseguire transazioni e query efficienti.</span><span class="sxs-lookup"><span data-stu-id="64cee-104">Having a partition strategy ensures that when your database needs to grow, it can do so easily and continue to perform efficient queries and transactions.</span></span>

## <a name="what-is-a-partition-strategy"></a><span data-ttu-id="64cee-105">Cosa si intende per strategia di partizione?</span><span class="sxs-lookup"><span data-stu-id="64cee-105">What is a partition strategy?</span></span>

<span data-ttu-id="64cee-106">Se si continua ad aggiungere nuovi dati a un singolo server o a una singola partizione, potrebbe esaurirsi lo spazio.</span><span class="sxs-lookup"><span data-stu-id="64cee-106">If you continue to add new data to a single server or a single partition, it will eventually run out of space.</span></span> <span data-ttu-id="64cee-107">Per prepararsi a ciò, è necessaria una strategia di partizionamento di **scalabilità orizzontale** e non verticale.</span><span class="sxs-lookup"><span data-stu-id="64cee-107">To prepare for this, you need a partitioning strategy to **scale out** instead of up.</span></span> <span data-ttu-id="64cee-108">La scalabilità orizzontale consente di aggiungere altre partizioni nel database quando necessarie all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="64cee-108">Scaling out is also called horizontal scaling, and it enables you to add more partitions to your database as your application needs them.</span></span>

<span data-ttu-id="64cee-109">La strategia di partizione e scalabilità orizzontale in Azure Cosmos DB è determinata dalla chiave di partizione, ovvero un valore impostato durante la creazione di una raccolta.</span><span class="sxs-lookup"><span data-stu-id="64cee-109">The partition and scale-out strategy in Azure Cosmos DB is driven by the partition key, which is a value set when you create a collection.</span></span> <span data-ttu-id="64cee-110">Dopo aver impostato la chiave di partizione, non può essere modificata senza ricreare la raccolta, quindi selezionare la chiave di partizione corretta è una decisione importante da eseguire all'inizio del processo di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="64cee-110">Once the partition key is set, it cannot be changed without recreating the collection, so selecting the right partition key is an important decision to make early in your development process.</span></span>  

<span data-ttu-id="64cee-111">In questa unità, si apprenderà come scegliere la chiave di partizione più adatta a uno scenario e che potrà sfruttare la scalabilità automatica che Azure Cosmos DB è in grado di offrire.</span><span class="sxs-lookup"><span data-stu-id="64cee-111">In this unit, you will learn how to choose a partition key that's right for your scenario and will take advantage of the autoscaling that Azure Cosmos DB can do for you.</span></span>

## <a name="what-is-a-partition-key"></a><span data-ttu-id="64cee-112">Che cos'è una chiave di partizione?</span><span class="sxs-lookup"><span data-stu-id="64cee-112">What is a partition key?</span></span>

<span data-ttu-id="64cee-113">Una chiave di partizione è il valore con cui Azure organizza i dati in suddivisioni logiche.</span><span class="sxs-lookup"><span data-stu-id="64cee-113">A partition key is the value by which Azure organizes your data into logical divisions.</span></span> <span data-ttu-id="64cee-114">In questo scenario di vendita online, l'uso del valore `userID` o `productId` come chiave di partizione è un'ottima scelta perché è univoco e idoneo per la ricerca dei record.</span><span class="sxs-lookup"><span data-stu-id="64cee-114">In our online retail scenario, using the `userID` or `productId` value as the partition key is a good choice because it will be unique and likely used to lookup records.</span></span> <span data-ttu-id="64cee-115">`userID` è un'ottima scelta, poiché l'applicazione deve spesso recuperare le impostazioni di personalizzazione, il carrello, la cronologia degli ordini e le informazioni di profilo per l'utente, solo per citarne alcune.</span><span class="sxs-lookup"><span data-stu-id="64cee-115">`userID` is a good choice, as your application frequently needs to retrieve the personalization settings, shopping cart, order history, and profile information for the user, just to name a few.</span></span> <span data-ttu-id="64cee-116">Anche `productId` è un'ottima scelta, poiché l'applicazione deve eseguire query su livelli di inventario, costi di spedizione, opzioni di colore, posizione dei negozi e molto altro.</span><span class="sxs-lookup"><span data-stu-id="64cee-116">`productId` is also a good choice, as your application needs to query inventory levels, shipping costs, color options, warehouse locations, and more.</span></span>

<span data-ttu-id="64cee-117">Una chiave di partizione deve tendere a distribuire le operazioni tra il database.</span><span class="sxs-lookup"><span data-stu-id="64cee-117">A partition key should aim to distribute operations across the database.</span></span> <span data-ttu-id="64cee-118">L'obiettivo è distribuire le richieste per evitare partizioni critiche.</span><span class="sxs-lookup"><span data-stu-id="64cee-118">You want to distribute requests to avoid hot partitions.</span></span> <span data-ttu-id="64cee-119">Una partizione critica è una partizione singola che riceve molte più richieste rispetto alle altre, che possono creare un collo di bottiglia della velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="64cee-119">A hot partition is a single partition that receives many more requests than the others, which can create a throughput bottleneck.</span></span> <span data-ttu-id="64cee-120">Ad esempio, per l'applicazione di e-commerce, l'ora corrente sarebbe una pessima scelta per una chiave di partizione, perché tutti i dati in ingresso sarebbero indirizzati a una singola chiave di partizione.</span><span class="sxs-lookup"><span data-stu-id="64cee-120">For example, for your e-commerce application, the current time would be a poor choice of partition key, because all the incoming data would go to a single partition key.</span></span> <span data-ttu-id="64cee-121">I valori `userID` o `productId` sono più indicati, dal momento che tutti gli utenti nel sito probabilmente aggiungono e aggiornano i dati del carrello o del profilo circa con la stessa frequenza, così che le letture e le scritture vengono distribuite in tutte le partizioni dell'utente e dei prodotti.</span><span class="sxs-lookup"><span data-stu-id="64cee-121">`userID` or `productId` would be better, as all the users on your site would likely be adding and updating their shopping cart or profile information at about the same frequency, which distributes the reads and writes across all the user and product partitions.</span></span>

<span data-ttu-id="64cee-122">Lo spazio di archiviazione massimo per i dati associati a ogni chiave di partizione è di 10 GB, ovvero le dimensioni di una partizione fisica in Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="64cee-122">The storage space for the data associated with each partition key cannot exceed 10 GB, which is the size of one physical partition in Azure Cosmos DB.</span></span> <span data-ttu-id="64cee-123">Pertanto, se il singolo record `userID` o `productId` è superiore a 10 GB, può essere necessario usare invece una chiave composta in modo che ogni record sia inferiore.</span><span class="sxs-lookup"><span data-stu-id="64cee-123">So, if your single `userID` or `productId` record is going to be larger than 10 GB, think about using a composite key instead so that each record is smaller.</span></span> <span data-ttu-id="64cee-124">Un esempio di una chiave composta sarebbe `userID-date`, che sarà simile a **CustomerName-08072018**.</span><span class="sxs-lookup"><span data-stu-id="64cee-124">An example of a composite key would be `userID-date`, which would look like **CustomerName-08072018**.</span></span> <span data-ttu-id="64cee-125">Questo approccio consentirebbe di creare una nuova partizione per ogni giorno in cui un utente visita il sito.</span><span class="sxs-lookup"><span data-stu-id="64cee-125">This composite key approach would enable you to create a new partition for each day a user visited the site.</span></span>

## <a name="best-practices"></a><span data-ttu-id="64cee-126">Procedure consigliate</span><span class="sxs-lookup"><span data-stu-id="64cee-126">Best practices</span></span>

<span data-ttu-id="64cee-127">Quando si tenta di determinare la chiave di partizione corretta e la soluzione non è ovvia, ecco alcuni suggerimenti da tenere presenti.</span><span class="sxs-lookup"><span data-stu-id="64cee-127">When you're trying to determine the right partition key and the solution isn't obvious, here are a few tips to keep in mind.</span></span>

- <span data-ttu-id="64cee-128">Non temere di scegliere una chiave di partizione con un numero elevato di valori.</span><span class="sxs-lookup"><span data-stu-id="64cee-128">Don’t be afraid of choosing a partition key that has a large number of values.</span></span> <span data-ttu-id="64cee-129">Più sono i valori della chiave di partizione, maggiore è la scalabilità.</span><span class="sxs-lookup"><span data-stu-id="64cee-129">The more values your partition key has, the more scalability you have.</span></span>
- <span data-ttu-id="64cee-130">Per determinare la migliore chiave di partizione per un carico di lavoro con intensa attività di lettura, esaminare le migliori 3-5 query che si intende usare.</span><span class="sxs-lookup"><span data-stu-id="64cee-130">To determine the best partition key for a read-heavy workload, review the top three to five queries you plan on using.</span></span> <span data-ttu-id="64cee-131">Il valore incluso più di frequente nella clausola WHERE è un buon candidato per la chiave di partizione.</span><span class="sxs-lookup"><span data-stu-id="64cee-131">The value most frequently included in the WHERE clause is a good candidate for the partition key.</span></span>
- <span data-ttu-id="64cee-132">Per carichi di lavoro con intensa attività di scrittura, è necessario capire le esigenze di un carico di lavoro transazionale, poiché la chiave di partizione è l'ambito delle transazioni in più documenti.</span><span class="sxs-lookup"><span data-stu-id="64cee-132">For write-heavy workloads, you'll need to understand the transactional needs of your workload, because the partition key is the scope of multi-document transactions.</span></span>
