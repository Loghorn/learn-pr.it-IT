<span data-ttu-id="6e349-101">Verranno ora esaminati i fattori che influenzano le prestazioni del disco in Azure e in che modo la memorizzazione nella cache contribuisce a ottimizzare tali prestazioni.</span><span class="sxs-lookup"><span data-stu-id="6e349-101">We're going to look at the factors that affect disk performance in Azure, and how caching can help optimize performance.</span></span> 

### <a name="disk-caching"></a><span data-ttu-id="6e349-102">Memorizzazione nella cache del disco</span><span class="sxs-lookup"><span data-stu-id="6e349-102">Disk caching</span></span>

<span data-ttu-id="6e349-103">Una cache è un componente specializzato in un computer che archivia i dati in modo che siano accessibili più rapidamente, in genere in memoria.</span><span class="sxs-lookup"><span data-stu-id="6e349-103">A cache is a specialized component in a computer that stores data so it can be accessed faster, typically in memory.</span></span> <span data-ttu-id="6e349-104">I dati in una cache sono spesso dati che sono stati letti in precedenza o dati ottenuti da un calcolo precedente.</span><span class="sxs-lookup"><span data-stu-id="6e349-104">The data in a cache is often data that has been read previously, or is data that resulted from an earlier calculation.</span></span> <span data-ttu-id="6e349-105">L'obiettivo è accedere ai dati più velocemente rispetto a quando si recuperano dal disco.</span><span class="sxs-lookup"><span data-stu-id="6e349-105">The goal is to access data faster than getting it from disk.</span></span>

<span data-ttu-id="6e349-106">La memorizzazione nella cache usa un'archiviazione temporanea specializzata e talvolta dispendiosa che offre prestazioni di lettura e/o scrittura più veloci rispetto all'archiviazione permanente.</span><span class="sxs-lookup"><span data-stu-id="6e349-106">Caching uses specialized, and sometimes expensive, temporary storage that has faster read and/or write performance than permanent storage.</span></span> <span data-ttu-id="6e349-107">Poiché questo tipo di archiviazione nella cache è spesso limitato, è opportuno decidere quali operazioni sui dati avranno maggiori vantaggi dalla memorizzazione nella cache.</span><span class="sxs-lookup"><span data-stu-id="6e349-107">Because this cache storage is often limited, decisions need to be made as to what data operations will benefit most from caching.</span></span> <span data-ttu-id="6e349-108">Ma anche nei casi in cui la cache può essere resa ampiamente disponibile, ad esempio in Azure, è comunque importante conoscere i modelli di carico di lavoro di ogni disco prima di decidere quale tipo di memorizzazione nella cache usare.</span><span class="sxs-lookup"><span data-stu-id="6e349-108">But even where the cache can be made widely available, such as in Azure, it's still important to know the workload patterns of each disk before deciding on what caching type to use.</span></span>

<span data-ttu-id="6e349-109">La **memorizzazione nella cache di lettura** tenta di velocizzare il recupero dati.</span><span class="sxs-lookup"><span data-stu-id="6e349-109">**Read caching** tries to speed up data retrieval.</span></span> <span data-ttu-id="6e349-110">Invece che da un archivio permanente, i dati vengono letti dalla cache più veloce.</span><span class="sxs-lookup"><span data-stu-id="6e349-110">Instead of reading from permanent storage, the data is read from the faster cache.</span></span> <span data-ttu-id="6e349-111">Le letture dei dati accedono alla cache nelle condizioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="6e349-111">Data reads hit the cache under the following conditions.</span></span>

- <span data-ttu-id="6e349-112">I dati sono stati letti in precedenza ed esistono nella cache.</span><span class="sxs-lookup"><span data-stu-id="6e349-112">The data has been read before and exists in the cache.</span></span>
- <span data-ttu-id="6e349-113">La cache è sufficientemente grande da contenere tutti i dati.</span><span class="sxs-lookup"><span data-stu-id="6e349-113">And the cache is large enough to hold all of this data.</span></span>

<span data-ttu-id="6e349-114">È importante notare che la memorizzazione nella cache di lettura è utile in caso di _prevedibilità_ della coda di lettura, ad esempio nel caso di una serie di letture sequenziali.</span><span class="sxs-lookup"><span data-stu-id="6e349-114">It's important to note that read caching helps when there is some _predictability_ to the read queue, such as a set of sequential reads.</span></span> <span data-ttu-id="6e349-115">Per operazioni di I/O casuali, nel caso in cui i dati a cui si accede siano sparsi tra più risorse di archiviazione, la memorizzazione nella cache offrirà un vantaggio minimo se non nullo e potrà addirittura ridurre le prestazioni del disco.</span><span class="sxs-lookup"><span data-stu-id="6e349-115">For random IO, where the data you're accessing is scattered across storage, caching will be of little or no benefit, and can even reduce disk performance.</span></span>

<span data-ttu-id="6e349-116">La **memorizzazione nella cache di scrittura** tenta di accelerare la scrittura dei dati nella risorsa di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="6e349-116">**Write caching** tries to speed up writing data to storage.</span></span> <span data-ttu-id="6e349-117">Usando una cache in scrittura, l'app può prendere in considerazione i dati da salvare.</span><span class="sxs-lookup"><span data-stu-id="6e349-117">By using a write cache, the app can consider the data to be saved.</span></span> <span data-ttu-id="6e349-118">In realtà, i dati vengono inseriti in coda in una cache in attesa di essere scritti in un archivio permanente.</span><span class="sxs-lookup"><span data-stu-id="6e349-118">In reality, the data is queued up in a cache waiting to be written to permanent storage.</span></span> <span data-ttu-id="6e349-119">Come è facile immaginare, questo meccanismo può essere un potenziale punto di guasto, se il sistema viene arrestato prima che i dati memorizzati nella cache vengano scaricati su disco.</span><span class="sxs-lookup"><span data-stu-id="6e349-119">As you can imagine, this mechanism can be a potential point of failure, if the system shuts down before this cached data is flushed to disk.</span></span> <span data-ttu-id="6e349-120">Alcuni sistemi, come SQL Server, gestiscono la scrittura dei dati memorizzati nella cache nell'archivio su disco persistente in modo autonomo.</span><span class="sxs-lookup"><span data-stu-id="6e349-120">Some systems, such as SQL Server, handle writing cached data to persistent disk storage themselves.</span></span>  

### <a name="azure-disk-caching"></a><span data-ttu-id="6e349-121">Memorizzazione nella cache del disco di Azure</span><span class="sxs-lookup"><span data-stu-id="6e349-121">Azure disk caching</span></span>

<span data-ttu-id="6e349-122">Esistono due tipi di memorizzazione nella cache del disco che interessano l'archiviazione su disco:</span><span class="sxs-lookup"><span data-stu-id="6e349-122">There are two types of disk caching that concern disk storage:</span></span>

- <span data-ttu-id="6e349-123">Memorizzazione nella cache di Archiviazione di Azure</span><span class="sxs-lookup"><span data-stu-id="6e349-123">Azure storage caching</span></span>
- <span data-ttu-id="6e349-124">Memorizzazione nella cache del disco della macchina virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="6e349-124">Azure virtual machine disk caching</span></span>

<span data-ttu-id="6e349-125">La memorizzazione nella cache di Archiviazione di Azure fornisce servizi di cache per Archiviazione BLOB di Azure, File di Azure e altri contenuti in Azure.</span><span class="sxs-lookup"><span data-stu-id="6e349-125">Azure storage caching provides cache services for Azure Blob storage, Azure Files, and other content in Azure.</span></span> <span data-ttu-id="6e349-126">La configurazione di questi tipi di cache non rientra nell'ambito di questo modulo.</span><span class="sxs-lookup"><span data-stu-id="6e349-126">Configuration of these types of cache is beyond the scope of this module.</span></span>

<span data-ttu-id="6e349-127">La memorizzazione nella cache del disco della macchina virtuale di Azure riguarda l'ottimizzazione dell'accesso in lettura e scrittura ai file del disco rigido virtuale collegati alle macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="6e349-127">Azure virtual machine disk caching is about optimizing read and write access to the virtual hard disk (VHD) files attached to Azure VMs.</span></span> <span data-ttu-id="6e349-128">In questo modulo verrà presa in considerazione la memorizzazione nella cache del disco.</span><span class="sxs-lookup"><span data-stu-id="6e349-128">We'll focus on disk caching in this module.</span></span>

### <a name="azure-virtual-machine-disk-types"></a><span data-ttu-id="6e349-129">Tipi di dischi della macchina virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="6e349-129">Azure virtual machine disk types</span></span>

<span data-ttu-id="6e349-130">Esistono tre tipi di dischi che vengono usati con le macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="6e349-130">There are three types of disks used with Azure virtual machines (VM).</span></span>

- <span data-ttu-id="6e349-131">**Disco del sistema operativo**: quando si crea una macchina virtuale di Azure, Azure collega automaticamente un disco rigido virtuale per il sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="6e349-131">**OS disk**: When you create an Azure VM, Azure automatically attaches a VHD for the operating system (OS).</span></span> <span data-ttu-id="6e349-132">Il disco rigido virtuale viene archiviato come BLOB di pagine in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="6e349-132">The VHD is stored as a page blob in Azure storage.</span></span>
- <span data-ttu-id="6e349-133">**Disco temporaneo**: quando si crea una macchina virtuale di Azure, Azure aggiunge anche automaticamente un disco temporaneo.</span><span class="sxs-lookup"><span data-stu-id="6e349-133">**Temporary disk**: When you create an Azure VM, Azure also automatically adds a temporary disk.</span></span> <span data-ttu-id="6e349-134">Questo disco viene usato per i dati come file di paging e di scambio.</span><span class="sxs-lookup"><span data-stu-id="6e349-134">This disk is used for data such as page and swap files.</span></span> <span data-ttu-id="6e349-135">I dati in questo disco potrebbero andare persi durante la manutenzione o la ridistribuzione di una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="6e349-135">The data on this disk may be lost during maintenance or a VM redeploy.</span></span> <span data-ttu-id="6e349-136">Pertanto, non usarlo per l'archiviazione di dati permanenti, come file di database o log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="6e349-136">So, don't use it for storing permanent data, such as database files or transaction logs.</span></span>
- <span data-ttu-id="6e349-137">**Dischi dati**: un disco dati è un disco rigido virtuale collegato a una macchina virtuale per archiviare i dati delle applicazioni o altri dati che è necessario conservare.</span><span class="sxs-lookup"><span data-stu-id="6e349-137">**Data disks**: A data disk is a VHD that's attached to a virtual machine to store application data, or other data you need to keep.</span></span>

<span data-ttu-id="6e349-138">I dischi del sistema operativo e i dischi dati sfruttano i vantaggi della memorizzazione nella cache del disco della macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="6e349-138">OS disks and data disks take advantage of Azure VM disk caching.</span></span> <span data-ttu-id="6e349-139">Le dimensioni della cache per un disco della macchina virtuale dipendono dalle dimensioni dell'istanza della macchina virtuale e dal numero di dischi montati nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="6e349-139">The cache size for a VM disk depends on the VM instance size and on the number of disks mounted on the VM.</span></span> <span data-ttu-id="6e349-140">La memorizzazione nella cache può essere abilitata solo per un massimo di quattro dischi dati.</span><span class="sxs-lookup"><span data-stu-id="6e349-140">Caching can only be enabled for up to four data disks.</span></span>

## <a name="cache-options-for-azure-vms"></a><span data-ttu-id="6e349-141">Opzioni della cache per le macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="6e349-141">Cache options for Azure VMs</span></span>

<span data-ttu-id="6e349-142">Sono disponibili tre opzioni comuni per la memorizzazione nella cache del disco della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="6e349-142">There are three common options for VM disk caching.</span></span>

- <span data-ttu-id="6e349-143">**Lettura/scrittura**: cache writeback.</span><span class="sxs-lookup"><span data-stu-id="6e349-143">**Read/write** – write back cache.</span></span>  <span data-ttu-id="6e349-144">Usare questa opzione solo se l'applicazione gestisce correttamente la scrittura di dati memorizzati nella cache in dischi persistenti, quando necessario.</span><span class="sxs-lookup"><span data-stu-id="6e349-144">Only use this option if your application properly handles writing cached data to persistent disks when needed</span></span>
- <span data-ttu-id="6e349-145">**Sola lettura**: le operazioni di lettura vengono eseguite dalla cache.</span><span class="sxs-lookup"><span data-stu-id="6e349-145">**Read-only** - reads are performed from cache.</span></span>
- <span data-ttu-id="6e349-146">**Nessuna**: nessuna cache.</span><span class="sxs-lookup"><span data-stu-id="6e349-146">**None** - no cache.</span></span> <span data-ttu-id="6e349-147">Selezionare questa opzione per dischi in sola scrittura e con intensa attività di scrittura.</span><span class="sxs-lookup"><span data-stu-id="6e349-147">Select this option for write-only and write-heavy disks.</span></span> <span data-ttu-id="6e349-148">I file di log sono un candidato ideale essendo contraddistinti da operazioni con intensa attività di scrittura.</span><span class="sxs-lookup"><span data-stu-id="6e349-148">Log files are a good candidate since they're write-heavy operations.</span></span>

<span data-ttu-id="6e349-149">Non tutte le opzioni di memorizzazione nella cache sono disponibili per ogni tipo di disco.</span><span class="sxs-lookup"><span data-stu-id="6e349-149">Not every caching option is available for each type of disk.</span></span> <span data-ttu-id="6e349-150">La tabella seguente illustra le opzioni di memorizzazione nella cache per ogni tipo di disco:</span><span class="sxs-lookup"><span data-stu-id="6e349-150">The following table shows you the caching options for each disk type:</span></span>

| |<span data-ttu-id="6e349-151">**Sola lettura**</span><span class="sxs-lookup"><span data-stu-id="6e349-151">**Read-only**</span></span>  |<span data-ttu-id="6e349-152">**Lettura/scrittura**</span><span class="sxs-lookup"><span data-stu-id="6e349-152">**Read/write**</span></span>  |<span data-ttu-id="6e349-153">**Nessuna**</span><span class="sxs-lookup"><span data-stu-id="6e349-153">**None**</span></span>  |
|---------|---------|---------|---------|
|<span data-ttu-id="6e349-154">Disco del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="6e349-154">OS disk</span></span>     |   <span data-ttu-id="6e349-155">Sì</span><span class="sxs-lookup"><span data-stu-id="6e349-155">yes</span></span>      |   <span data-ttu-id="6e349-156">Sì (impostazione predefinita)</span><span class="sxs-lookup"><span data-stu-id="6e349-156">yes (default)</span></span>     |   <span data-ttu-id="6e349-157">Sì</span><span class="sxs-lookup"><span data-stu-id="6e349-157">yes</span></span>      |
|<span data-ttu-id="6e349-158">Disco dati</span><span class="sxs-lookup"><span data-stu-id="6e349-158">Data disk</span></span>     |   <span data-ttu-id="6e349-159">Sì (impostazione predefinita)</span><span class="sxs-lookup"><span data-stu-id="6e349-159">yes (default)</span></span>      |  <span data-ttu-id="6e349-160">Sì</span><span class="sxs-lookup"><span data-stu-id="6e349-160">yes</span></span>       |  <span data-ttu-id="6e349-161">Sì</span><span class="sxs-lookup"><span data-stu-id="6e349-161">yes</span></span>       |
|<span data-ttu-id="6e349-162">Disco temporaneo</span><span class="sxs-lookup"><span data-stu-id="6e349-162">Temporary disk</span></span>     |  <span data-ttu-id="6e349-163">No</span><span class="sxs-lookup"><span data-stu-id="6e349-163">no</span></span>       |   <span data-ttu-id="6e349-164">No</span><span class="sxs-lookup"><span data-stu-id="6e349-164">no</span></span>      |   <span data-ttu-id="6e349-165">No</span><span class="sxs-lookup"><span data-stu-id="6e349-165">no</span></span>      |

> [!NOTE]
> <span data-ttu-id="6e349-166">Le opzioni di memorizzazione nella cache del disco non possono essere modificate per le macchine virtuali serie L e serie B.</span><span class="sxs-lookup"><span data-stu-id="6e349-166">Disk caching options can't be changed for L-Series and B-series virtual machines.</span></span>

## <a name="performance-considerations-for-azure-vm-disk-caching"></a><span data-ttu-id="6e349-167">Considerazioni sulle prestazioni per la memorizzazione nella cache del disco della macchina virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="6e349-167">Performance considerations for Azure VM disk caching</span></span>

<span data-ttu-id="6e349-168">In che modo le impostazioni della cache influiscono sulle prestazioni dei carichi di lavoro in esecuzione nelle macchine virtuali di Azure?</span><span class="sxs-lookup"><span data-stu-id="6e349-168">So how can your cache settings affect the performance of your workloads running on Azure VMs?</span></span>

### <a name="os-disk"></a><span data-ttu-id="6e349-169">Disco del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="6e349-169">OS disk</span></span>

<span data-ttu-id="6e349-170">Per un disco del sistema operativo della macchina virtuale, il comportamento predefinito consiste nell'usare la cache in modalità lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="6e349-170">For a VM OS disk, the default behavior is to use the cache in Read/write mode.</span></span> <span data-ttu-id="6e349-171">Se si hanno applicazioni che archiviano file di dati nel disco del sistema operativo e le applicazioni eseguono numerose operazioni di lettura/scrittura casuali sui file di dati, si consiglia di spostare tali file in un disco dati, in cui la memorizzazione nella cache è disattivata.</span><span class="sxs-lookup"><span data-stu-id="6e349-171">If you have applications that store data files on the OS disk, and the applications do lots of random read/write operations to data files, consider moving those files to a data disk, which has the caching turned off.</span></span> <span data-ttu-id="6e349-172">Se la coda di lettura non contiene letture sequenziali, la memorizzazione nella cache offrirà un vantaggio minimo se non nullo.</span><span class="sxs-lookup"><span data-stu-id="6e349-172">Why is that Well, if the read queue does not contain sequential reads, caching will be of little or no benefit.</span></span> <span data-ttu-id="6e349-173">Il sovraccarico della gestione della cache, come se i dati fossero sequenziali, può ridurre le prestazioni del disco.</span><span class="sxs-lookup"><span data-stu-id="6e349-173">The overhead of maintaining the cache, as if the data was sequential, can reduce disk performance.</span></span>

### <a name="data-disks"></a><span data-ttu-id="6e349-174">Dischi dati</span><span class="sxs-lookup"><span data-stu-id="6e349-174">Data disks</span></span>

<span data-ttu-id="6e349-175">Per applicazioni sensibili alle prestazioni, è necessario usare dischi dati anziché il disco del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="6e349-175">For performance sensitive applications, you should use data disks, rather than the OS disk.</span></span> <span data-ttu-id="6e349-176">L'uso di dischi separati consente di configurare le impostazioni della cache appropriate per ogni disco.</span><span class="sxs-lookup"><span data-stu-id="6e349-176">Using separate disks allows you to configure the appropriate cache settings for each disk.</span></span>

<span data-ttu-id="6e349-177">Ad esempio, nelle macchine virtuali di Azure che eseguono SQL Server l'abilitazione della memorizzazione nella cache in **sola lettura** nei dischi dati (per dati normali e TempDB) può comportare miglioramenti significativi delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="6e349-177">For example, on Azure VMs running SQL Server, enabling **Read-only** caching on the data disks (for regular and TempDB data), can result in significant performance improvements.</span></span> <span data-ttu-id="6e349-178">I file di log, d'altra parte, sono candidati ideali per i dischi dati con nessuna memorizzazione nella cache.</span><span class="sxs-lookup"><span data-stu-id="6e349-178">Log files, on the other hand, are good candidates for data disks with no caching.</span></span>

> [!WARNING]
> <span data-ttu-id="6e349-179">La modifica dell'impostazione della cache di un disco di Azure scollega e ricollega il disco di destinazione.</span><span class="sxs-lookup"><span data-stu-id="6e349-179">Changing the cache setting of an Azure disk detaches and re-attaches the target disk.</span></span> <span data-ttu-id="6e349-180">Se si tratta del disco del sistema operativo, la macchina virtuale viene riavviata.</span><span class="sxs-lookup"><span data-stu-id="6e349-180">If it's the operating system disk, the VM is restarted.</span></span> <span data-ttu-id="6e349-181">Arrestare tutte le applicazioni e i servizi che potrebbero essere interessati da questa interruzione prima di modificare l'impostazione della cache del disco.</span><span class="sxs-lookup"><span data-stu-id="6e349-181">Stop all applications/services that might be affected by this disruption before changing the disk cache setting.</span></span>
>
>