<span data-ttu-id="24ce9-101">Il punto debole più comune nelle applicazioni moderne, a livello di sicurezza, è la non corretta elaborazione dell'input ricevuto da origini esterne, in particolare l'_input dell'utente_.</span><span class="sxs-lookup"><span data-stu-id="24ce9-101">The most prevalent security weakness of applications today is to not correctly process input received from external sources, particularly _user input_.</span></span> <span data-ttu-id="24ce9-102">È importante esaminare sempre attentamente qualsiasi input per assicurarsi che sia stato convalidato prima di usarlo.</span><span class="sxs-lookup"><span data-stu-id="24ce9-102">You should always take a close look at any input to make sure it has been validated before it is used.</span></span> <span data-ttu-id="24ce9-103">In caso contrario, le conseguenze potrebbero essere l'esposizione o perdita di dati, l'escalation di privilegi o persino l'esecuzione di malware nei computer di altri utenti.</span><span class="sxs-lookup"><span data-stu-id="24ce9-103">Failing to do this can result in data loss or exposure, escalation of privilege, or even execution of malicious code on other users' computers!</span></span>

<span data-ttu-id="24ce9-104">L'aspetto tragico è che questo problema è in realtà facile da risolvere.</span><span class="sxs-lookup"><span data-stu-id="24ce9-104">The tragic thing is that this is an easy problem to solve.</span></span> <span data-ttu-id="24ce9-105">In questa unità verrà illustrato come trattare i dati, quando vengono ricevuti, quando vengono visualizzati sullo schermo e quando vengono archiviati per uso futuro.</span><span class="sxs-lookup"><span data-stu-id="24ce9-105">Here we will cover how to treat data; when it’s received, when it’s displayed on the screen, and when it's stored for later use.</span></span>

## <a name="why-do-we-need-to-validate-our-input"></a><span data-ttu-id="24ce9-106">Perché è necessario convalidare l'input?</span><span class="sxs-lookup"><span data-stu-id="24ce9-106">Why do we need to validate our input?</span></span>

<span data-ttu-id="24ce9-107">Immaginiamo di voler compilare un'interfaccia che consenta a un utente di creare un account sul sito Web.</span><span class="sxs-lookup"><span data-stu-id="24ce9-107">Imagine that you are building an interface to allow a user to create an account on your website.</span></span> <span data-ttu-id="24ce9-108">I dati del profilo includono un nome, un indirizzo di posta elettronica e un nome alternativo che saranno visibili a chiunque visiti il sito.</span><span class="sxs-lookup"><span data-stu-id="24ce9-108">Our profile data includes a name, email, and a nickname that we will display to everyone who visits the site.</span></span> <span data-ttu-id="24ce9-109">Supponiamo che un nuovo utente crei un profilo e immetta un nome alternativo che include alcuni comandi SQL.</span><span class="sxs-lookup"><span data-stu-id="24ce9-109">What if a new user creates a profile and enters a nickname that includes some SQL commands?</span></span> <span data-ttu-id="24ce9-110">Un utente malintenzionato potrebbe ad esempio immettere qualcosa di simile a questo:</span><span class="sxs-lookup"><span data-stu-id="24ce9-110">For example - what if our bad user enters something like:</span></span>

```output
Eve'); DROP TABLE Users;--
```

<span data-ttu-id="24ce9-111">Se si inserisse ciecamente questo valore in un database, potrebbe alterare l'istruzione SQL in modo da eseguire comandi potenzialmente dannosi.</span><span class="sxs-lookup"><span data-stu-id="24ce9-111">If we just blindly insert this value into a database, it could potentially alter the SQL statement to execute commands we absolutely don't want to run!</span></span> <span data-ttu-id="24ce9-112">Questo comportamento è detto "attacco SQL injection" ed è uno dei _numerosi_ tipi di exploit possibili quando non si gestiscono correttamente gli input.</span><span class="sxs-lookup"><span data-stu-id="24ce9-112">This is referred to as a "SQL Injection" attack and is one of the _many_ types of exploits that can potentially be done when you don't properly handle inputs.</span></span> <span data-ttu-id="24ce9-113">Come si può risolvere questo problema?</span><span class="sxs-lookup"><span data-stu-id="24ce9-113">So, what can we do to fix this?</span></span> <span data-ttu-id="24ce9-114">In questa unità verrà illustrato come purificare l'input, codificare l'output e creare query con parametri (risolvendo l'exploit descritto sopra).</span><span class="sxs-lookup"><span data-stu-id="24ce9-114">This unit will teach you when to sanitize input, how to encode output, and how to create parameterized queries (which solves the above exploit!).</span></span> <span data-ttu-id="24ce9-115">Queste sono le principali tecniche di difesa dagli input dannosi che vengono immessi nelle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="24ce9-115">These are the three main defense techniques against malicious input being entered into your applications.</span></span>

## <a name="when-do-i-need-to-validate-input"></a><span data-ttu-id="24ce9-116">Quando è necessario convalidare l'input?</span><span class="sxs-lookup"><span data-stu-id="24ce9-116">When do I need to validate input?</span></span>

<span data-ttu-id="24ce9-117">La risposta è _sempre_.</span><span class="sxs-lookup"><span data-stu-id="24ce9-117">The answer is _always_.</span></span> <span data-ttu-id="24ce9-118">Occorre convalidare **ogni** input per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="24ce9-118">You must validate **every** input for your application.</span></span> <span data-ttu-id="24ce9-119">Sono inclusi i parametri nell'URL, l'input dell'utente, i dati del database, i dati di un'API e qualsiasi elemento passato in formato non crittografato che potrebbe essere modificato da un utente.</span><span class="sxs-lookup"><span data-stu-id="24ce9-119">This includes parameters in the URL, input from the user, data from the database, data from an API and anything that is passed in the clear that a user could potentially manipulate.</span></span> <span data-ttu-id="24ce9-120">Adottare sempre un approccio in base a cui accettare solo input notoriamente valido, invece di cercare specificamente l'input non valido, in quanto è impossibile avere un elenco completo di input potenzialmente pericolosi.</span><span class="sxs-lookup"><span data-stu-id="24ce9-120">Always use a whitelist approach, which means you only accept "known good" input, instead of a blacklist (where you specifically look for bad input) because it's impossible to think of a complete list of potentially dangerous input.</span></span>  <span data-ttu-id="24ce9-121">Fare tutto questo sul lato server, non sul lato client (oppure su entrambi i lati), per assicurarsi che le difese non vengano aggirate.</span><span class="sxs-lookup"><span data-stu-id="24ce9-121">Do this work on the server, not the client-side (or in addition to the client-side), to ensure that your defenses cannot be circumvented.</span></span> <span data-ttu-id="24ce9-122">Considerare **TUTTI** i dati come non attendibili per proteggersi dalle più comuni vulnerabilità per le app Web.</span><span class="sxs-lookup"><span data-stu-id="24ce9-122">Treat **ALL** data as untrusted and you will protect yourself from most of the common web app vulnerabilities.</span></span>

<span data-ttu-id="24ce9-123">Se si usa ASP.NET, il framework offre un [ottimo supporto per la convalida dell'input](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) sia sul lato client che sul lato server.</span><span class="sxs-lookup"><span data-stu-id="24ce9-123">If you are using ASP.NET, the framework provides [great support for validating input](https://docs.microsoft.com/aspnet/web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites) on both the client and server side.</span></span>

<span data-ttu-id="24ce9-124">Se si usa un altro framework Web, sul sito [OWASP](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet) sono descritte alcune ottime tecniche di convalida dell'input.</span><span class="sxs-lookup"><span data-stu-id="24ce9-124">If you are using another web framework, there are some great techniques for doing input validation available on the [OWASP Input Validation Cheatsheet](https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet).</span></span>


## <a name="always-use-parameterized-queries"></a><span data-ttu-id="24ce9-125">Usare sempre query con parametri</span><span class="sxs-lookup"><span data-stu-id="24ce9-125">Always use parameterized queries</span></span>

<span data-ttu-id="24ce9-126">I database SQL vengono generalmente usati per archiviare dati. Si potrebbe ad esempio archiviare le informazioni sul profilo in SQL Server.</span><span class="sxs-lookup"><span data-stu-id="24ce9-126">SQL databases are commonly used to store data - we might be storing our profile information in SQL Server for example.</span></span>  <span data-ttu-id="24ce9-127">Evitare sempre di creare SQL inline o altre query di database "sul momento" nel codice e di inviarlo direttamente al database, in quanto è una strada sicura verso il disastro, come abbiamo visto prima.</span><span class="sxs-lookup"><span data-stu-id="24ce9-127">Never create inline SQL or other database queries "on the fly" in your code and send it directly to the database, this is a recipe for disaster, as we saw above.</span></span>

<span data-ttu-id="24ce9-128">Ad esempio, **non fare questo** (noto come SQL inline):</span><span class="sxs-lookup"><span data-stu-id="24ce9-128">For example, **do not do this** (known as inline SQL):</span></span>

```csharp
string userName = ... // receive input from the user BEWARE!
...
string query = "SELECT *  FROM  [dbo].[users] WHERE userName = '" + userName + "'";
```

<span data-ttu-id="24ce9-129">In questo esempio vengono concatenate più stringhe di testo per creare la query, recuperando l'input dall'utente e generando una query SQL dinamica per cercare l'utente.</span><span class="sxs-lookup"><span data-stu-id="24ce9-129">Here we concatenate text strings together to create the query, taking the input from the user and generating a dynamic SQL query to lookup the user.</span></span> <span data-ttu-id="24ce9-130">Anche in questo caso, se un utente malintenzionato capisse quale azione si sta eseguendo o anche solo _provasse_ diversi stili di input per rilevare eventuali vulnerabilità, le conseguenze potrebbero essere estremamente gravi.</span><span class="sxs-lookup"><span data-stu-id="24ce9-130">Again, if an evil user realized we were doing this, or just _tried_ different input styles to see if there was a vulnerability, we could end up with a major disaster.</span></span> <span data-ttu-id="24ce9-131">È invece preferibile usare istruzioni SQL con parametri o, meglio ancora, stored procedure:</span><span class="sxs-lookup"><span data-stu-id="24ce9-131">Instead, prefer to use parameterized SQL statements, or even better - stored procedures:</span></span>

```sql
-- Lookup a user
CREATE PROCEDURE sp_findUser
(
@UserName varchar(50)
)

SELECT *  FROM  [dbo].[users] WHERE userName = @UserName
```

<span data-ttu-id="24ce9-132">Si può quindi richiamare la stored procedure dal codice in tutta sicurezza, passandole la stringa `userName` senza preoccuparsi che sia considerata parte dell'istruzione SQL.</span><span class="sxs-lookup"><span data-stu-id="24ce9-132">Then you can invoke the procedure from your code safely, passing it the `userName` string without worrying about it being treated as part of the SQL statement.</span></span>

## <a name="always-encode-your-output"></a><span data-ttu-id="24ce9-133">Codificare sempre l'output</span><span class="sxs-lookup"><span data-stu-id="24ce9-133">Always encode your output</span></span>

<span data-ttu-id="24ce9-134">Qualsiasi output presentato visivamente o in file deve sempre essere codificato e preceduto da un carattere di escape.</span><span class="sxs-lookup"><span data-stu-id="24ce9-134">Any output you present visually or in files should always be encoded and escaped.</span></span> <span data-ttu-id="24ce9-135">In questo modo ci si protegge in caso di omissioni nel processo di purificazione o qualora il codice generi accidentalmente un elemento che può essere usato per fare danni.</span><span class="sxs-lookup"><span data-stu-id="24ce9-135">This can protect you in case something was missed in the sanitization pass, or the code accidentally generates something that can be used maliciously.</span></span> <span data-ttu-id="24ce9-136">Ci si assicura così che ogni elemento venga visualizzato come _output_ e non venga inavvertitamente interpretato come qualcosa che deve essere eseguito.</span><span class="sxs-lookup"><span data-stu-id="24ce9-136">This will make sure that everything is displayed as _output_ and not inadvertently interpreted as something that should be executed.</span></span> <span data-ttu-id="24ce9-137">Questa è un'altra tecnica di attacco molto comune nota come XSS (Cross-Site Scripting), ossia un attacco tramite script da altri siti.</span><span class="sxs-lookup"><span data-stu-id="24ce9-137">This is another very common attack technique referred to as "Cross-Site Scripting" (XSS).</span></span>

<span data-ttu-id="24ce9-138">Essendo un requisito molto comune, questa è un'altra area in cui ASP.NET può agire automaticamente.</span><span class="sxs-lookup"><span data-stu-id="24ce9-138">Since this is such as common requirement, this is another areas where ASP.NET will do the work for you.</span></span> <span data-ttu-id="24ce9-139">Per impostazione predefinita, [tutto l'output è già codificato](https://docs.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-2.1).</span><span class="sxs-lookup"><span data-stu-id="24ce9-139">By default, [all output is already encoded](https://docs.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-2.1).</span></span> <span data-ttu-id="24ce9-140">Se si usa un altro framework Web, è possibile verificare le opzioni impostate per la codifica dell'output nei siti Web usando le informazioni di riferimento sulla prevenzione degli attacchi XSS sul sito [OWASP](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet).</span><span class="sxs-lookup"><span data-stu-id="24ce9-140">If you are using another web framework, you can verify your options for output encoding on websites with the [OWASP XSS Prevention Cheatsheet](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet).</span></span>

## <a name="summary"></a><span data-ttu-id="24ce9-141">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="24ce9-141">Summary</span></span>

<span data-ttu-id="24ce9-142">La purificazione e la convalida dell'input sono un requisito necessario per assicurarsi che l'input sia valido e possa essere usato e archiviato in tutta sicurezza.</span><span class="sxs-lookup"><span data-stu-id="24ce9-142">Santizing and validating your input is a necessary requirement to ensure your input is valid and safe to use and store.</span></span> <span data-ttu-id="24ce9-143">I framework Web più moderni offrono funzionalità incorporate che consentono di automatizzare parte di questo lavoro. Consultare la documentazione del framework preferito per sapere quali funzionalità offre.</span><span class="sxs-lookup"><span data-stu-id="24ce9-143">Most modern web frameworks offer built-in features which can automate some of this work - make sure to check your preferred framework's documentation and see what features it offers.</span></span> <span data-ttu-id="24ce9-144">Tenere anche presente che, benché questo discorso valga soprattutto per le applicazioni Web, anche altri tipi di applicazioni possono avere problemi simili, quindi non basta scrivere app desktop sicure perché sia sicuro tutto l'ambiente.</span><span class="sxs-lookup"><span data-stu-id="24ce9-144">Also, keep in mind that while the most common place this occurs is in web applications, other types of applications can have similar issues - so don't think you're safe if you are writing that cool desktop app!</span></span> <span data-ttu-id="24ce9-145">È comunque necessario gestire correttamente l'input dell'utente per assicurare che nessuno possa usare l'app per danneggiare i dati o, peggio ancora, la reputazione dell'azienda.</span><span class="sxs-lookup"><span data-stu-id="24ce9-145">You still need to properly handle user input to ensure someone doesn't use your app to corrupt your data, or damage your company's reputation.</span></span>


## <a name="knowledge-check"></a><span data-ttu-id="24ce9-146">Verifica delle conoscenze</span><span class="sxs-lookup"><span data-stu-id="24ce9-146">Knowledge Check</span></span>

<span data-ttu-id="24ce9-147">Quali delle origini dati seguenti devono essere purificate?</span><span class="sxs-lookup"><span data-stu-id="24ce9-147">Which of the following data sources need to be sanitized?</span></span>
* <span data-ttu-id="24ce9-148">Dati di un'API di terze parti</span><span class="sxs-lookup"><span data-stu-id="24ce9-148">Data from a 3rd party API</span></span>
* <span data-ttu-id="24ce9-149">Dati del parametro URL</span><span class="sxs-lookup"><span data-stu-id="24ce9-149">Data from the URL parameter</span></span>
* <span data-ttu-id="24ce9-150">Dati raccolti dall'utente tramite un campo di input</span><span class="sxs-lookup"><span data-stu-id="24ce9-150">Data collected from the user via an input field</span></span>
* <span data-ttu-id="24ce9-151">Tutte le risposte precedenti (risposta corretta)</span><span class="sxs-lookup"><span data-stu-id="24ce9-151">All the above (correct answer)</span></span>

<span data-ttu-id="24ce9-152">Quali dei dati seguenti devono essere codificati prima dell'output?</span><span class="sxs-lookup"><span data-stu-id="24ce9-152">Which of the following data needs to be output encoded?</span></span>
* <span data-ttu-id="24ce9-153">Dati salvati nel database</span><span class="sxs-lookup"><span data-stu-id="24ce9-153">Data saved to the database</span></span>
* <span data-ttu-id="24ce9-154">Dati da visualizzare sullo schermo (risposta corretta)</span><span class="sxs-lookup"><span data-stu-id="24ce9-154">Date to be output to the screen (correct answer)</span></span>
* <span data-ttu-id="24ce9-155">Dati inviati a un'API di terze parti</span><span class="sxs-lookup"><span data-stu-id="24ce9-155">Data sent to a 3rd party API</span></span>
* <span data-ttu-id="24ce9-156">Dati nei parametri URL</span><span class="sxs-lookup"><span data-stu-id="24ce9-156">Data in the URL parameters</span></span>

<span data-ttu-id="24ce9-157">Le query con parametri (stored procedure in SQL) sono sempre una scelta più sicura per comunicare con il database perché:</span><span class="sxs-lookup"><span data-stu-id="24ce9-157">Parameterized queries (stored procedures in SQL) are always a more secure choice for talking to the database because:</span></span>
* <span data-ttu-id="24ce9-158">Sono più organizzate dei comandi di database inline e quindi generano meno confusione negli utenti.</span><span class="sxs-lookup"><span data-stu-id="24ce9-158">They are more organized than inline database commands, and therefore less confusing for users.</span></span>
* <span data-ttu-id="24ce9-159">La stored procedure presenta una chiara struttura dello script, assicurando una maggiore visibilità.</span><span class="sxs-lookup"><span data-stu-id="24ce9-159">There is a clear outline of the script in the stored procedure, ensuring better visibility.</span></span>
* <span data-ttu-id="24ce9-160">I pirati informatici non sono capaci di programmare in SQL.</span><span class="sxs-lookup"><span data-stu-id="24ce9-160">Hackers don’t understand how to program in SQL.</span></span>
* <span data-ttu-id="24ce9-161">Le query con parametri sostituiscono le variabili prima di eseguire le query, impedendo così agli utenti malintenzionati di inserire codice dannoso al posto di una variabile.</span><span class="sxs-lookup"><span data-stu-id="24ce9-161">Parameterized queries substitute variables before running queries, meaning it avoids the opportunity for code to be submitted in place of a variable.</span></span> <span data-ttu-id="24ce9-162">(risposta corretta)</span><span class="sxs-lookup"><span data-stu-id="24ce9-162">(correct answer)</span></span>
