<span data-ttu-id="aede9-101">Ogni funzione deve avere solo un'associazione di trigger,</span><span class="sxs-lookup"><span data-stu-id="aede9-101">Every function must have one, and only one, trigger binding.</span></span> <span data-ttu-id="aede9-102">che definisce in che modo il codice viene attivato per l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="aede9-102">It defines how our code is triggered to run.</span></span> <span data-ttu-id="aede9-103">Oltre a un trigger, è possibile definire associazioni per la connessione alle origini dati.</span><span class="sxs-lookup"><span data-stu-id="aede9-103">In addition to a trigger, we can define bindings that connect us to data sources.</span></span> <span data-ttu-id="aede9-104">Come illustrato nel diagramma della soluzione, si vogliono inviare messaggi a tre code.</span><span class="sxs-lookup"><span data-stu-id="aede9-104">If you remember from our diagram of the solution, we want to send messages to three queues.</span></span> <span data-ttu-id="aede9-105">Pertanto, si definiranno tali connessioni come associazioni di output nella funzione.</span><span class="sxs-lookup"><span data-stu-id="aede9-105">So, we'll define those connections as output bindings in our function.</span></span> <span data-ttu-id="aede9-106">È possibile creare queste associazioni tramite l'interfaccia utente di **Associazione di output**.</span><span class="sxs-lookup"><span data-stu-id="aede9-106">We could create those bindings through the **Output binding** UI.</span></span> <span data-ttu-id="aede9-107">Tuttavia, per risparmiare tempo, il file config verrà modificato direttamente.</span><span class="sxs-lookup"><span data-stu-id="aede9-107">However, to save time, we'll edit the config file directly.</span></span>

1. <span data-ttu-id="aede9-108">Selezionare la funzione [!INCLUDE [func-name-discover](./func-name-discover.md)] nel portale delle app per le funzioni.</span><span class="sxs-lookup"><span data-stu-id="aede9-108">Select our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], in the Function Apps portal.</span></span>

1. <span data-ttu-id="aede9-109">Espandere il menu **Visualizza file** a destra della schermata.</span><span class="sxs-lookup"><span data-stu-id="aede9-109">Expand the **View files** menu on the right of the screen.</span></span>

1. <span data-ttu-id="aede9-110">Nella scheda **Visualizza file** selezionare **function.json** per aprire il file config nell'editor.</span><span class="sxs-lookup"><span data-stu-id="aede9-110">Under the **View files** tab, select **function.json** to open the config file in the editor.</span></span>

1. <span data-ttu-id="aede9-111">Sostituire l'intero contenuto del file config con il codice JSON seguente.</span><span class="sxs-lookup"><span data-stu-id="aede9-111">Replace the entire content of the config file with the following JSON.</span></span> 

[!code-json[](../code/function.json)]

<span data-ttu-id="aede9-112">Sono state aggiunte tre nuove associazioni al file config.</span><span class="sxs-lookup"><span data-stu-id="aede9-112">We've added three new bindings to the config.</span></span>

- <span data-ttu-id="aede9-113">Ogni nuova associazione è di tipo `queue`.</span><span class="sxs-lookup"><span data-stu-id="aede9-113">Each new binding is of type `queue`.</span></span> <span data-ttu-id="aede9-114">Queste associazioni sono per le tre code che saranno popolate con i messaggi di feedback quando se ne conoscerà il sentiment.</span><span class="sxs-lookup"><span data-stu-id="aede9-114">These bindings are for the three queues that we'll populate with our feedback messages to once we know the sentiment of the feedback.</span></span>
- <span data-ttu-id="aede9-115">Ogni associazione ha una direzione definita come `out`, dal momento che i messaggi verranno pubblicati in queste code.</span><span class="sxs-lookup"><span data-stu-id="aede9-115">Each binding has a direction defined as `out`, since we'll post messages to these queues.</span></span>
- <span data-ttu-id="aede9-116">Ogni associazione usa la stessa connessione all'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="aede9-116">Each binding uses the same connection to our storage account.</span></span>
- <span data-ttu-id="aede9-117">Ogni associazione ha un valore univoco `queueName` e `name`.</span><span class="sxs-lookup"><span data-stu-id="aede9-117">Each binding has a unique `queueName` and `name`.</span></span>

<span data-ttu-id="aede9-118">Inviare un messaggio a una coda è estremamente semplice, ad esempio `context.bindings.negativeFeedbackQueueItem = "<message>"`.</span><span class="sxs-lookup"><span data-stu-id="aede9-118">Posting a message to a queue is as easy as saying, for example,  `context.bindings.negativeFeedbackQueueItem = "<message>"`.</span></span>

## <a name="update-implementation-to-sort-feedback-into-queues-based-on-sentiment-score"></a><span data-ttu-id="aede9-119">Aggiornare l'implementazione per ordinare il feedback nelle code in base al punteggio del sentiment</span><span class="sxs-lookup"><span data-stu-id="aede9-119">Update implementation to sort feedback into queues based on sentiment score</span></span>

<span data-ttu-id="aede9-120">L'obiettivo della soluzione per l'ordinamento del feedback è quello di ordinare i commenti in tre bucket, positivi, neutrali e negativi.</span><span class="sxs-lookup"><span data-stu-id="aede9-120">The goal of our feedback sorter is to sort feedback into three buckets, positive, neutral, and negative.</span></span> <span data-ttu-id="aede9-121">Finora si dispone di una coda di input e del codice per chiamare l'API Analisi del testo e sono state definite le code di output.</span><span class="sxs-lookup"><span data-stu-id="aede9-121">So far, we have our input queue, our code to call Text Analytics API, and we've defined our output queues.</span></span> <span data-ttu-id="aede9-122">In questa sezione verrà aggiunta la logica per spostare i messaggi in tali code in base al sentiment.</span><span class="sxs-lookup"><span data-stu-id="aede9-122">In this section, we'll add the logic to move messages into those queues based on sentiment.</span></span>

1. <span data-ttu-id="aede9-123">Passare alla funzione [!INCLUDE [func-name-discover](./func-name-discover.md)] e aprire nuovamente `index.js` nell'editor di codice.</span><span class="sxs-lookup"><span data-stu-id="aede9-123">Navigate to our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], and  open `index.js` in the code editor again.</span></span>

1. <span data-ttu-id="aede9-124">Sostituire l'implementazione con l'aggiornamento seguente.</span><span class="sxs-lookup"><span data-stu-id="aede9-124">Replace the implementation with the following update.</span></span>
[!code-javascript[](../code/discover-sentiment+sort.js?highlight=25-48)]

<span data-ttu-id="aede9-125">Il codice evidenziato è stato aggiunto all'implementazione.</span><span class="sxs-lookup"><span data-stu-id="aede9-125">We've added the highlighted code to our implementation.</span></span> <span data-ttu-id="aede9-126">Il codice analizza la risposta dal servizio cognitivo dell'API Analisi del testo.</span><span class="sxs-lookup"><span data-stu-id="aede9-126">The code parses the response from the Text Analytics API cognitive service.</span></span> <span data-ttu-id="aede9-127">In base al punteggio del sentiment, il messaggio viene inoltrato a una delle tre code di output.</span><span class="sxs-lookup"><span data-stu-id="aede9-127">Based on the sentiment score, the message is forwarded to one of or three output queues.</span></span> <span data-ttu-id="aede9-128">Il codice per inviare il messaggio viene visualizzato semplicemente impostando il parametro di associazione corretto.</span><span class="sxs-lookup"><span data-stu-id="aede9-128">The code to post the message is just setting the correct binding parameter.</span></span>

## <a name="try-it-out"></a><span data-ttu-id="aede9-129">Provare questa operazione</span><span class="sxs-lookup"><span data-stu-id="aede9-129">Try it out</span></span>

<span data-ttu-id="aede9-130">Per testare l'implementazione aggiornata, è necessario tornare in Storage Explorer.</span><span class="sxs-lookup"><span data-stu-id="aede9-130">To test the updated implementation, we'll head back to the Storage Explorer.</span></span> 

1. <span data-ttu-id="aede9-131">Passare al gruppo di risorse nella sezione **Gruppi di risorse** del portale.</span><span class="sxs-lookup"><span data-stu-id="aede9-131">Navigate to your resource group in the **Resource Groups** section of the portal.</span></span>

1. <span data-ttu-id="aede9-132">Selezionare il gruppo di risorse usato in questa lezione.</span><span class="sxs-lookup"><span data-stu-id="aede9-132">Select the resource group used in this lesson.</span></span>

1. <span data-ttu-id="aede9-133">Nel pannello **Gruppo di risorse** che si apre individuare la voce Account di archiviazione e selezionarla.</span><span class="sxs-lookup"><span data-stu-id="aede9-133">In the **Resource group** panel that opens, locate the Storage Account entry and select it.</span></span>
<span data-ttu-id="aede9-134">![Screenshot dell'account di archiviazione selezionato nella finestra Gruppo di risorse.](../media-draft/select-storage-account.png)</span><span class="sxs-lookup"><span data-stu-id="aede9-134">![Screenshot storage account selected in the Resource Group window.](../media-draft/select-storage-account.png)</span></span>

1. <span data-ttu-id="aede9-135">Selezionare **Storage Explorer (anteprima)** dal menu a sinistra della finestra principale di Account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="aede9-135">Select **Storage Explorer (preview)** from the left menu of the Storage Account main window.</span></span>  <span data-ttu-id="aede9-136">Questa azione apre Azure Storage Explorer all'interno del portale.</span><span class="sxs-lookup"><span data-stu-id="aede9-136">This action opens the Azure Storage Explorer inside the portal.</span></span> <span data-ttu-id="aede9-137">La schermata dovrebbe essere simile allo screenshot seguente in questa fase.</span><span class="sxs-lookup"><span data-stu-id="aede9-137">Your screen should look like the following screenshot at this stage.</span></span>
<span data-ttu-id="aede9-138">![Screenshot di Storage Explorer con l'account di archiviazione, attualmente con una coda.](../media-draft/storage-explorer-menu-inputq.png)</span><span class="sxs-lookup"><span data-stu-id="aede9-138">![Screenshot of storage explorer showing our storage account, with one queue currently.](../media-draft/storage-explorer-menu-inputq.png)</span></span>

<span data-ttu-id="aede9-139">Nella raccolta **Code** è elencata una coda.</span><span class="sxs-lookup"><span data-stu-id="aede9-139">We have one queue listed under the **Queues** collection.</span></span> <span data-ttu-id="aede9-140">Si tratta di [!INCLUDE [input-q](./q-name-input.md)], la coda di input definita nella sezione di test precedente del modulo.</span><span class="sxs-lookup"><span data-stu-id="aede9-140">This queue is [!INCLUDE [input-q](./q-name-input.md)],  the input queue we defined in the preceding test section of the module.</span></span>

1. <span data-ttu-id="aede9-141">Selezionare [!INCLUDE [input-q](./q-name-input.md)] nel menu a sinistra per visualizzare Esplora dati per questa coda.</span><span class="sxs-lookup"><span data-stu-id="aede9-141">Select [!INCLUDE [input-q](./q-name-input.md)] in the left-hand menu to see the data explorer for this queue.</span></span> <span data-ttu-id="aede9-142">Come previsto, la coda non contiene dati.</span><span class="sxs-lookup"><span data-stu-id="aede9-142">As expected, the queue had no data.</span></span> <span data-ttu-id="aede9-143">Aggiungere un messaggio alla coda usando il comando **Aggiungi messaggio** nella parte superiore della finestra.</span><span class="sxs-lookup"><span data-stu-id="aede9-143">Let's add a message to the queue using the **Add Message** command at the top of the window.</span></span> 

1. <span data-ttu-id="aede9-144">Nella finestra di dialogo **Aggiungi messaggio** immettere il messaggio "Mi sono divertito con questo esercizio!"</span><span class="sxs-lookup"><span data-stu-id="aede9-144">In the **Add Message** dialog, enter "I'm having fun with this exercise!"</span></span> <span data-ttu-id="aede9-145">nel campo **Testo del messaggio** e fare clic su **OK** nella parte inferiore della finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="aede9-145">into the **Message text** field and click **OK** at the bottom of the dialog.</span></span> 

1. <span data-ttu-id="aede9-146">Il messaggio viene visualizzato nella finestra Dati per [!INCLUDE [input-q](./q-name-input.md)].</span><span class="sxs-lookup"><span data-stu-id="aede9-146">The message is displayed in the data window for [!INCLUDE [input-q](./q-name-input.md)].</span></span> <span data-ttu-id="aede9-147">Dopo alcuni secondi, fare clic su **Aggiorna** nella parte superiore della visualizzazione Dati per aggiornare la visualizzazione della coda.</span><span class="sxs-lookup"><span data-stu-id="aede9-147">After a few seconds, click **Refresh** at the top of the data view to refresh the view of the queue.</span></span> <span data-ttu-id="aede9-148">Si noti che il messaggio scomparirà dopo alcuni secondi.</span><span class="sxs-lookup"><span data-stu-id="aede9-148">Observe that the message disappears after a while.</span></span> <span data-ttu-id="aede9-149">Dove è andato a finire?</span><span class="sxs-lookup"><span data-stu-id="aede9-149">So, where did it go?</span></span>

1. <span data-ttu-id="aede9-150">Fare clic con il pulsante destro del mouse sulla raccolta **CODE** nel menu a sinistra.</span><span class="sxs-lookup"><span data-stu-id="aede9-150">Right-click on the **QUEUES** collection in the left-hand menu.</span></span> <span data-ttu-id="aede9-151">Si osservi che è apparsa una *nuova* coda.</span><span class="sxs-lookup"><span data-stu-id="aede9-151">Observe that a *new* queue has appeared.</span></span>
<span data-ttu-id="aede9-152">![Screenshot di Storage Explorer che mostra che nella raccolta è stata creata una nuova coda.</span><span class="sxs-lookup"><span data-stu-id="aede9-152">![Screenshot of Storage Explorer with showing a new queue has been created in the collection.</span></span> <span data-ttu-id="aede9-153">La coda contiene un messaggio.](../media-draft/sa-new-output-q.png)</span><span class="sxs-lookup"><span data-stu-id="aede9-153">The queue has one message.](../media-draft/sa-new-output-q.png)</span></span>

<span data-ttu-id="aede9-154">La coda [!INCLUDE [positive-q](./q-name-positive.md)] è stata creata automaticamente quando è stato inserito un messaggio per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="aede9-154">The queue [!INCLUDE [positive-q](./q-name-positive.md)] was automatically created when a message was posted to it for the first time.</span></span> <span data-ttu-id="aede9-155">Con le associazioni di output della coda di Funzioni di Azure, non è necessario creare manualmente la coda di output prima di inserirvi dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="aede9-155">With Azure Functions queue output bindings, you don't have to manually create the output queue before posting to it!</span></span> <span data-ttu-id="aede9-156">Ora che il messaggio in arrivo è stato ordinato dalla funzione in [!INCLUDE [positive-q](./q-name-positive.md)], è il momento di vedere dove vanno a finire i messaggi seguenti.</span><span class="sxs-lookup"><span data-stu-id="aede9-156">Now that we see an incoming message has been sorted by our function into [!INCLUDE [positive-q](./q-name-positive.md)], let's see where the following messages land.</span></span>

5. <span data-ttu-id="aede9-157">Usando la stessa procedura precedentemente illustrata, aggiungere i messaggi seguenti a [!INCLUDE [input-q](./q-name-input.md)].</span><span class="sxs-lookup"><span data-stu-id="aede9-157">Using the same steps as above, add the following messages to [!INCLUDE [input-q](./q-name-input.md)].</span></span>

- <span data-ttu-id="aede9-158">"Mi piacciono i broccoli!"</span><span class="sxs-lookup"><span data-stu-id="aede9-158">"I like broccoli!"</span></span>
- <span data-ttu-id="aede9-159">"Microsoft è un'azienda"</span><span class="sxs-lookup"><span data-stu-id="aede9-159">"Microsoft is a company"</span></span>

6. <span data-ttu-id="aede9-160">Fare clic su **Aggiorna** finché [!INCLUDE [input-q](./q-name-input.md)] non è nuovamente vuoto.</span><span class="sxs-lookup"><span data-stu-id="aede9-160">Click **Refresh** until [!INCLUDE [input-q](./q-name-input.md)] is empty once again.</span></span> <span data-ttu-id="aede9-161">Questo processo potrebbe richiedere alcuni istanti e diversi aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="aede9-161">This process might take a few moments and require several refreshes.</span></span>

1. <span data-ttu-id="aede9-162">Fare clic con il pulsante destro del mouse sulla raccolta **CODE** e osservare le due nuove code visualizzate.</span><span class="sxs-lookup"><span data-stu-id="aede9-162">Right-click on the **QUEUES** collection and observe two more queues appearing.</span></span> <span data-ttu-id="aede9-163">Le code sono denominate [!INCLUDE [neutral-q](./q-name-neutral.md)] e [!INCLUDE [negative-q](./q-name-negative.md)].</span><span class="sxs-lookup"><span data-stu-id="aede9-163">The queues are named [!INCLUDE [neutral-q](./q-name-neutral.md)] and [!INCLUDE [negative-q](./q-name-negative.md)].</span></span> <span data-ttu-id="aede9-164">Questa operazione potrebbe richiedere alcuni secondi, pertanto continuare ad aggiornare la raccolta **CODE** fino a visualizzare le nuove code.</span><span class="sxs-lookup"><span data-stu-id="aede9-164">This might take a few seconds, so continue refreshing the **QUEUES** collection until new queues.</span></span> <span data-ttu-id="aede9-165">Al termine, l'elenco delle code dovrebbe essere analogo al seguente.</span><span class="sxs-lookup"><span data-stu-id="aede9-165">When complete, your queue list should look like the following.</span></span>

![Screenshot del menu di Storage Explorer che mostra quattro code nella raccolta CODE.](../media-draft/sa-final-q-list.png)

<span data-ttu-id="aede9-167">Fare clic su ogni coda nell'elenco per verificare se sono presenti messaggi.</span><span class="sxs-lookup"><span data-stu-id="aede9-167">Click on each queue in the list to see whether they have messages.</span></span> <span data-ttu-id="aede9-168">Se sono stati aggiunti i messaggi suggeriti, si noterà un messaggio in [!INCLUDE [positive-q](./q-name-positive.md)], [!INCLUDE [neutral-q](./q-name-neutral.md)] e [!INCLUDE [negative-q](./q-name-negative.md)].</span><span class="sxs-lookup"><span data-stu-id="aede9-168">If you added the suggested messages, you should see one message in [!INCLUDE [positive-q](./q-name-positive.md)], [!INCLUDE [neutral-q](./q-name-neutral.md)], and [!INCLUDE [negative-q](./q-name-negative.md)].</span></span>

<span data-ttu-id="aede9-169">La procedura è stata completata.</span><span class="sxs-lookup"><span data-stu-id="aede9-169">Congratulations!</span></span> <span data-ttu-id="aede9-170">Ora si dispone di una soluzione funzionante per l'ordinamento del feedback.</span><span class="sxs-lookup"><span data-stu-id="aede9-170">We now have a working feedback sorter!</span></span> <span data-ttu-id="aede9-171">Quando i messaggi arrivano nella coda di input, la funzione usa il servizio API Analisi del testo per ottenere un punteggio del sentiment.</span><span class="sxs-lookup"><span data-stu-id="aede9-171">As messages arrive in the input queue, our function uses the Text Analytics API service to get a sentiment score.</span></span> <span data-ttu-id="aede9-172">In base a tale punteggio, la funzione inoltra i messaggi alla coda appropriata.</span><span class="sxs-lookup"><span data-stu-id="aede9-172">Based on that score, the function forwards the messages to the appropriate queue.</span></span> <span data-ttu-id="aede9-173">Anche se sembra che la funzione elabori un solo elemento della coda alla volta, il runtime di Funzioni di Azure leggerà effettivamente i batch degli elementi della coda e avvierà altre istanze della funzione per l'elaborazione in parallelo.</span><span class="sxs-lookup"><span data-stu-id="aede9-173">While it seems like the function processes only one queue item at a time, the Azure Functions runtime will actually read batches of queue items and spin up other instances of our function to process them in parallel.</span></span> 