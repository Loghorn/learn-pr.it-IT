<span data-ttu-id="0b57f-101">Azure Cosmos DB consente agli sviluppatori di scegliere tra cinque modelli di coerenza ben definiti nell'ambito della coerenza: assoluta, decadimento ristretto, sessione, prefisso coerente e finale.</span><span class="sxs-lookup"><span data-stu-id="0b57f-101">Azure Cosmos DB allows developers to choose between five well-defined consistency models along the consistency spectrum – strong, bounded staleness, session, consistent prefix, and eventual.</span></span> <span data-ttu-id="0b57f-102">Questi livelli di coerenza consentono di ottimizzare la disponibilità e prestazioni del database, in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="0b57f-102">These consistency levels enable you to maximize the availability and performance of your database, depending on your needs.</span></span> <span data-ttu-id="0b57f-103">Per i casi in cui i dati devono essere elaborati in un ordine specifico, la coerenza assoluta potrebbe essere la scelta giusta.</span><span class="sxs-lookup"><span data-stu-id="0b57f-103">For cases when data must be processed in a specific order, strong consistency might be the right choice.</span></span> <span data-ttu-id="0b57f-104">In altri casi, se i dati non devono essere subito coerenti, la coerenza finale potrebbe essere la scelta ideale.</span><span class="sxs-lookup"><span data-stu-id="0b57f-104">Or for cases when data doesn't need to be immediately consistent, eventual consistency might be the right choice.</span></span> 

<span data-ttu-id="0b57f-105">In questa unità verranno descritti i livelli di coerenza disponibili in Azure Cosmos DB e verrà determinato il livello di coerenza corretto per un sito di abbigliamento online.</span><span class="sxs-lookup"><span data-stu-id="0b57f-105">In this unit, you'll familiarize yourself with the available consistency levels in Azure Cosmos DB and determine the correct consistency level for your online clothing site.</span></span>

## <a name="consistency-basics"></a><span data-ttu-id="0b57f-106">Nozioni di base di coerenza</span><span class="sxs-lookup"><span data-stu-id="0b57f-106">Consistency basics</span></span>

<span data-ttu-id="0b57f-107">Ogni account di database ha un livello di coerenza predefinito, che determina la coerenza dei dati all'interno dell'account.</span><span class="sxs-lookup"><span data-stu-id="0b57f-107">Each database account has a default consistency level, which determines the consistency of data within the account.</span></span> <span data-ttu-id="0b57f-108">A un'estremità dello spettro si colloca la coerenza assoluta, che offre una garanzia di linearità, ovvero la garanzia che le letture restituiscano la versione più recente di un elemento.</span><span class="sxs-lookup"><span data-stu-id="0b57f-108">At one end of the spectrum is Strong consistency, which offers a linearizability guarantee with the reads guaranteed to return the most recent version of an item.</span></span> <span data-ttu-id="0b57f-109">All'altra estremità del spettro si colloca la coerenza finale, che garantisce che, in assenza di altre scritture, alla fine le repliche all'interno del gruppo convergeranno.</span><span class="sxs-lookup"><span data-stu-id="0b57f-109">At the other end of the spectrum is Eventual consistency, which guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span> <span data-ttu-id="0b57f-110">Al centro troviamo la coerenza di sessione, la più diffusa, poiché garantisce letture uniformi, scritture uniformi e letture delle proprie scritture.</span><span class="sxs-lookup"><span data-stu-id="0b57f-110">In the middle is Session consistency, which is the most popular because it guarantees monotonic reads, monotonic writes, and read your own writes (RYW) guarantees.</span></span>

![I cinque livelli di coerenza in Azure Cosmos DB](../media/5-change-consistency/five-consistency-levels.png)

<span data-ttu-id="0b57f-112">Nella tabella seguente sono elencate le garanzie su ogni livello di coerenza.</span><span class="sxs-lookup"><span data-stu-id="0b57f-112">Guarantees about each consistency level are listed in the following table.</span></span>
 
<span data-ttu-id="0b57f-113">**Livelli di coerenza e garanzie**</span><span class="sxs-lookup"><span data-stu-id="0b57f-113">**Consistency levels and guarantees**</span></span>

| <span data-ttu-id="0b57f-114">Livello di coerenza</span><span class="sxs-lookup"><span data-stu-id="0b57f-114">Consistency Level</span></span> | <span data-ttu-id="0b57f-115">Garanzie</span><span class="sxs-lookup"><span data-stu-id="0b57f-115">Guarantees</span></span> |
| --- | --- |
| <span data-ttu-id="0b57f-116">Assoluta</span><span class="sxs-lookup"><span data-stu-id="0b57f-116">Strong</span></span> | <span data-ttu-id="0b57f-117">Linearità.</span><span class="sxs-lookup"><span data-stu-id="0b57f-117">Linearizability.</span></span> <span data-ttu-id="0b57f-118">Le letture restituiscono sempre la versione più recente di un elemento.</span><span class="sxs-lookup"><span data-stu-id="0b57f-118">Reads are guaranteed to return the most recent version of an item.</span></span>|
| <span data-ttu-id="0b57f-119">Decadimento ristretto</span><span class="sxs-lookup"><span data-stu-id="0b57f-119">Bounded Staleness</span></span> | <span data-ttu-id="0b57f-120">Prefisso coerente.</span><span class="sxs-lookup"><span data-stu-id="0b57f-120">Consistent Prefix.</span></span> <span data-ttu-id="0b57f-121">Ritardo delle letture rispetto alle scritture almeno di prefissi k o intervallo t.</span><span class="sxs-lookup"><span data-stu-id="0b57f-121">Reads lag behind writes by at most k prefixes or t interval.</span></span> |
| <span data-ttu-id="0b57f-122">Sessione</span><span class="sxs-lookup"><span data-stu-id="0b57f-122">Session</span></span>   | <span data-ttu-id="0b57f-123">Prefisso coerente.</span><span class="sxs-lookup"><span data-stu-id="0b57f-123">Consistent Prefix.</span></span> <span data-ttu-id="0b57f-124">Letture uniformi, scritture uniformi, lettura delle proprie scritture, scrittura basata sulle letture.</span><span class="sxs-lookup"><span data-stu-id="0b57f-124">Monotonic reads, monotonic writes, read-your-writes, write-follows-reads.</span></span> |
| <span data-ttu-id="0b57f-125">Prefisso coerente</span><span class="sxs-lookup"><span data-stu-id="0b57f-125">Consistent Prefix</span></span> | <span data-ttu-id="0b57f-126">Gli aggiornamenti restituiti sono un prefisso di tutti gli aggiornamenti, senza interruzioni.</span><span class="sxs-lookup"><span data-stu-id="0b57f-126">Updates returned are some prefix of all the updates, with no gaps.</span></span> |
| <span data-ttu-id="0b57f-127">Finale</span><span class="sxs-lookup"><span data-stu-id="0b57f-127">Eventual</span></span>  | <span data-ttu-id="0b57f-128">Letture non in ordine.</span><span class="sxs-lookup"><span data-stu-id="0b57f-128">Out of order reads.</span></span> |

<span data-ttu-id="0b57f-129">È possibile configurare il livello di coerenza predefinito per l'account Azure Cosmos DB (e successivamente ignorare l'impostazione del livello di coerenza per una specifica richiesta di lettura) nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="0b57f-129">You can configure the default consistency level on your Azure Cosmos DB account (and later override the consistency on a specific read request) in the Azure portal.</span></span> <span data-ttu-id="0b57f-130">Internamente, il livello di coerenza predefinito si applica ai dati all'interno dei set di partizioni che possono estendersi a più aree.</span><span class="sxs-lookup"><span data-stu-id="0b57f-130">Internally, the default consistency level applies to data within the partition sets, which may span regions.</span></span>

<span data-ttu-id="0b57f-131">In Azure Cosmos DB le operazioni di lettura servite con coerenza di sessione, prefisso coerente e finale sono due volte più economiche, in termini di utilizzo di unità richiesta, delle operazioni di lettura con coerenza assoluta o decadimento ristretto.</span><span class="sxs-lookup"><span data-stu-id="0b57f-131">In Azure Cosmos DB, reads served at session, consistent prefix and eventual consistency are twice as cheap, in terms of request unit consumption, as reads with strong or bounded staleness consistency.</span></span>

### <a name="use-of-consistency-levels"></a><span data-ttu-id="0b57f-132">Uso dei livelli di coerenza</span><span class="sxs-lookup"><span data-stu-id="0b57f-132">Use of consistency levels</span></span>

<span data-ttu-id="0b57f-133">Circa il 73% dei tenant di Azure Cosmos DB usa il livello di coerenza sessione e il 20% il livello decadimento ristretto.</span><span class="sxs-lookup"><span data-stu-id="0b57f-133">About 73% of Azure Cosmos DB tenants use session consistency and 20% prefer bounded staleness.</span></span> <span data-ttu-id="0b57f-134">Circa il 3% dei clienti di Azure Cosmos DB sperimenta i vari livelli di coerenza inizialmente prima di decidere quale sia il livello di coerenza specifico più adatto alla propria applicazione.</span><span class="sxs-lookup"><span data-stu-id="0b57f-134">Approximately 3% of Azure Cosmos DB customers experiment with various consistency levels initially before settling on a specific consistency choice for their application.</span></span> <span data-ttu-id="0b57f-135">Solo il 2% dei tenant di Azure Cosmos DB esegue l'override dei livelli di coerenza per ogni richiesta.</span><span class="sxs-lookup"><span data-stu-id="0b57f-135">Only 2% of Azure Cosmos DB tenants override consistency levels on a per request basis.</span></span>

## <a name="consistency-levels-in-detail"></a><span data-ttu-id="0b57f-136">Livelli di coerenza in dettaglio</span><span class="sxs-lookup"><span data-stu-id="0b57f-136">Consistency levels in detail</span></span>

<span data-ttu-id="0b57f-137">Per altre informazioni sui livelli di coerenza, vedere gli esempi di coerenza basati su note musicali disponibili nel portale di Azure, quindi esaminare le informazioni seguenti su ogni livello.</span><span class="sxs-lookup"><span data-stu-id="0b57f-137">To learn more about the consistency levels, review the music-note based consistency examples provided in the Azure portal, then review the information below about each level.</span></span>

1. <span data-ttu-id="0b57f-138">Nel portale di Azure fare clic su **Coerenza predefinita**.</span><span class="sxs-lookup"><span data-stu-id="0b57f-138">In the Azure portal, click **Default consistency**.</span></span>
2. <span data-ttu-id="0b57f-139">Fare clic su ogni modello di coerenza e osservare gli esempi musicali.</span><span class="sxs-lookup"><span data-stu-id="0b57f-139">Click through each of the different consistency models and watch the musical examples.</span></span> <span data-ttu-id="0b57f-140">Notare come i dati vengono scritti nelle varie aree e in che modo la scelta del livello di coerenza influisce sulle modalità di scrittura dei dati di nota.</span><span class="sxs-lookup"><span data-stu-id="0b57f-140">See how data is written to the different regions and how the choice of consistency impacts how the note data is written.</span></span> <span data-ttu-id="0b57f-141">La coerenza assoluta è disattivata, in quanto è disponibile solo per i dati scritti in una singola area.</span><span class="sxs-lookup"><span data-stu-id="0b57f-141">Note that Strong is grayed out as it is only available for data written to a single region.</span></span>

    ![Informazioni sulle impostazioni di coerenza nel portale](../media/5-change-consistency/consistency.gif)

<span data-ttu-id="0b57f-143">Di seguito sono riportate altre informazioni sui livelli di coerenza.</span><span class="sxs-lookup"><span data-stu-id="0b57f-143">Let's learn more about the consistency levels.</span></span> <span data-ttu-id="0b57f-144">Considerare il modo in cui ognuno di questi livelli di coerenza potrebbe operare per i dati utente e di prodotto del sito di abbigliamento.</span><span class="sxs-lookup"><span data-stu-id="0b57f-144">Think about how each of these consistency levels could work for your product and user data for your clothing retail site.</span></span>

### <a name="strong-consistency"></a><span data-ttu-id="0b57f-145">Coerenza assoluta</span><span class="sxs-lookup"><span data-stu-id="0b57f-145">Strong consistency</span></span>

* <span data-ttu-id="0b57f-146">La coerenza assoluta offre una garanzia di [linearità](https://aphyr.com/posts/313-strong-consistency-models) ovvero la garanzia che le letture restituiscano la versione più recente di un elemento.</span><span class="sxs-lookup"><span data-stu-id="0b57f-146">Strong consistency offers a [linearizability](https://aphyr.com/posts/313-strong-consistency-models) guarantee with the reads guaranteed to return the most recent version of an item.</span></span>
* <span data-ttu-id="0b57f-147">la coerenza assoluta garantisce che una scrittura sia visibile solo dopo che ne è stato eseguito il commit in modo permanente dal quorum di maggioranza delle repliche.</span><span class="sxs-lookup"><span data-stu-id="0b57f-147">Strong consistency guarantees that a write is only visible after it is committed durably by the majority quorum of replicas.</span></span> <span data-ttu-id="0b57f-148">Una scrittura può ottenere o il commit sincrono e permanente da parte della replica primaria e della maggioranza delle repliche secondarie o l'interruzione.</span><span class="sxs-lookup"><span data-stu-id="0b57f-148">A write is either synchronously committed durably by both the primary and the quorum of secondaries, or it is aborted.</span></span> <span data-ttu-id="0b57f-149">Una lettura viene sempre confermata dal quorum di maggioranza per le letture: un client non potrà mai vedere una scrittura parziale o di cui non sia stato eseguito il commit e leggerà sempre la più recente scrittura confermata.</span><span class="sxs-lookup"><span data-stu-id="0b57f-149">A read is always acknowledged by the majority read quorum, a client can never see an uncommitted or partial write and is always guaranteed to read the latest acknowledged write.</span></span> 
* <span data-ttu-id="0b57f-150">Gli account Azure Cosmos DB configurati per usare la coerenza assoluta non possono associare più di un'area di Azure con il loro account Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0b57f-150">Azure Cosmos DB accounts that are configured to use strong consistency cannot associate more than one Azure region with their Azure Cosmos DB account.</span></span>  
* <span data-ttu-id="0b57f-151">Il costo di un'operazione di lettura (in termini di unità richiesta usate) con il livello di coerenza assoluta è più alto rispetto ai livelli sessione e finale, ma uguale a quello del livello con decadimento ristretto.</span><span class="sxs-lookup"><span data-stu-id="0b57f-151">The cost of a read operation (in terms of request units consumed) with strong consistency is higher than session and eventual, but the same as bounded staleness.</span></span>

### <a name="bounded-staleness-consistency"></a><span data-ttu-id="0b57f-152">Coerenza con decadimento ristretto</span><span class="sxs-lookup"><span data-stu-id="0b57f-152">Bounded staleness consistency</span></span>

* <span data-ttu-id="0b57f-153">La coerenza con decadimento ristretto garantisce che il ritardo delle letture sulle scritture sia al massimo pari a *K* versioni o prefissi di un elemento o all'intervallo di tempo *t*.</span><span class="sxs-lookup"><span data-stu-id="0b57f-153">Bounded staleness consistency guarantees that the reads may lag behind writes by at most *K* versions or prefixes of an item or *t* time-interval.</span></span>
* <span data-ttu-id="0b57f-154">Pertanto, quando si sceglie il decadimento ristretto, il "decadimento" può essere configurato in due modi: numero di versioni *K* dell'elemento del ritardo delle operazioni di lettura sulle operazioni di scrittura e l'intervallo di tempo *t*.</span><span class="sxs-lookup"><span data-stu-id="0b57f-154">Therefore, when choosing bounded staleness, the "staleness" can be configured in two ways: number of versions *K* of the item by which the reads lag behind the writes, and the time interval *t*.</span></span>
* <span data-ttu-id="0b57f-155">Il decadimento ristretto offre un ordine globale totale tranne all'interno della "finestra di decadimento".</span><span class="sxs-lookup"><span data-stu-id="0b57f-155">Bounded staleness offers total global order except within the "staleness window."</span></span> <span data-ttu-id="0b57f-156">La garanzia di lettura uniforme esiste in un'area sia all'interno che all'esterno della "finestra di decadimento".</span><span class="sxs-lookup"><span data-stu-id="0b57f-156">The monotonic read guarantees exist within a region both inside and outside the "staleness window."</span></span>
* <span data-ttu-id="0b57f-157">Il decadimento ristretto offre una maggiore garanzia di coerenza rispetto alla coerenza di sessione, con prefisso coerente o finale.</span><span class="sxs-lookup"><span data-stu-id="0b57f-157">Bounded staleness provides a stronger consistency guarantee than session, consistent-prefix, or eventual consistency.</span></span> <span data-ttu-id="0b57f-158">Per le applicazioni distribuite a livello globale, è consigliabile usare il decadimento ristretto per gli scenari in cui si vuole una coerenza assoluta, ma anche il 99,99% di disponibilità e bassa latenza.</span><span class="sxs-lookup"><span data-stu-id="0b57f-158">For globally distributed applications, we recommend you use bounded staleness for scenarios where you would like to have strong consistency but also want 99.99% availability and low latency.</span></span>
* <span data-ttu-id="0b57f-159">Gli account Azure Cosmos DB configurati con la coerenza con decadimento ristretto possono associare qualsiasi numero di aree di Azure con il proprio account Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0b57f-159">Azure Cosmos DB accounts that are configured with bounded staleness consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="0b57f-160">Il costo di un'operazione di lettura (in termini di unità richiesta usate) con il decadimento ristretto è più alto rispetto ai livelli sessione e finale, ma uguale a quello del livello assoluto.</span><span class="sxs-lookup"><span data-stu-id="0b57f-160">The cost of a read operation (in terms of RUs consumed) with bounded staleness is higher than session and eventual consistency, but the same as strong consistency.</span></span>

### <a name="session-consistency"></a><span data-ttu-id="0b57f-161">Coerenza di sessione</span><span class="sxs-lookup"><span data-stu-id="0b57f-161">Session consistency</span></span>

* <span data-ttu-id="0b57f-162">A differenza dei modelli di coerenza globale offerti dai livelli di coerenza assoluta e con decadimento ristretto, la coerenza di "sessione" ha come ambito una sessione del client.</span><span class="sxs-lookup"><span data-stu-id="0b57f-162">Unlike the global consistency models offered by strong and bounded staleness consistency levels, session consistency is scoped to a client session.</span></span>
* <span data-ttu-id="0b57f-163">La coerenza di sessione è ideale per tutti gli scenari in cui è coinvolto un dispositivo o una sessione utente poiché garantisce letture monotone, scritture monotone e garanzie di lettura di ciò che si scrive (RYW).</span><span class="sxs-lookup"><span data-stu-id="0b57f-163">Session consistency is ideal for all scenarios where a device or user session is involved since it guarantees monotonic reads, monotonic writes, and read your own writes (RYW) guarantees.</span></span>
* <span data-ttu-id="0b57f-164">La coerenza di sessione offre una coerenza prevedibile per una sessione e la massima velocità di scrittura, con latenza minima per scrittura e lettura.</span><span class="sxs-lookup"><span data-stu-id="0b57f-164">Session consistency provides predictable consistency for a session, and maximum read throughput while offering the lowest latency writes and reads.</span></span>
* <span data-ttu-id="0b57f-165">Gli account Azure Cosmos DB configurati con la coerenza di sessione possono associare qualsiasi numero di aree di Azure con il proprio account Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0b57f-165">Azure Cosmos DB accounts that are configured with session consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span>
* <span data-ttu-id="0b57f-166">Il costo di un'operazione di lettura (in termini di unità richiesta usate) con il livello di coerenza di sessione è minore rispetto ai livelli assoluto e con decadimento ristretto, ma maggiore rispetto al livello finale.</span><span class="sxs-lookup"><span data-stu-id="0b57f-166">The cost of a read operation (in terms of RUs consumed) with session consistency level is less than strong and bounded staleness, but more than eventual consistency.</span></span>

### <a name="consistent-prefix-consistency"></a><span data-ttu-id="0b57f-167">Coerenza con prefisso coerente</span><span class="sxs-lookup"><span data-stu-id="0b57f-167">Consistent prefix consistency</span></span>

* <span data-ttu-id="0b57f-168">Il prefisso coerente garantisce che, in assenza di altre operazioni di scrittura, alla fine le repliche convergeranno all'interno del gruppo.</span><span class="sxs-lookup"><span data-stu-id="0b57f-168">Consistent prefix guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span> 
* <span data-ttu-id="0b57f-169">Il prefisso coerente garantisce che le operazioni di lettura non vedano mai il fuori sequenza delle operazioni di scrittura.</span><span class="sxs-lookup"><span data-stu-id="0b57f-169">Consistent prefix guarantees that reads never see out of order writes.</span></span> <span data-ttu-id="0b57f-170">Se queste sono state eseguite nell'ordine `A, B, C`, il client vede `A`, `A,B` o `A,B,C`, ma mai il fuori sequenza ad esempio `A,C` o `B,A,C`.</span><span class="sxs-lookup"><span data-stu-id="0b57f-170">If writes were performed in the order `A, B, C`, then a client sees either `A`, `A,B`, or `A,B,C`, but never out of order like `A,C` or `B,A,C`.</span></span>
* <span data-ttu-id="0b57f-171">Gli account Azure Cosmos DB configurati con la coerenza con prefisso coerente possono associare qualsiasi numero di aree di Azure con il proprio account Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0b57f-171">Azure Cosmos DB accounts that are configured with consistent prefix consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 

### <a name="eventual-consistency"></a><span data-ttu-id="0b57f-172">Coerenza finale</span><span class="sxs-lookup"><span data-stu-id="0b57f-172">Eventual consistency</span></span>

* <span data-ttu-id="0b57f-173">La coerenza finale garantisce che, in assenza di altre scritture, alla fine le repliche all'interno del gruppo convergeranno.</span><span class="sxs-lookup"><span data-stu-id="0b57f-173">Eventual consistency guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span>
* <span data-ttu-id="0b57f-174">La coerenza finale è la forma più debole di coerenza, in cui un client può ottenere nel tempo valori obsoleti rispetto a quelli già visualizzati in passato.</span><span class="sxs-lookup"><span data-stu-id="0b57f-174">Eventual consistency is the weakest form of consistency where a client may get the values that are older than the ones it had seen before.</span></span>
* <span data-ttu-id="0b57f-175">La coerenza finale rappresenta il livello più debole, ma offre la latenza più bassa sia per le letture sia le per scritture.</span><span class="sxs-lookup"><span data-stu-id="0b57f-175">Eventual consistency provides the weakest read consistency but offers the lowest latency for both reads and writes.</span></span>
* <span data-ttu-id="0b57f-176">Gli account Azure Cosmos DB configurati con la coerenza finale possono associare qualsiasi numero di aree di Azure con il proprio account Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0b57f-176">Azure Cosmos DB accounts that are configured with eventual consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="0b57f-177">Il costo di un'operazione di lettura, in termini di unità richiesta usate, con il livello di coerenza finale è il più basso fra tutti i livelli di coerenza di Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0b57f-177">The cost of a read operation (in terms of RUs consumed) with the eventual consistency level is the lowest of all the Azure Cosmos DB consistency levels.</span></span>

## <a name="summary"></a><span data-ttu-id="0b57f-178">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="0b57f-178">Summary</span></span>

<span data-ttu-id="0b57f-179">In questa unità si è appreso come usare i livelli di coerenza per ottimizzare la disponibilità elevata e ridurre al minimo la latenza.</span><span class="sxs-lookup"><span data-stu-id="0b57f-179">In this unit, you've learned how consistency levels can be used to maximize high-availability and minimize latency.</span></span>