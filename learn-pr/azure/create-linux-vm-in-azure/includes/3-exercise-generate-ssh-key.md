<span data-ttu-id="1cec1-101">Prima di poter creare una macchina virtuale Linux in Azure, è necessario riflettere sull'accesso remoto.</span><span class="sxs-lookup"><span data-stu-id="1cec1-101">Before we can create a Linux virtual machine in Azure, we will need to think about remote access.</span></span> <span data-ttu-id="1cec1-102">Occorre essere in grado di accedere al server Web Linux per configurare il software ed eseguire la manutenzione.</span><span class="sxs-lookup"><span data-stu-id="1cec1-102">We want to be able to sign into our Linux web server to configure the software and perform maintenance.</span></span> <span data-ttu-id="1cec1-103">L'approccio predefinito per amministrare le macchine virtuali Linux ospitate in Azure è SSH.</span><span class="sxs-lookup"><span data-stu-id="1cec1-103">The default approach to administering Linux VMs hosted in Azure is SSH.</span></span>

## <a name="what-is-ssh"></a><span data-ttu-id="1cec1-104">Che cos'è SSH?</span><span class="sxs-lookup"><span data-stu-id="1cec1-104">What is SSH?</span></span>

<span data-ttu-id="1cec1-105">SSH (Secure Shell) è un protocollo per connessioni crittografate che consente accessi protetti su connessioni non sicure.</span><span class="sxs-lookup"><span data-stu-id="1cec1-105">Secure Shell (SSH) is an encrypted connection protocol that allows secure sign-ins over unsecured connections.</span></span> <span data-ttu-id="1cec1-106">SSH consente di connettersi a una shell del terminale da una posizione remota tramite una connessione di rete.</span><span class="sxs-lookup"><span data-stu-id="1cec1-106">SSH allows you to connect to a terminal shell from a remote location using a network connection.</span></span>

<span data-ttu-id="1cec1-107">Esistono due approcci che è possibile usare per autenticare una connessione SSH: **nome utente/password** o una **coppia di chiavi SSH**.</span><span class="sxs-lookup"><span data-stu-id="1cec1-107">There are two approaches we can use to authenticate an SSH connection: \*\* username/password\*\*, or a **SSH key pair**.</span></span> 

> [!TIP]
> <span data-ttu-id="1cec1-108">Sebbene SSH fornisca una connessione crittografata, se si usano password con le connessioni SSH la macchina virtuale rimane vulnerabile agli attacchi di forza bruta o di individuazione delle password.</span><span class="sxs-lookup"><span data-stu-id="1cec1-108">Although SSH provides an encrypted connection, using passwords with SSH connections leaves the VM vulnerable to brute-force attacks or guessing of passwords.</span></span> <span data-ttu-id="1cec1-109">Un metodo più sicuro e preferito per la connessione a una macchina virtuale Linux tramite SSH è con una coppia di chiavi pubblica e privata, dette anche chiavi SSH.</span><span class="sxs-lookup"><span data-stu-id="1cec1-109">A more secure and preferred method of connecting to a Linux VM with SSH is with a public-private key pair, also known as SSH keys.</span></span>

<span data-ttu-id="1cec1-110">Con una coppia di chiavi SSH, è possibile accedere a macchine virtuali di Azure basate su Linux senza una password.</span><span class="sxs-lookup"><span data-stu-id="1cec1-110">With an SSH key pair, you can sign in to Linux-based Azure virtual machines without a password.</span></span> <span data-ttu-id="1cec1-111">Si tratta di un approccio più sicuro, se si intende accedere solo da pochi computer.</span><span class="sxs-lookup"><span data-stu-id="1cec1-111">This is a more secure approach if you only plan to sign into the from a few computers.</span></span> <span data-ttu-id="1cec1-112">Se è necessario essere in grado di accedere alla macchina virtuale Linux da svariate posizioni, una combinazione di nome utente e password potrebbe essere un approccio migliore.</span><span class="sxs-lookup"><span data-stu-id="1cec1-112">If you need to be able to access the Linux VM from a variety of locations, a username and password combination might be a better approach.</span></span> <span data-ttu-id="1cec1-113">Esistono due parti di una coppia di chiavi SSH: una chiave pubblica e una chiave privata.</span><span class="sxs-lookup"><span data-stu-id="1cec1-113">There are two parts to an SSH key pair: a public key, and a private key.</span></span>

* <span data-ttu-id="1cec1-114">La chiave pubblica viene posizionata nella macchina virtuale Linux o in qualsiasi altro servizio che si vuole usare con la crittografia a chiave pubblica.</span><span class="sxs-lookup"><span data-stu-id="1cec1-114">The public key is placed on your Linux VM or any other service that you wish to use with public-key cryptography.</span></span> <span data-ttu-id="1cec1-115">Questa chiave può essere condivisa con chiunque.</span><span class="sxs-lookup"><span data-stu-id="1cec1-115">This can be shared with anyone.</span></span>

* <span data-ttu-id="1cec1-116">La chiave privata è quella che si presenta alla macchina virtuale Linux quando ci si connette a SSH, per verificare la propria identità.</span><span class="sxs-lookup"><span data-stu-id="1cec1-116">The private key is what you present to your Linux VM when you make an SSH connection, to verify your identity.</span></span> <span data-ttu-id="1cec1-117">Considerare questa chiave un'informazione riservata e proteggerla come nel caso di una password o altri dati privati.</span><span class="sxs-lookup"><span data-stu-id="1cec1-117">Consider this confidential information and protect this like you would a password or any other private data.</span></span>

<span data-ttu-id="1cec1-118">È possibile usare la stessa singola coppia di chiavi pubblica e privata per accedere a più macchine virtuali e servizi di Azure.</span><span class="sxs-lookup"><span data-stu-id="1cec1-118">You can use the same single public-private key pair to access multiple Azure VMs and services.</span></span>

## <a name="create-the-ssh-key-pair"></a><span data-ttu-id="1cec1-119">Creare la coppia di chiavi SSH</span><span class="sxs-lookup"><span data-stu-id="1cec1-119">Create the SSH key pair</span></span>

<span data-ttu-id="1cec1-120">In Linux, Windows 10 e MacOS è possibile usare il comando `ssh-keygen` predefinito per generare i file di chiave pubblica e privata SSH.</span><span class="sxs-lookup"><span data-stu-id="1cec1-120">On Linux, Windows 10, and MacOS, you can use the built-in `ssh-keygen` command to generate the SSH public and private key files.</span></span> 

> [!TIP]
> <span data-ttu-id="1cec1-121">Windows 10 include un client SSH con **Fall Creators Update**.</span><span class="sxs-lookup"><span data-stu-id="1cec1-121">Windows 10 includes an SSH client with the **Fall Creators Update**.</span></span> <span data-ttu-id="1cec1-122">Le versioni precedenti di Windows richiedono software aggiuntivo per usare SSH. [Vedere la documentazione per i dettagli completi](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows). In alternativa, è possibile installare il sottosistema Linux per Windows e ottenere la stessa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="1cec1-122">Earlier versions of Windows require additional software to use SSH; [check the documentation for full details](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows) Alternatively, you can install the Linux subsystem for Windows and get the same functionality.</span></span>

> [!NOTE]
> <span data-ttu-id="1cec1-123">Si userà Azure Cloud Shell che archivierà le chiavi generate in Azure nell'account di archiviazione privato.</span><span class="sxs-lookup"><span data-stu-id="1cec1-123">We will use the Azure Cloud Shell which will store the generated keys in Azure in your private storage account.</span></span> <span data-ttu-id="1cec1-124">È anche possibile digitare questi comandi direttamente nella shell locale se si preferisce.</span><span class="sxs-lookup"><span data-stu-id="1cec1-124">You can also type these commands directly into your local shell if you prefer.</span></span> <span data-ttu-id="1cec1-125">Sarà necessario adattare le istruzioni in tutto il modulo a una sessione locale, se si adotta questo approccio.</span><span class="sxs-lookup"><span data-stu-id="1cec1-125">You will need to adjust the instructions throughout this module to reflect a local session if you take this approach.</span></span>

<span data-ttu-id="1cec1-126">Ecco il comando minimo necessario per generare la coppia di chiavi per una macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="1cec1-126">Here is the minimum command necessary to generate the key pair for an Azure VM.</span></span> <span data-ttu-id="1cec1-127">Verrà creata una coppia di chiavi pubblica-privata RSA SSH-2 con una lunghezza di 2048 bit (la lunghezza minima).</span><span class="sxs-lookup"><span data-stu-id="1cec1-127">This will create an SSH protocol 2 (SSH-2) RSA public-private key pair with a 2048 bit length (the minimum length).</span></span> 

<span data-ttu-id="1cec1-128">Digitare questo comando in Cloud Shell.</span><span class="sxs-lookup"><span data-stu-id="1cec1-128">Type this command into the Cloud Shell.</span></span>

```bash
ssh-keygen -t rsa -b 2048
```

<span data-ttu-id="1cec1-129">Lo strumento richiederà i nomi per i file e una passphrase facoltativa.</span><span class="sxs-lookup"><span data-stu-id="1cec1-129">The tool will prompt for filenames and an optional passphrase.</span></span> <span data-ttu-id="1cec1-130">Accettare i valori predefiniti.</span><span class="sxs-lookup"><span data-stu-id="1cec1-130">Just take the defaults.</span></span> <span data-ttu-id="1cec1-131">Verranno creati due file, `id_rsa` e `id_rsa.pub`, nella directory `~/.ssh`.</span><span class="sxs-lookup"><span data-stu-id="1cec1-131">It will create two files: `id_rsa` and `id_rsa.pub` in the `~/.ssh` directory.</span></span> <span data-ttu-id="1cec1-132">I file vengono sovrascritti se esistono.</span><span class="sxs-lookup"><span data-stu-id="1cec1-132">The files are overwritten if they exist.</span></span> <span data-ttu-id="1cec1-133">Sono disponibili diverse opzioni che è possibile usare per specificare il nome del file o una passphrase per evitare la richiesta.</span><span class="sxs-lookup"><span data-stu-id="1cec1-133">There are various options you can use to provide the filename or a passphrase to avoid the prompt.</span></span>

### <a name="private-key-passphrase"></a><span data-ttu-id="1cec1-134">Passphrase per la chiave privata</span><span class="sxs-lookup"><span data-stu-id="1cec1-134">Private key passphrase</span></span>

<span data-ttu-id="1cec1-135">È anche possibile specificare una passphrase facoltativamente durante la generazione della chiave privata.</span><span class="sxs-lookup"><span data-stu-id="1cec1-135">You can optionally provide a passphrase while generating your private key.</span></span> <span data-ttu-id="1cec1-136">Si tratta di una password che è necessario immettere quando si usa la chiave.</span><span class="sxs-lookup"><span data-stu-id="1cec1-136">This is a password you must enter when you use the key.</span></span> <span data-ttu-id="1cec1-137">Questa passphrase viene usata per accedere al file della chiave SSH privata e non è la password dell'account utente.</span><span class="sxs-lookup"><span data-stu-id="1cec1-137">This passphrase is used to access the private SSH key file and is not the user account password.</span></span> 

<span data-ttu-id="1cec1-138">Quando si aggiunge una passphrase alla chiave SSH, la chiave privata viene crittografata con AES a 128 bit, in modo che sia inutilizzabile senza la passphrase per decrittografarla.</span><span class="sxs-lookup"><span data-stu-id="1cec1-138">When you add a passphrase to your SSH key, it encrypts the private key using 128-bit AES, so that the private key is useless without the passphrase to decrypt it.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="1cec1-139">È **vivamente** consigliabile aggiungere una passphrase.</span><span class="sxs-lookup"><span data-stu-id="1cec1-139">It is **strongly** recommended that you add a passphrase.</span></span> <span data-ttu-id="1cec1-140">Se un utente malintenzionato ruba una chiave privata priva di passphrase, può usarla per accedere ai server che hanno la chiave pubblica corrispondente.</span><span class="sxs-lookup"><span data-stu-id="1cec1-140">If an attacker stole your private key and that key did not have a passphrase, they would be able to use that private key to log in to any servers that have the corresponding public key.</span></span> <span data-ttu-id="1cec1-141">Se una chiave privata è protetta da una passphrase, non può essere usata da utenti malintenzionati e rappresenta un livello di sicurezza aggiuntivo per l'infrastruttura in Azure.</span><span class="sxs-lookup"><span data-stu-id="1cec1-141">If a passphrase protects a private key, it cannot be used by that attacker, providing an additional layer of security for your infrastructure on Azure.</span></span>

<span data-ttu-id="1cec1-142">Ecco un esempio che mostra come impostare la passphrase.</span><span class="sxs-lookup"><span data-stu-id="1cec1-142">Here is an example showing how to set the passphrase.</span></span> <span data-ttu-id="1cec1-143">Non è necessario eseguire questo comando (sebbene sia possibile).</span><span class="sxs-lookup"><span data-stu-id="1cec1-143">You don't need to execute this command (although you can if you want).</span></span>

```bash
ssh-keygen -t rsa -b 4096 \
    -C "azureuser@myserver" \
    -f ~/.ssh/mykeys/myprivatekey \
    -N someReallySecurePhraseYouWillRemember
```

| <span data-ttu-id="1cec1-144">Parametro</span><span class="sxs-lookup"><span data-stu-id="1cec1-144">Parameter</span></span> | <span data-ttu-id="1cec1-145">Risultato</span><span class="sxs-lookup"><span data-stu-id="1cec1-145">What it does</span></span> |
|-----------|--------------|
| `-t` | <span data-ttu-id="1cec1-146">Tipo di chiave da creare.</span><span class="sxs-lookup"><span data-stu-id="1cec1-146">Type of key to create.</span></span> <span data-ttu-id="1cec1-147">Deve essere **rsa**.</span><span class="sxs-lookup"><span data-stu-id="1cec1-147">Must be **rsa**.</span></span> |
| `-b` | <span data-ttu-id="1cec1-148">Numero di bit nella chiave.</span><span class="sxs-lookup"><span data-stu-id="1cec1-148">Number of bits in the key.</span></span> <span data-ttu-id="1cec1-149">La lunghezza minima è 2048, quella massima 4096.</span><span class="sxs-lookup"><span data-stu-id="1cec1-149">Minimum length is 2048; maximum is 4096.</span></span> |
| `-C` | <span data-ttu-id="1cec1-150">Commento facoltativo da aggiungere alla chiave pubblica che può essere usato per facilitarne l'identificazione.</span><span class="sxs-lookup"><span data-stu-id="1cec1-150">An optional comment to append to the public key that can be used to identify it.</span></span> <span data-ttu-id="1cec1-151">Si tratta in genere di un indirizzo di posta elettronica, ma è testo semplice ed è possibile usare il metodo di identificazione preferito.</span><span class="sxs-lookup"><span data-stu-id="1cec1-151">Normally this is an email address, but it's simple text, and you can use whatever identification method you prefer.</span></span> |
| `-f` | <span data-ttu-id="1cec1-152">Percorso e nome del file della chiave privata.</span><span class="sxs-lookup"><span data-stu-id="1cec1-152">The location and filename of the private key file.</span></span> <span data-ttu-id="1cec1-153">Un file di chiave pubblica corrispondente con estensione **pub** viene generato nella stessa directory.</span><span class="sxs-lookup"><span data-stu-id="1cec1-153">A corresponding public key file appended with **.pub** is generated in the same directory.</span></span> <span data-ttu-id="1cec1-154">La directory deve esistere.</span><span class="sxs-lookup"><span data-stu-id="1cec1-154">The directory must exist.</span></span> |
| `-N` | <span data-ttu-id="1cec1-155">Passphrase usata per crittografare la chiave privata.</span><span class="sxs-lookup"><span data-stu-id="1cec1-155">The passphrase used to encrypt the private key.</span></span> |

## <a name="use-the-ssh-key-pair-with-an-azure-linux-vm"></a><span data-ttu-id="1cec1-156">Usare la coppia di chiavi SSH con una macchina virtuale Linux di Azure</span><span class="sxs-lookup"><span data-stu-id="1cec1-156">Use the SSH key pair with an Azure Linux VM</span></span>

<span data-ttu-id="1cec1-157">Dopo aver generato la coppia di chiavi, è possibile usarla con una macchina virtuale Linux in Azure.</span><span class="sxs-lookup"><span data-stu-id="1cec1-157">Once you have the key pair generated, you can use it with a Linux VM in Azure.</span></span> <span data-ttu-id="1cec1-158">È possibile fornire la chiave pubblica durante la creazione della macchina virtuale o aggiungerla dopo aver creato la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="1cec1-158">You can supply the public key during the VM creation, or add it after the VM has been created.</span></span> 

<span data-ttu-id="1cec1-159">È possibile visualizzare i contenuti del file in Azure Cloud Shell con il comando seguente.</span><span class="sxs-lookup"><span data-stu-id="1cec1-159">You can view the contents of the file in the Azure Cloud Shell with the following command.</span></span>

```bash
cat ~/.ssh/id_rsa.pub
```

<span data-ttu-id="1cec1-160">Sarà una singola riga simile a:</span><span class="sxs-lookup"><span data-stu-id="1cec1-160">It will be a single line and look something like:</span></span>

```output
ssh-rsa XXXXXXXXXXc2EAAAADAXABAAABAXC5Am7+fGZ+5zXBGgXS6GUvmsXCLGc7tX7/rViXk3+eShZzaXnt75gUmT1I2f75zFn2hlAIDGKWf4g12KWcZxy81TniUOTjUsVlwPymXUXxESL/UfJKfbdstBhTOdy5EG9rYWA0K43SJmwPhH28BpoLfXXXXXGX/ilsXXXXXKgRLiJ2W19MzXHp8z3Lxw7r9wx3HaVlP4XiFv9U4hGcp8RMI1MP1nNesFlOBpG4pV2bJRBTXNXeY4l6F8WZ3C4kuf8XxOo08mXaTpvZ3T1841altmNTZCcPkXuMrBjYSJbA8npoXAXNwiivyoe3X2KMXXXXXdXXXXXXXXXXCXXXXX/ azureuser@myserver
```

<span data-ttu-id="1cec1-161">Copiare questo valore in modo da poterlo usare nel prossimo esercizio.</span><span class="sxs-lookup"><span data-stu-id="1cec1-161">Copy this value off so you can use it in the next exercise.</span></span>

### <a name="use-the-ssh-key-when-creating-a-linux-vm"></a><span data-ttu-id="1cec1-162">Usare la chiave SSH durante la creazione di una macchina virtuale Linux</span><span class="sxs-lookup"><span data-stu-id="1cec1-162">Use the SSH key when creating a Linux VM</span></span>

<span data-ttu-id="1cec1-163">Per applicare la chiave SSH durante la creazione di una nuova macchina virtuale Linux, sarà necessario copiare il contenuto della chiave pubblica e specificarlo nel portale di Azure _oppure_ specificare il file di chiave pubblica per il comando dell'interfaccia della riga di comando di Azure o di Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="1cec1-163">To apply the SSH key while creating a new Linux VM, you will need to copy the contents of the public key and supply it to the Azure portal, _or_ supply the public key file to the Azure CLI or Azure PowerShell command.</span></span> <span data-ttu-id="1cec1-164">Si userà questo approccio durante la creazione della macchina virtuale Linux.</span><span class="sxs-lookup"><span data-stu-id="1cec1-164">We'll use this approach when we create our Linux VM.</span></span>

### <a name="add-the-ssh-key-to-an-existing-linux-vm"></a><span data-ttu-id="1cec1-165">Aggiungere la chiave SSH a una macchina virtuale Linux esistente</span><span class="sxs-lookup"><span data-stu-id="1cec1-165">Add the SSH key to an existing Linux VM</span></span>

<span data-ttu-id="1cec1-166">Se è già stata creata una macchina virtuale, è possibile installare la chiave pubblica nella macchina virtuale Linux con il comando `ssh-copy-id`.</span><span class="sxs-lookup"><span data-stu-id="1cec1-166">If you have already created a VM, you can install the public key onto your Linux VM with the `ssh-copy-id` command.</span></span> <span data-ttu-id="1cec1-167">Una volta autorizzata per SSH, la chiave concede l'accesso al server senza una password.</span><span class="sxs-lookup"><span data-stu-id="1cec1-167">Once the key has been authorized for SSH, it grants access to the server without a password.</span></span>

<span data-ttu-id="1cec1-168">Passare il file di chiave pubblica e il nome utente da associare alla chiave.</span><span class="sxs-lookup"><span data-stu-id="1cec1-168">Pass it the public key file and the username to associate with the key.</span></span>

```bash
ssh-copy-id -i ~/.ssh/id_rsa.pub azureuser@myserver
```
<span data-ttu-id="1cec1-169">Ora che è disponibile la chiave pubblica è possibile passare al portale di Azure e creare una macchina virtuale Linux.</span><span class="sxs-lookup"><span data-stu-id="1cec1-169">Now that we have our public key let's switch to the Azure portal and create a Linux VM.</span></span>

