<span data-ttu-id="a6433-101">Il server è pronto per l'elaborazione dei dati video. Resta solo da aprire le porte che verranno usate dalle telecamere del traffico per caricare i file video nel server.</span><span class="sxs-lookup"><span data-stu-id="a6433-101">Our server is ready to process video data; the last thing we need to do is open the ports that the traffic cameras will use to upload video files to our server.</span></span> 

## <a name="create-a-network-security-group"></a><span data-ttu-id="a6433-102">Creare un gruppo di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="a6433-102">Create a network security group</span></span>

<span data-ttu-id="a6433-103">Azure dovrebbe aver creato un gruppo di sicurezza perché si era indicato di volere l'accesso Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="a6433-103">Azure should have created a security group for us because we indicated we wanted Remote Desktop access.</span></span> <span data-ttu-id="a6433-104">Verrà tuttavia creato un nuovo gruppo di sicurezza per poter eseguire l'intero processo.</span><span class="sxs-lookup"><span data-stu-id="a6433-104">But let's create a new security group so you can walk through the entire process.</span></span> <span data-ttu-id="a6433-105">Questo è particolarmente importante se si decide di creare la rete virtuale _prima_ delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="a6433-105">This is particularly important if you decide to create your virtual network _before_ your VMs.</span></span> <span data-ttu-id="a6433-106">Come indicato in precedenza, i gruppi di sicurezza sono _facoltativi_ e non vengono necessariamente creati con la rete.</span><span class="sxs-lookup"><span data-stu-id="a6433-106">As mentioned earlier, security groups are _optional_ and not necessarily created with the network.</span></span>

> [!NOTE]
> <span data-ttu-id="a6433-107">Poiché si _presume_ che questa sia la seconda macchina virtuale, sarà già disponibile un gruppo di sicurezza da applicare alla rete, ma si supponga per un momento che non sia così o che le regole per questa macchina virtuale siano diverse.</span><span class="sxs-lookup"><span data-stu-id="a6433-107">Since this is _supposed_ to be the second VM, we would already have a security group to apply to our network, but let's pretend for a moment that we don't, or that the rules are different for this VM.</span></span>

1. <span data-ttu-id="a6433-108">Nel [portale di Azure](https://portal.azure.com?azure-portal=true) fare clic sul pulsante **Crea una risorsa** nella barra laterale nell'angolo a sinistra per avviare la creazione di una nuova risorsa.</span><span class="sxs-lookup"><span data-stu-id="a6433-108">In the [Azure portal](https://portal.azure.com?azure-portal=true), click the **Create a resource** button in the left corner sidebar to start a new resource creation.</span></span>

1. <span data-ttu-id="a6433-109">Digitare "Gruppo di sicurezza di rete" nella casella del filtro e selezionare l'elemento corrispondente nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="a6433-109">Type "Network security group" into the filter box and select the matching item in the list.</span></span>

1. <span data-ttu-id="a6433-110">Verificare che sia selezionato il modello di distribuzione **Resource Manager** e fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="a6433-110">Make sure the **Resource Manager** deployment model is selected and click **Create**.</span></span>

1. <span data-ttu-id="a6433-111">Fornire un **nome** per il gruppo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="a6433-111">Provide a **Name** for your security group.</span></span> <span data-ttu-id="a6433-112">Anche in questo caso, sono utili le convenzioni di denominazione. Si userà "test-vp-nsg2" per "Test Video Processor Network Security Group #2".</span><span class="sxs-lookup"><span data-stu-id="a6433-112">Again, naming conventions are a good idea here, let's use "test-vp-nsg2" for "Test Video Processor Network Security Group #2".</span></span>

1. <span data-ttu-id="a6433-113">Selezionare la **sottoscrizione** appropriata e usare il **gruppo di risorse** esistente.</span><span class="sxs-lookup"><span data-stu-id="a6433-113">Select the proper **Subscription** and use your existing **Resource group**.</span></span>

1. <span data-ttu-id="a6433-114">Inserirlo infine nella stessa **località** della macchina virtuale/rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="a6433-114">Finally, put it into the same **Location** as the VM / Virtual Network.</span></span> <span data-ttu-id="a6433-115">Questa operazione è importante perché non sarà possibile applicare questa risorsa se si trova in una località diversa.</span><span class="sxs-lookup"><span data-stu-id="a6433-115">This is important - you won't be able to apply this resource if it's in a different location.</span></span>

1. <span data-ttu-id="a6433-116">Fare clic su **Crea** per creare il gruppo.</span><span class="sxs-lookup"><span data-stu-id="a6433-116">Click **Create** to create the group.</span></span>

## <a name="add-a-new-inbound-rule-to-our-network-security-group"></a><span data-ttu-id="a6433-117">Aggiungere una nuova regola in ingresso al gruppo di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="a6433-117">Add a new inbound rule to our Network Security Group</span></span>

<span data-ttu-id="a6433-118">La distribuzione verrà completata rapidamente.</span><span class="sxs-lookup"><span data-stu-id="a6433-118">Deployment should complete quickly.</span></span>

1. <span data-ttu-id="a6433-119">Trovare la nuova risorsa gruppo di sicurezza e selezionarla nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="a6433-119">Find the new security group resource and select it in the Azure portal.</span></span>

1. <span data-ttu-id="a6433-120">Nella pagina Panoramica si noterà che sono state create alcune regole predefinite create per bloccare la rete.</span><span class="sxs-lookup"><span data-stu-id="a6433-120">On the overview page, you'll find that it has some default rules created to lock down the network.</span></span>

    <span data-ttu-id="a6433-121">Sul lato in ingresso:</span><span class="sxs-lookup"><span data-stu-id="a6433-121">On the inbound side:</span></span>

    - <span data-ttu-id="a6433-122">Tutto il traffico in ingresso da una rete virtuale a un'altra è consentito.</span><span class="sxs-lookup"><span data-stu-id="a6433-122">All inbound traffic from one VNet to another is allowed.</span></span> <span data-ttu-id="a6433-123">In questo modo le risorse nella rete virtuale possono comunicare tra di esse.</span><span class="sxs-lookup"><span data-stu-id="a6433-123">This lets resources on the VNet talk to each other.</span></span>
    - <span data-ttu-id="a6433-124">Il "probe" di Azure Load Balancer richiede di verificare che la macchina virtuale sia attiva</span><span class="sxs-lookup"><span data-stu-id="a6433-124">Azure Load balancer "probe" requests to ensure the VM is alive</span></span>
    - <span data-ttu-id="a6433-125">Tutto il traffico in ingresso viene rifiutato.</span><span class="sxs-lookup"><span data-stu-id="a6433-125">All other inbound traffic is denied.</span></span>
    <span data-ttu-id="a6433-126">Sul lato in uscita:</span><span class="sxs-lookup"><span data-stu-id="a6433-126">On the outbound side:</span></span>
    - <span data-ttu-id="a6433-127">Tutto il traffico nella rete virtuale è consentito.</span><span class="sxs-lookup"><span data-stu-id="a6433-127">All in-network traffic on the VNet is allowed.</span></span>
    - <span data-ttu-id="a6433-128">Tutto il traffico in uscita verso Internet è consentito.</span><span class="sxs-lookup"><span data-stu-id="a6433-128">All outbound traffic to the Internet is allowed.</span></span>
    - <span data-ttu-id="a6433-129">Tutto il traffico in uscita di altro tipo viene rifiutato.</span><span class="sxs-lookup"><span data-stu-id="a6433-129">All other outbound traffic is denied.</span></span>

> [!NOTE]
> <span data-ttu-id="a6433-130">Queste regole predefinite vengono impostate con valori di priorità elevata e quindi vengono valutate per _ultime_.</span><span class="sxs-lookup"><span data-stu-id="a6433-130">These default rules are set with high priority values, which means that they get evaluated _last_.</span></span> <span data-ttu-id="a6433-131">Non possono essere modificate o eliminate, ma è possibile eseguirne l'_override_ creando regole più specifiche per il traffico con un valore di priorità più basso.</span><span class="sxs-lookup"><span data-stu-id="a6433-131">They cannot be changed or deleted, but you can _override_ them by creating more specific rules to match your traffic with a lower priority value.</span></span>

1. <span data-ttu-id="a6433-132">Fare clic sulla sezione **Regole di sicurezza in ingresso** nel pannello **Impostazioni** del gruppo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="a6433-132">Click the **Inbound security rules** section in the **Settings** panel for the security group.</span></span>

1. <span data-ttu-id="a6433-133">Fare clic su **+ Aggiungi** per aggiungere una nuova regola di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="a6433-133">Click **+ Add** to add a new security rule.</span></span>

    ![Aggiungere una regola di sicurezza](../media-drafts/8-add-rule.png)

    <span data-ttu-id="a6433-135">Esistono due modi per immettere le informazioni necessarie per una regola di sicurezza: di base e avanzato.</span><span class="sxs-lookup"><span data-stu-id="a6433-135">There are two ways to enter the information necessary for a security rule: basic and advanced.</span></span> <span data-ttu-id="a6433-136">È possibile passare da uno all'altro facendo clic sul pulsante nella parte superiore del pannello "Aggiungi".</span><span class="sxs-lookup"><span data-stu-id="a6433-136">You can switch between them by clicking the button at the top of the "add" panel.</span></span>

    ![Input della regola di base e avanzato](../media-drafts/8-advanced-create-rule.png)

    <span data-ttu-id="a6433-138">La modalità avanzata offre la possibilità di personalizzare completamente la regola. Se tuttavia è sufficiente configurare un protocollo noto, è più semplice usare la modalità di base.</span><span class="sxs-lookup"><span data-stu-id="a6433-138">The advanced mode provides the ability to completely customize the rule, however, if you just need to configure a known protocol, the basic mode is a bit easier to work with.</span></span>

1. <span data-ttu-id="a6433-139">Passare alla modalità di base.</span><span class="sxs-lookup"><span data-stu-id="a6433-139">Switch to the Basic mode.</span></span>

1. <span data-ttu-id="a6433-140">Aggiungere le informazioni per la regola FTP.</span><span class="sxs-lookup"><span data-stu-id="a6433-140">Add the information for our FTP rule.</span></span>

    - <span data-ttu-id="a6433-141">Impostare il **servizio** su FTP.</span><span class="sxs-lookup"><span data-stu-id="a6433-141">Set the **Service** to be FTP.</span></span> <span data-ttu-id="a6433-142">Verrà automaticamente configurato l'intervallo di porte.</span><span class="sxs-lookup"><span data-stu-id="a6433-142">This will set your port range up for you.</span></span>
    - <span data-ttu-id="a6433-143">Impostare la **priorità** su "1000".</span><span class="sxs-lookup"><span data-stu-id="a6433-143">Set the **Priority** to "1000".</span></span> <span data-ttu-id="a6433-144">Deve essere un numero più basso di quello della regola predefinita **Nega**.</span><span class="sxs-lookup"><span data-stu-id="a6433-144">It has to be a lower number than the default **Deny** rule.</span></span> <span data-ttu-id="a6433-145">È possibile far iniziare l'intervallo con qualsiasi valore, ma è consigliabile fare in modo di poter creare un'eccezione in un secondo momento, se necessario.</span><span class="sxs-lookup"><span data-stu-id="a6433-145">You can start the range at any value, but it's recommended you give yourself some space in case an exception needs to be created later.</span></span>
    - <span data-ttu-id="a6433-146">Assegnare un nome alla regola, ad esempio "traffic-cam-ftp-upload-2".</span><span class="sxs-lookup"><span data-stu-id="a6433-146">Give the rule a name, we'll use "traffic-cam-ftp-upload-2".</span></span>
    - <span data-ttu-id="a6433-147">Assegnare alla regola una descrizione.</span><span class="sxs-lookup"><span data-stu-id="a6433-147">Give the rule a description.</span></span>

1. <span data-ttu-id="a6433-148">Tornare alla modalità **avanzata**.</span><span class="sxs-lookup"><span data-stu-id="a6433-148">Switch back to the **Advanced** mode.</span></span> <span data-ttu-id="a6433-149">Si noti che le impostazioni sono ancora presenti.</span><span class="sxs-lookup"><span data-stu-id="a6433-149">Notice that our settings are still present.</span></span> <span data-ttu-id="a6433-150">È possibile usare questo pannello per creare impostazioni con granularità più fine.</span><span class="sxs-lookup"><span data-stu-id="a6433-150">We can use this panel to create more fine-grained settings.</span></span> <span data-ttu-id="a6433-151">In particolare, l'**origine** deve essere un indirizzo IP specifico o un intervallo di indirizzi IP specifici delle telecamere.</span><span class="sxs-lookup"><span data-stu-id="a6433-151">In particular, we would likely restrict the **Source** to be a specific IP address or range of IP addresses specific to the cameras.</span></span> <span data-ttu-id="a6433-152">Se si conosce l'indirizzo IP corrente del computer locale, è possibile provare a usarlo.</span><span class="sxs-lookup"><span data-stu-id="a6433-152">If you know the current IP address of your local computer, you can try that.</span></span> <span data-ttu-id="a6433-153">In caso contrario, lasciare l'impostazione "Qualsiasi" in modo che sia possibile testare la regola.</span><span class="sxs-lookup"><span data-stu-id="a6433-153">Otherwise, leave the setting as "Any" so you can test the rule.</span></span>

1. <span data-ttu-id="a6433-154">Fare clic su **Aggiungi** per creare la regola.</span><span class="sxs-lookup"><span data-stu-id="a6433-154">Click **Add** to create the rule.</span></span> <span data-ttu-id="a6433-155">L'elenco di regole in ingresso verrà aggiornato. Si noti che sono in ordine di priorità, ovvero l'ordine in cui verranno esaminate.</span><span class="sxs-lookup"><span data-stu-id="a6433-155">This will update the list of inbound rules - notice they are in priority order, which is how they will be examined.</span></span>
    
## <a name="apply-the-security-group"></a><span data-ttu-id="a6433-156">Applicare il gruppo di sicurezza</span><span class="sxs-lookup"><span data-stu-id="a6433-156">Apply the security group</span></span>

<span data-ttu-id="a6433-157">Si ricordi che è possibile applicare il gruppo di sicurezza a un'interfaccia di rete per proteggere una singola macchina virtuale o a una subnet per applicarlo a tutte le risorse in tale subnet.</span><span class="sxs-lookup"><span data-stu-id="a6433-157">Recall that we can apply the security group to a network interface to guard a single VM, or to a subnet where it would apply to any resources on that subnet.</span></span> <span data-ttu-id="a6433-158">Si userà il secondo approccio, che è il più comune.</span><span class="sxs-lookup"><span data-stu-id="a6433-158">The latter approach tends to be the most common so let's do that.</span></span> <span data-ttu-id="a6433-159">È possibile accedere a questa risorsa in Azure tramite la risorsa di rete virtuale o indirettamente tramite la macchina virtuale che usa la rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="a6433-159">We could get to this resource in Azure through either the virtual network resource or indirectly through the VM which is using the virtual network.</span></span>

1. <span data-ttu-id="a6433-160">Passare al pannello **Panoramica** per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a6433-160">Switch to the **Overview** panel for the virtual machine.</span></span> <span data-ttu-id="a6433-161">È possibile trovare la macchina virtuale in **Tutte le risorse**.</span><span class="sxs-lookup"><span data-stu-id="a6433-161">You can find the VM under **All Resources**.</span></span>

1. <span data-ttu-id="a6433-162">Selezionare l'elemento **Rete** nella sezione **Impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="a6433-162">Select the **Networking** item in the **Settings** section.</span></span>

    ![Elemento Rete nelle impostazioni della macchina virtuale](../media-drafts/8-network-settings.png)

1. <span data-ttu-id="a6433-164">Nelle proprietà della rete sono disponibili informazioni sulla rete applicata alla macchina virtuale, tra cui la **rete virtuale/subnet**.</span><span class="sxs-lookup"><span data-stu-id="a6433-164">In the networking properties, you will find information about the networking applied to the VM including the **Virtual network/subnet**.</span></span> <span data-ttu-id="a6433-165">Questo è un collegamento su cui è possibile fare clic per ottenere la risorsa.</span><span class="sxs-lookup"><span data-stu-id="a6433-165">This is a clickable link to get to the resource.</span></span> <span data-ttu-id="a6433-166">Fare clic per aprire la rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="a6433-166">Click it to open the virtual network.</span></span> <span data-ttu-id="a6433-167">Questo collegamento è disponibile _anche_ nel pannello **Panoramica** della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a6433-167">This link is _also_ available on the **Overview** panel of the VM.</span></span> <span data-ttu-id="a6433-168">Entrambi i collegamenti apriranno la **panoramica** della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="a6433-168">Either of these will open the **Overview** of the virtual network.</span></span>

1. <span data-ttu-id="a6433-169">Nella sezione **Impostazioni** selezionare l'elemento **Subnet**.</span><span class="sxs-lookup"><span data-stu-id="a6433-169">In the **Settings** section, select the **Subnets** item.</span></span>

1. <span data-ttu-id="a6433-170">Dovrebbe essere presente una sola subnet definita (predefinita) da quando prima sono state create la macchina virtuale e la rete.</span><span class="sxs-lookup"><span data-stu-id="a6433-170">We should have a single subnet defined (default) from when we created the VM + network earlier.</span></span> <span data-ttu-id="a6433-171">Fare clic sull'elemento nell'elenco per aprire i dettagli.</span><span class="sxs-lookup"><span data-stu-id="a6433-171">Click the item in the list to open the details.</span></span>

1. <span data-ttu-id="a6433-172">Fare clic sulla voce **Gruppo di sicurezza di rete**.</span><span class="sxs-lookup"><span data-stu-id="a6433-172">Click the **Network security group** entry.</span></span>

1. <span data-ttu-id="a6433-173">Selezionare il nuovo gruppo di sicurezza: **test-vp-nsg2**.</span><span class="sxs-lookup"><span data-stu-id="a6433-173">Select your new security group: **test-vp-nsg2**.</span></span>

1. <span data-ttu-id="a6433-174">Fare clic su **Salva** per salvare la modifica.</span><span class="sxs-lookup"><span data-stu-id="a6433-174">Click **Save** to save the change.</span></span> <span data-ttu-id="a6433-175">L'applicazione alla rete richiederà un minuto.</span><span class="sxs-lookup"><span data-stu-id="a6433-175">It will take a minute to apply to the network.</span></span>

## <a name="verify-the-rules"></a><span data-ttu-id="a6433-176">Verificare le regole</span><span class="sxs-lookup"><span data-stu-id="a6433-176">Verify the rules</span></span>

<span data-ttu-id="a6433-177">La modifica verrà ora convalidata.</span><span class="sxs-lookup"><span data-stu-id="a6433-177">Let's validate the change.</span></span>

1. <span data-ttu-id="a6433-178">Tornare al pannello **Panoramica** per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a6433-178">Switch back to the **Overview** panel for the virtual machine.</span></span> <span data-ttu-id="a6433-179">È possibile trovare la macchina virtuale in **Tutte le risorse**.</span><span class="sxs-lookup"><span data-stu-id="a6433-179">You can find the VM under **All Resources**.</span></span>

1. <span data-ttu-id="a6433-180">Selezionare l'elemento **Rete** nella sezione **Impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="a6433-180">Select the **Networking** item in the **Settings** section.</span></span>

1. <span data-ttu-id="a6433-181">Nel pannello **Panoramica** della rete è presente un collegamento \*\*Regole di sicurezza effettive che consente di visualizzare rapidamente come verranno valutate le regole.</span><span class="sxs-lookup"><span data-stu-id="a6433-181">In the **Overview** panel for the network, there is a link for \*\*Effective security rules that will quickly show you how rules are going to be evaluated.</span></span> <span data-ttu-id="a6433-182">Fare clic sul collegamento per aprire l'analisi e assicurarsi che venga visualizzata la regola FTP.</span><span class="sxs-lookup"><span data-stu-id="a6433-182">Click the link to open the analysis and make sure you see your FTP rule.</span></span>

    ![Regole di sicurezza effettive per la rete](../media-drafts/8-effective-rules.png)

1. <span data-ttu-id="a6433-184">Se è stato installato il ruolo del server FTP, ora sarà possibile connettersi all'endpoint FTP.</span><span class="sxs-lookup"><span data-stu-id="a6433-184">If you installed the FTP server role, you should be able to connect to the FTP endpoint now.</span></span> <span data-ttu-id="a6433-185">Provare.</span><span class="sxs-lookup"><span data-stu-id="a6433-185">Try it out.</span></span>

## <a name="one-more-thing"></a><span data-ttu-id="a6433-186">Ultimo passaggio</span><span class="sxs-lookup"><span data-stu-id="a6433-186">One more thing</span></span>

<span data-ttu-id="a6433-187">Le regole di sicurezza sono difficili da configurare correttamente.</span><span class="sxs-lookup"><span data-stu-id="a6433-187">Security rules are tricky to get right.</span></span> <span data-ttu-id="a6433-188">In realtà è stato commesso un errore quando si è applicato questo nuovo gruppo di sicurezza perché si è perso l'accesso Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="a6433-188">We actually made a mistake when we applied this new security group - we lost our Remote Desktop access!</span></span> <span data-ttu-id="a6433-189">Per risolvere questo problema, è possibile aggiungere un'altra regola al gruppo di sicurezza per supportare l'accesso RDP.</span><span class="sxs-lookup"><span data-stu-id="a6433-189">To fix this, you can add another rule to the security group to support RDP access.</span></span> <span data-ttu-id="a6433-190">Assicurarsi di limitare gli indirizzi TCP/IP in ingresso per la regola a quelli di cui si è proprietari.</span><span class="sxs-lookup"><span data-stu-id="a6433-190">Make sure to restrict the inbound TCP/IP addresses for the rule to be the ones you own.</span></span>

> [!WARNING]
> <span data-ttu-id="a6433-191">Assicurarsi sempre di bloccare le porte usate per l'accesso amministrativo.</span><span class="sxs-lookup"><span data-stu-id="a6433-191">Always make sure to lock down ports used for administrative access.</span></span> <span data-ttu-id="a6433-192">Un approccio ancora migliore consiste nel creare una VPN per collegare la rete virtuale alla rete privata e consentire solo le richieste RDP o SSH da tale intervallo di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="a6433-192">An even better approach is to create a VPN to link the virtual network to your private network and only allow RDP or SSH requests from that address range.</span></span> <span data-ttu-id="a6433-193">È anche possibile sostituire la porta usata da RDP con una diversa da quella predefinita 3389.</span><span class="sxs-lookup"><span data-stu-id="a6433-193">You can also change the port used by RDP to be something other than the default 3389.</span></span> <span data-ttu-id="a6433-194">Tenere presente che cambiare le porte non è sufficiente per arrestare gli attacchi, ma semplicemente diventa un po' più difficile individuarle.</span><span class="sxs-lookup"><span data-stu-id="a6433-194">Keep in mind that changing ports is not sufficient to stop attacks, it simply makes it a little harder to discover.</span></span>