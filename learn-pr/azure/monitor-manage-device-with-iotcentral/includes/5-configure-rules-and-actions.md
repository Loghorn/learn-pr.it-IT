<span data-ttu-id="d8891-101">Si è connessa la macchina per il caffè all'applicazione Azure IoT Central, abilitando lo scambio di dati che consente di monitorare e gestire la macchina per il caffè.</span><span class="sxs-lookup"><span data-stu-id="d8891-101">You have connected your coffee machine to the Azure IoT Central application, enabling the exchange of data that allows you to monitor and manage your coffee machine.</span></span> <span data-ttu-id="d8891-102">In questo modulo vengono create regole che attivano azioni quando la temperatura dell'acqua della macchina per il caffè è fuori dall'intervallo normale.</span><span class="sxs-lookup"><span data-stu-id="d8891-102">In this module, you create rules that trigger actions when the water temperature of the coffee machine is out of the normal range.</span></span> <span data-ttu-id="d8891-103">Le azioni sono messaggi di posta elettronica o notifiche a dispositivi mobili, a seconda che la macchina sia o meno coperta da garanzia.</span><span class="sxs-lookup"><span data-stu-id="d8891-103">The actions are either emails or mobile notifications depending on whether or not the machine is under warranty.</span></span> <span data-ttu-id="d8891-104">Per aggiungere Microsoft Flow come azione, è necessaria una sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="d8891-104">To add Microsoft Flow as an action, you need an Azure subscription.</span></span> <span data-ttu-id="d8891-105">Se non si ha una sottoscrizione di Azure, l'aggiunta di Microsoft Flow come azione è facoltativa.</span><span class="sxs-lookup"><span data-stu-id="d8891-105">If you do not have an Azure subscription, adding Microsoft Flow as an action is optional.</span></span>

## <a name="create-rules-in-iot-central-with-email-as-the-action"></a><span data-ttu-id="d8891-106">Creare regole in IoT Central con invio di messaggio di posta elettronica come azione</span><span class="sxs-lookup"><span data-stu-id="d8891-106">Create rules in IoT Central with Email as the action</span></span>
<span data-ttu-id="d8891-107">Azure IoT Central include funzionalità native di posta elettronica per l'invio di notifiche.</span><span class="sxs-lookup"><span data-stu-id="d8891-107">Azure IoT Central has its native email capabilities to send notifications.</span></span> <span data-ttu-id="d8891-108">In questo scenario, se la macchina per il caffè è fuori dall'intervallo di temperatura ottimale e non è coperta dalla garanzia, IoT Central invia un messaggio di posta elettronica al reparto di manutenzione del cliente.</span><span class="sxs-lookup"><span data-stu-id="d8891-108">In this scenario, if the coffee machine is outside the optimal temperature range and is not protected by the warranty, an email is sent by IoT Central to the client’s maintenance department.</span></span>

<span data-ttu-id="d8891-109">Aggiungere le due regole seguenti quando la garanzia della macchina per il caffè è scaduta e la temperatura dell'acqua non è compresa nell'intervallo ottimale.</span><span class="sxs-lookup"><span data-stu-id="d8891-109">Add the following two rules when the coffee machine warranty has expired and the water temperature is outside the optimal range.</span></span> <span data-ttu-id="d8891-110">Al termine, scegliere **Save** (Salva).</span><span class="sxs-lookup"><span data-stu-id="d8891-110">When you're finished, choose **Save**.</span></span> 

> [!NOTE]
> <span data-ttu-id="d8891-111">Quando vengono applicate condizioni, per l'esecuzione delle regole tutte le affermazioni devono essere vere.</span><span class="sxs-lookup"><span data-stu-id="d8891-111">When conditions are applied, all statements have to be true for the rules to be executed.</span></span> <span data-ttu-id="d8891-112">Se la condizione è un'istruzione "or" come in questo scenario (ad esempio, la temperatura ottimale è minore di 90 gradi Celsius o maggiore di 98 gradi Celsius quando la garanzia è scaduta), dividere l'istruzione in due regole come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="d8891-112">If your condition is an "or" statement as in this scenario (e.g. the optimal temperature is less than 90 Celsius or greater than 98 Celsius while the warranty has expired), split the statement into two rules as shown here.</span></span>

1. <span data-ttu-id="d8891-113">Assegnare alla regola il nome: Coffee Maker Water Too Cold (Expired)</span><span class="sxs-lookup"><span data-stu-id="d8891-113">Name the rule: Coffee Maker Water Too Cold (Expired)</span></span>

    <span data-ttu-id="d8891-114">Aggiungere le condizioni:</span><span class="sxs-lookup"><span data-stu-id="d8891-114">Add the conditions:</span></span>      
    * <span data-ttu-id="d8891-115">Device Warranty Expired equals 1</span><span class="sxs-lookup"><span data-stu-id="d8891-115">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="d8891-116">Water Temperature is less than Coffee Makers Min Temperature ![Uso della regola](../images/5-flow-g.png)</span><span class="sxs-lookup"><span data-stu-id="d8891-116">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-g.png)</span></span>

1. <span data-ttu-id="d8891-117">Assegnare alla regola il nome: Coffee Maker Water Too Hot (Expired)</span><span class="sxs-lookup"><span data-stu-id="d8891-117">Name the rule: Coffee Maker Water Too Hot (Expired)</span></span>

    <span data-ttu-id="d8891-118">Aggiungere le condizioni:</span><span class="sxs-lookup"><span data-stu-id="d8891-118">Add the conditions:</span></span>      
    * <span data-ttu-id="d8891-119">Device Warranty Expired equals 1</span><span class="sxs-lookup"><span data-stu-id="d8891-119">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="d8891-120">Water Temperature is greater than Coffee Makers Max Temperature ![Uso della regola](../images/5-flow-k.png)</span><span class="sxs-lookup"><span data-stu-id="d8891-120">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-k.png)</span></span>     

1. <span data-ttu-id="d8891-121">Per aggiungere un'**azione**, scorrere verso il basso fino al pannello Configure Telemetry Rule (Configura regola di telemetria) e scegliere l'icona + accanto ad Actions (Azioni), quindi scegliere **Email** (Messaggio di posta elettronica)</span><span class="sxs-lookup"><span data-stu-id="d8891-121">To add an **Action**, scroll down on the Configure Telemetry Rule panel and choose the + next to Actions, then choose **Email**</span></span>

1. <span data-ttu-id="d8891-122">Per definire l'azione, aggiungere l'indirizzo di posta elettronica usato per accedere all'applicazione IoT Central.</span><span class="sxs-lookup"><span data-stu-id="d8891-122">To define the action, add the email address that you used to sign in to the IoT Central application.</span></span> <span data-ttu-id="d8891-123">Aggiungere il messaggio di notifica quando la temperatura dell'acqua è troppo alta: "Coffee maker's water is too hot.</span><span class="sxs-lookup"><span data-stu-id="d8891-123">Add the notification message when the water temperature is too hot: "Coffee maker's water is too hot.</span></span> <span data-ttu-id="d8891-124">Maintenance is required.</span><span class="sxs-lookup"><span data-stu-id="d8891-124">Maintenance is required.</span></span>  <span data-ttu-id="d8891-125">Warranty has expired."</span><span class="sxs-lookup"><span data-stu-id="d8891-125">Warranty has expired."</span></span> <span data-ttu-id="d8891-126">Ripetere gli stessi passaggi per quando la temperatura dell'acqua è troppo fredda.</span><span class="sxs-lookup"><span data-stu-id="d8891-126">Repeat the same steps for when the water temperature is too cold.</span></span> <span data-ttu-id="d8891-127">Aggiungere il messaggio: "Coffee maker's water is too cold.</span><span class="sxs-lookup"><span data-stu-id="d8891-127">Add the message: "Coffee maker's water is too cold.</span></span> <span data-ttu-id="d8891-128">Maintenance is required.</span><span class="sxs-lookup"><span data-stu-id="d8891-128">Maintenance is required.</span></span>  <span data-ttu-id="d8891-129">Warranty has expired."</span><span class="sxs-lookup"><span data-stu-id="d8891-129">Warranty has expired."</span></span>

1. <span data-ttu-id="d8891-130">Scegliere **Save** (Salva).</span><span class="sxs-lookup"><span data-stu-id="d8891-130">Choose **Save**.</span></span> <span data-ttu-id="d8891-131">La regola viene elencata nella pagina corrispondente:</span><span class="sxs-lookup"><span data-stu-id="d8891-131">Your rule is listed on the Rules page:</span></span>

1. <span data-ttu-id="d8891-132">Per attivare la regola, è possibile attendere che la temperatura esca dall'intervallo oppure impostarla intenzionalmente fuori dall'intervallo ottimale nelle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="d8891-132">To trigger the rule, you can wait for the temperature to go out of the range or you can purposely set the temperature out of the optimal range in settings.</span></span> <span data-ttu-id="d8891-133">Quando si inizia a ricevere notifiche tramite posta elettronica, ricordare di disabilitare la regola per evitare che la Posta in arrivo sia inondata da messaggi di Azure IoT Central.</span><span class="sxs-lookup"><span data-stu-id="d8891-133">Once you begin to receive email notification, remember to disable the rule to avoid flooding your Inbox with emails from Azure IoT Central.</span></span> 

> [!NOTE]
> <span data-ttu-id="d8891-134">Disattivare regole dopo aver completato la convalida per evitare di ricevere troppi messaggi nella Posta in arrivo.</span><span class="sxs-lookup"><span data-stu-id="d8891-134">Turn off the rules once you are done with validation to avoid flooding your Inbox with emails.</span></span> 

## <a name="create-rules-in-iot-central-with-microsoft-flow-as-the-action"></a><span data-ttu-id="d8891-135">Creare regole in IoT Central con Microsoft Flow come azione</span><span class="sxs-lookup"><span data-stu-id="d8891-135">Create rules in IoT Central with Microsoft Flow as the action</span></span>

<span data-ttu-id="d8891-136">Microsoft Flow automatizza i flussi di lavoro tra molte applicazioni.</span><span class="sxs-lookup"><span data-stu-id="d8891-136">Microsoft Flow automates workflows across many applications.</span></span> <span data-ttu-id="d8891-137">È una delle azioni che possono essere attivate quando viene eseguita una regola in IoT Central.</span><span class="sxs-lookup"><span data-stu-id="d8891-137">It’s one of the actions that can be triggered when a rule is fired in IoT Central.</span></span> <span data-ttu-id="d8891-138">In questo scenario, Microsoft Flow invia una notifica sul dispositivo mobile di un tecnico locale quando la macchina per il caffè raggiunge una determinata soglia di temperatura ed è in garanzia.</span><span class="sxs-lookup"><span data-stu-id="d8891-138">In this scenario, Microsoft Flow sends a mobile notification to a local technician when the coffee machine reaches certain temperature threshold and is under warranty.</span></span> <span data-ttu-id="d8891-139">Passare a **Rules** (Regole) per configurare le condizioni e aggiungere un flusso come azione quando la regola viene attivata.</span><span class="sxs-lookup"><span data-stu-id="d8891-139">Navigate to **Rules** to configure conditions and add a Flow as an action when the rule is fired.</span></span> 
 
> [!NOTE]
> <span data-ttu-id="d8891-140">Questo esercizio è facoltativo se non si ha una sottoscrizione di Azure per attivare Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="d8891-140">This exercise is optional if you do not have an Azure subscription to turn on Microsoft Flow.</span></span>

<span data-ttu-id="d8891-141">Aggiungere le regole seguenti quando la macchina per il caffè è in garanzia.</span><span class="sxs-lookup"><span data-stu-id="d8891-141">Add the following rules when the coffee machine is under warranty.</span></span> 

1. <span data-ttu-id="d8891-142">Assegnare alla regola il nome: Coffee Maker Water Too Cold (Warranty)</span><span class="sxs-lookup"><span data-stu-id="d8891-142">Name the rule: Coffee Maker Water Too Cold (Warranty)</span></span>

    <span data-ttu-id="d8891-143">Aggiungere le condizioni:</span><span class="sxs-lookup"><span data-stu-id="d8891-143">Add the conditions:</span></span>      
    * <span data-ttu-id="d8891-144">Device Warranty Expired equals 0</span><span class="sxs-lookup"><span data-stu-id="d8891-144">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="d8891-145">Water Temperature is less than Coffee Makers Min Temperature ![Uso della regola](../images/5-flow-l.png)</span><span class="sxs-lookup"><span data-stu-id="d8891-145">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-l.png)</span></span>

1. <span data-ttu-id="d8891-146">Assegnare alla regola il nome: Coffee Maker Water Too Hot (Warranty)</span><span class="sxs-lookup"><span data-stu-id="d8891-146">Name the rule: Coffee Maker Water Too Hot (Warranty)</span></span>

    <span data-ttu-id="d8891-147">Aggiungere le condizioni:</span><span class="sxs-lookup"><span data-stu-id="d8891-147">Add the conditions:</span></span>      
    * <span data-ttu-id="d8891-148">Device Warranty Expired equals 0</span><span class="sxs-lookup"><span data-stu-id="d8891-148">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="d8891-149">Water Temperature is greater than Coffee Makers Max Temperature ![Uso della regola](../images/5-flow-h.png)</span><span class="sxs-lookup"><span data-stu-id="d8891-149">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-h.png)</span></span>

1. <span data-ttu-id="d8891-150">Dopo aver salvato le condizioni della regola, scegliere Microsoft Flow come nuova azione quando la macchina per il caffè è in garanzia.</span><span class="sxs-lookup"><span data-stu-id="d8891-150">After you save the rule conditions, choose Microsoft Flow as a new action when the coffee maker is under warranty.</span></span> <span data-ttu-id="d8891-151">Nel browser si aprirà una nuova scheda o finestra che indirizzerà a Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="d8891-151">A new tab or window should open in your browser, taking you to Microsoft Flow.</span></span> <span data-ttu-id="d8891-152">Si aprirà una pagina di panoramica con un connettore IoT Central connesso a un'azione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="d8891-152">You land on an overview page showing an IoT Central connector connecting to a custom action.</span></span> <span data-ttu-id="d8891-153">Scegliere **Continue** (Continua).</span><span class="sxs-lookup"><span data-stu-id="d8891-153">Choose **Continue**.</span></span> 

    <span data-ttu-id="d8891-154">Viene visualizzata la finestra di progettazione di Microsoft Flow in cui creare il flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="d8891-154">You are taken to the Microsoft Flow designer to build your workflow.</span></span> <span data-ttu-id="d8891-155">Il flusso di lavoro include un trigger di IoT Central in cui l'applicazione e la regola sono già inserite.</span><span class="sxs-lookup"><span data-stu-id="d8891-155">The workflow has an IoT Central trigger that has your Application and Rule already filled in.</span></span>

    <span data-ttu-id="d8891-156">A questo punto è possibile aggiungere qualsiasi azione che si desidera al flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="d8891-156">At this point, you can add any action you want to your workflow.</span></span> <span data-ttu-id="d8891-157">Ad esempio, è possibile inviare una notifica per dispositivo mobile.</span><span class="sxs-lookup"><span data-stu-id="d8891-157">As an example, let's send a mobile notification.</span></span> <span data-ttu-id="d8891-158">Cercare notification (notifica), quindi scegliere Notifications - Send me a mobile notification (Notifiche - Inviami una notifica sul dispositivo mobile).</span><span class="sxs-lookup"><span data-stu-id="d8891-158">Search for notification, and choose Notifications - Send me a mobile notification.</span></span>

    <span data-ttu-id="d8891-159">Compilare il campo Text (Testo) dell'azione con ciò che la notifica deve comunicare.</span><span class="sxs-lookup"><span data-stu-id="d8891-159">In the action, fill in the Text field with what you want your notification to say.</span></span> <span data-ttu-id="d8891-160">È possibile includere contenuto dinamico proveniente dalla regola di IoT Central per trasmettere informazioni importanti, quali l'ID del dispositivo e il timestamp.</span><span class="sxs-lookup"><span data-stu-id="d8891-160">You can include Dynamic content from your IoT Central rule, passing along important information such as device ID and name.</span></span>
    <span data-ttu-id="d8891-161">![Uso di Microsoft Flow come azione](../images/5-flow-f.png)</span><span class="sxs-lookup"><span data-stu-id="d8891-161">![Using Microsoft Flow as an action](../images/5-flow-f.png)</span></span>

1. <span data-ttu-id="d8891-162">Dopo aver configurato il flusso di lavoro in Microsoft Flow, scaricare l'[app Flow](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) da Microsoft Store sul dispositivo mobile.</span><span class="sxs-lookup"><span data-stu-id="d8891-162">Once you've set up the workflow in Microsoft Flow, download the [Flow app](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) from Microsoft Store to your mobile device.</span></span> <span data-ttu-id="d8891-163">Accedere con lo stesso account usato per configurare il flusso nell'app Web Flow.</span><span class="sxs-lookup"><span data-stu-id="d8891-163">Sign in using the same account that you used to set up the flow in the Flow web app.</span></span> <span data-ttu-id="d8891-164">A scopo di test, impostare la temperatura ottimale fuori dall'intervallo per attivare la regola.</span><span class="sxs-lookup"><span data-stu-id="d8891-164">For testing purpose, set the optimal temperature out of range to trigger the rule.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="d8891-165">La proprietà del dispositivo Device Warranty Expired (1 per scaduta o 0 per coperto da garanzia nel codice del dispositivo) viene generata in modo casuale dal dispositivo e quindi inviata dal dispositivo all'applicazione Azure IoT Central.</span><span class="sxs-lookup"><span data-stu-id="d8891-165">Device Property: Device Warranty Expired (1 for expired or 0 for under warranty in the device code) is randomly generated by the device and then sent by the device to the Azure IoT Central application.</span></span> <span data-ttu-id="d8891-166">A scopo di testing, se si vuole controllare la proprietà Device Warranty Expired (1 o 0), riavviare il simulatore finché non viene visualizzato lo stato di garanzia desiderato per attivare l'azione che si sta testando.</span><span class="sxs-lookup"><span data-stu-id="d8891-166">For testing purpose, if you'd like to control Device Warranty Expired (1 or 0), reboot your simulator until you receive the intended warranty state to trigger the action that you're testing.</span></span> <span data-ttu-id="d8891-167">Per ricevere una notifica sul dispositivo mobile, riavviare il simulatore finché nel log della console non viene visualizzato che Device Warranty Expired è 0.</span><span class="sxs-lookup"><span data-stu-id="d8891-167">To receive a mobile notification, reboot your simulator until you see that Device Warranty Expired is 0 in the console log.</span></span> 

    <span data-ttu-id="d8891-168">Dopo alcuni minuti, la notifica compare nell'app per dispositivi mobili Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="d8891-168">After several minutes, notification appears in the Flow mobile app.</span></span>

    ![Uso di Microsoft Flow come azione](../images/5-flow-a.png)

## <a name="summary"></a><span data-ttu-id="d8891-170">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="d8891-170">Summary</span></span>
<span data-ttu-id="d8891-171">Si è appreso come creare regole in IoT Central e attivare azioni quando la regola viene eseguita, ad esempio l'invio di un messaggio di posta elettronica o una di notifica per dispositivi mobili tramite Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="d8891-171">You’ve learned to create rules in IoT Central and triggered actions such as an email or a mobile notification through Microsoft Flow when the rule is fired.</span></span> <span data-ttu-id="d8891-172">In questo caso, quando la temperatura dell'acqua della macchina per il caffè non è compresa nell'intervallo ottimale, vengono inviate notifiche a un tecnico specializzato o al cliente, a seconda dello stato della garanzia.</span><span class="sxs-lookup"><span data-stu-id="d8891-172">In this case, when the water temperature of the coffee machine is out of the optimal range, notifications are sent to either a repair technician or the client depending on the state of the warranty.</span></span> 


