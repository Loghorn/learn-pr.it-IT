<span data-ttu-id="89883-101">Si supponga di dover pianificare l'architettura di un'applicazione per la condivisione di musica.</span><span class="sxs-lookup"><span data-stu-id="89883-101">Suppose you are planning the architecture for your music-sharing application.</span></span> <span data-ttu-id="89883-102">Si vuole essere certi che i file musicali vengano caricati in modo affidabile nell'API Web dall'app per dispositivi mobili. È quindi necessario che i dettagli sui nuovi brani aggiunti da un artista alla propria raccolta vengano distribuiti direttamente nell'app.</span><span class="sxs-lookup"><span data-stu-id="89883-102">You want to ensure that music files are uploaded to the web API reliably from the mobile app - we then want to deliver the details about new songs directly to the app when an artist adds new music to their collection.</span></span> <span data-ttu-id="89883-103">Si tratta di un uso ideale di un sistema basato su messaggi e Azure offre due soluzioni a questo problema:</span><span class="sxs-lookup"><span data-stu-id="89883-103">This is a perfect use of a message-based system and Azure offers two solutions to this problem:</span></span>

- <span data-ttu-id="89883-104">Archiviazione code di Azure</span><span class="sxs-lookup"><span data-stu-id="89883-104">Azure Queue Storage</span></span>
- <span data-ttu-id="89883-105">Bus di servizio di Azure</span><span class="sxs-lookup"><span data-stu-id="89883-105">Azure Service Bus</span></span>

## <a name="what-is-azure-queue-storage"></a><span data-ttu-id="89883-106">Che cos'è Archiviazione code di Azure?</span><span class="sxs-lookup"><span data-stu-id="89883-106">What is Azure Queue Storage?</span></span>
<span data-ttu-id="89883-107">Archiviazione code è un servizio che usa Archiviazione di Azure per archiviare grandi quantità di messaggi accessibili in modo sicuro ovunque nel mondo usando una semplice interfaccia basata su REST.</span><span class="sxs-lookup"><span data-stu-id="89883-107">Queue storage is a service that uses Azure Storage to store large numbers of messages that can be securely accessed from anywhere in the world using a simple REST-based interface.</span></span> <span data-ttu-id="89883-108">Le code possono contenere milioni di messaggi, limitati solo dalla capacità dell'account di archiviazione che ne è proprietario.</span><span class="sxs-lookup"><span data-stu-id="89883-108">Queues can contain millions of messages, limited only by the capacity of the storage account that owns it.</span></span>

## <a name="what-is-azure-service-bus-queues"></a><span data-ttu-id="89883-109">Che cosa sono le code del bus di servizio di Azure?</span><span class="sxs-lookup"><span data-stu-id="89883-109">What is Azure Service Bus Queues?</span></span>
<span data-ttu-id="89883-110">Il bus di servizio è un sistema broker di messaggi destinato alle applicazioni aziendali.</span><span class="sxs-lookup"><span data-stu-id="89883-110">Service Bus is a message broker system intended for enterprise applications.</span></span> <span data-ttu-id="89883-111">Queste app spesso utilizzano più protocolli di comunicazione, hanno contratti di dati diversi, requisiti di sicurezza più elevati e possono includere servizi sia cloud che locali.</span><span class="sxs-lookup"><span data-stu-id="89883-111">These apps often utilize multiple communication protocols, have different data contracts, higher security requirements, and can include both cloud and on-premises services.</span></span> <span data-ttu-id="89883-112">Il bus di servizio si basa su un'infrastruttura di messaggistica dedicata, progettata specificamente per questi scenari.</span><span class="sxs-lookup"><span data-stu-id="89883-112">Service Bus is built on top of a dedicated messaging infrastructure designed for exactly these scenarios.</span></span>

<span data-ttu-id="89883-113">Questi servizi si basano entrambi sul concetto di una "coda" che contiene i messaggi inviati fino a quando la destinazione è pronta a riceverli.</span><span class="sxs-lookup"><span data-stu-id="89883-113">Both of these services are based on the idea of a "queue" which holds sent messages until the target is ready to receive them.</span></span>

## <a name="what-are-azure-service-bus-topics"></a><span data-ttu-id="89883-114">Che cosa sono gli argomenti del bus di servizio di Azure?</span><span class="sxs-lookup"><span data-stu-id="89883-114">What are Azure Service Bus Topics?</span></span>
<span data-ttu-id="89883-115">Gli argomenti del bus di servizio di Azure sono come le code ma, a differenza di queste, hanno più sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="89883-115">Azure Service Bus topics are like queues, but can have multiple subscribers.</span></span> <span data-ttu-id="89883-116">Quando un messaggio viene inviato a un argomento anziché a una coda, è possibile che più di un componente venga attivato per svolgere il proprio lavoro.</span><span class="sxs-lookup"><span data-stu-id="89883-116">When a message is sent to a topic instead of a queue multiple components can be triggered to do their work.</span></span> <span data-ttu-id="89883-117">Si supponga che in un'applicazione di condivisione di musica, un utente stia ascoltando una canzone</span><span class="sxs-lookup"><span data-stu-id="89883-117">Imagine in a music sharing application, a user listening to a song.</span></span> <span data-ttu-id="89883-118">e che l'app per dispositivi mobili invii un messaggio all'argomento "In ascolto".</span><span class="sxs-lookup"><span data-stu-id="89883-118">The mobile app might send a message to the "Listened" topic.</span></span> <span data-ttu-id="89883-119">Questo argomento avrà una sottoscrizione per "UpdateUserListenHistory" e una sottoscrizione diversa per "UpdateArtistsFanList".</span><span class="sxs-lookup"><span data-stu-id="89883-119">That topic will have a subscription for "UpdateUserListenHistory" and a different subscription for "UpdateArtistsFanList".</span></span> <span data-ttu-id="89883-120">Ognuna di queste funzioni viene gestita da un componente diverso che riceve la propria copia del messaggio.</span><span class="sxs-lookup"><span data-stu-id="89883-120">Each of those functions is handled by a different component that receives its own copy of the message.</span></span>

<span data-ttu-id="89883-121">Internamente, gli argomenti usano le code.</span><span class="sxs-lookup"><span data-stu-id="89883-121">Internally, topics use queues.</span></span> <span data-ttu-id="89883-122">Quando si pubblica un post in un argomento, il messaggio viene copiato e rilasciato nella coda relativa ad ogni sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="89883-122">When you post to a topic, the message is copied and dropped into the queue for each subscription.</span></span> <span data-ttu-id="89883-123">In questo modo, la copia del messaggio rimane in attesa di essere elaborata **da ogni ramo della sottoscrizione** anche se il componente che deve elaborare la sottoscrizione è troppo occupato per gestirla.</span><span class="sxs-lookup"><span data-stu-id="89883-123">The queue means that the message copy will stay around to be processed **by each subscription branch** even if the component processing that subscription is too busy to keep up.</span></span>

## <a name="benefits-of-queues"></a><span data-ttu-id="89883-124">Vantaggi delle code</span><span class="sxs-lookup"><span data-stu-id="89883-124">Benefits of queues</span></span>
<span data-ttu-id="89883-125">Le infrastrutture delle code possono supportare numerose funzionalità avanzate che le rendono molto utili.</span><span class="sxs-lookup"><span data-stu-id="89883-125">Queue infrastructures can support many advanced features that make them very useful in</span></span> 

### <a name="increased-reliability"></a><span data-ttu-id="89883-126">Maggiore affidabilità</span><span class="sxs-lookup"><span data-stu-id="89883-126">Increased reliability</span></span>
<span data-ttu-id="89883-127">Le code vengono usate dalle applicazioni distribuite come posizioni di archiviazione temporanee per i messaggi in attesa di recapito a un componente di destinazione.</span><span class="sxs-lookup"><span data-stu-id="89883-127">Queues are used by distributed applications as a temporary storage location for messages pending delivery to a destination component.</span></span> <span data-ttu-id="89883-128">Il componente di origine può aggiungere un messaggio alla coda e i componenti di destinazione possono recuperare il messaggio all'inizio della coda per elaborarlo.</span><span class="sxs-lookup"><span data-stu-id="89883-128">The source component can add a message to the queue and destination components can retrieve the message at the front of the queue for processing.</span></span> <span data-ttu-id="89883-129">Le code migliorano l'affidabilità dello scambio di messaggi perché, nei momenti di picco, i messaggi possono attendere semplicemente fino a quando un componente di destinazione è pronto per elaborarli.</span><span class="sxs-lookup"><span data-stu-id="89883-129">Queues increase the reliability of the message exchange because, at times of high demand, messages can simply wait until a destination component is ready to process them.</span></span>

### <a name="message-delivery-guarantees"></a><span data-ttu-id="89883-130">Garanzie di recapito dei messaggi</span><span class="sxs-lookup"><span data-stu-id="89883-130">Message delivery guarantees</span></span>
<span data-ttu-id="89883-131">I sistemi di accodamento in genere garantiscono il recapito di ogni messaggio nella coda a un componente di destinazione.</span><span class="sxs-lookup"><span data-stu-id="89883-131">Queuing systems usually guarantee delivery of each message in the queue to a destination component.</span></span> <span data-ttu-id="89883-132">Per queste garanzie si possono adottare tuttavia approcci diversi:</span><span class="sxs-lookup"><span data-stu-id="89883-132">However, these guarantees can take different approaches:</span></span>

- <span data-ttu-id="89883-133">**Recapito At-Least-Once:** con questo approccio, è garantito il recapito di ogni messaggio ad almeno uno dei componenti che recuperano i messaggi dalla coda.</span><span class="sxs-lookup"><span data-stu-id="89883-133">**At-Least-Once Delivery:** In this approach, each message is guaranteed to be delivered to at least one of the components that retrieve messages from the queue.</span></span> <span data-ttu-id="89883-134">Si noti, tuttavia, che in determinate circostanze, è possibile che lo stesso messaggio venga recapitato più di una volta.</span><span class="sxs-lookup"><span data-stu-id="89883-134">Note, however, that in certain circumstances, it is possible that the same message may be delivered more than once.</span></span> <span data-ttu-id="89883-135">Ad esempio, se sono presenti due istanze di un'app Web che recuperano i messaggi da una coda, in genere ogni messaggio viene recapitato a una sola di tali istanze.</span><span class="sxs-lookup"><span data-stu-id="89883-135">For example, if there are two instances of a web app retrieving messages from a queue, ordinarily each message goes to only one of those instances.</span></span> <span data-ttu-id="89883-136">Tuttavia, se un'istanza richiede molto tempo per elaborare il messaggio e scade un timeout, il messaggio potrebbe essere inviato anche all'altra istanza.</span><span class="sxs-lookup"><span data-stu-id="89883-136">However, if one instance takes a long time to process the message, and a time-out expires, the message may be sent to the other instance as well.</span></span> <span data-ttu-id="89883-137">Il codice dell'app Web deve essere progettato tenendo in considerazione questa eventualità.</span><span class="sxs-lookup"><span data-stu-id="89883-137">Your web app code should be designed with this possibility in mind.</span></span>

- <span data-ttu-id="89883-138">**Recapito At-Most-Once:** con questo approccio, il recapito di ogni messaggio non è garantito ed esiste una probabilità molto piccola che possa non arrivare.</span><span class="sxs-lookup"><span data-stu-id="89883-138">**At-Most-Once Delivery:** In this approach, each message is not guaranteed to be delivered, and there is a very small chance that it may not arrive.</span></span> <span data-ttu-id="89883-139">Tuttavia, a differenza del recapito At-Least-Once, non vi è alcuna possibilità che il messaggio venga recapitato due volte.</span><span class="sxs-lookup"><span data-stu-id="89883-139">However, unlike At-Least-Once delivery, there is no chance that the message will be delivered twice.</span></span> <span data-ttu-id="89883-140">In questo caso talvolta si parla di "rilevamento duplicati automatico".</span><span class="sxs-lookup"><span data-stu-id="89883-140">This is sometimes referred to as "automatic duplicate detection".</span></span>

- <span data-ttu-id="89883-141">**First-In-First-Out (FIFO):** nella maggior parte dei sistemi di messaggistica, i messaggi in genere lasciano la coda nello stesso ordine in cui sono stati aggiunti, ma è necessario considerare se quest'ordine è garantito.</span><span class="sxs-lookup"><span data-stu-id="89883-141">**First-In-First-Out (FIFO):** In most messaging systems, messages usually leave the queue in the same order in which they were added, but you should consider whether this order is guaranteed.</span></span> <span data-ttu-id="89883-142">Se l'applicazione distribuita richiede che i messaggi vengano elaborati con precisione nell'ordine corretto, è necessario scegliere un sistema di accodamento che include una garanzia FIFO.</span><span class="sxs-lookup"><span data-stu-id="89883-142">If your distributed application requires that messages are processed in precisely the correct order, you must choose a queue system that includes a FIFO guarantee.</span></span>

### <a name="transactional-support"></a><span data-ttu-id="89883-143">Supporto transazionale</span><span class="sxs-lookup"><span data-stu-id="89883-143">Transactional support</span></span>
<span data-ttu-id="89883-144">Alcuni gruppi di messaggi strettamente correlati possono causare problemi quando si verifica un errore di recapito per un messaggio nel gruppo.</span><span class="sxs-lookup"><span data-stu-id="89883-144">Some closely related groups of messages may cause problems when delivery fails for one message in the group.</span></span>

<span data-ttu-id="89883-145">Si consideri, ad esempio, un'applicazione di e-commerce.</span><span class="sxs-lookup"><span data-stu-id="89883-145">For example, consider an e-commerce application.</span></span> <span data-ttu-id="89883-146">Quando un utente fa clic sul pulsante **Acquista**, una serie di messaggi potrebbe essere generata e inviata a diverse destinazioni di elaborazione:</span><span class="sxs-lookup"><span data-stu-id="89883-146">When the user clicks the **Buy** button, a series of messages might be generated and sent off to various processing destinations:</span></span>

- <span data-ttu-id="89883-147">Un messaggio con i dettagli dell'ordine viene inviato a un centro di evasione degli ordini</span><span class="sxs-lookup"><span data-stu-id="89883-147">A message with the order details is sent to a fulfillment center</span></span>
- <span data-ttu-id="89883-148">Un messaggio con i dettagli di pagamento e il totale viene inviato a un sistema di elaborazione di carte di credito.</span><span class="sxs-lookup"><span data-stu-id="89883-148">A message with the total and payment details is sent to a credit card processor.</span></span> 
- <span data-ttu-id="89883-149">Un messaggio con le informazioni sulla ricevuta viene inviato a un database per generare una fattura per il cliente</span><span class="sxs-lookup"><span data-stu-id="89883-149">A message with the receipt information is sent to a database to generate an invoice for the customer</span></span>

<span data-ttu-id="89883-150">In questo caso si vuole essere certi che vengano elaborati _tutti_ i messaggi oppure nessuno.</span><span class="sxs-lookup"><span data-stu-id="89883-150">In this case, we want to make sure _all_ messages get processed, or none of them are processed.</span></span> <span data-ttu-id="89883-151">Non si resterà in affari a lungo se il messaggio relativo alla carta di credito non viene recapitato e tutti gli ordini vengono evasi senza pagamento.</span><span class="sxs-lookup"><span data-stu-id="89883-151">We won't be in business long if the credit card message is not delivered, and all our orders are fulfilled without payment!</span></span> <span data-ttu-id="89883-152">È possibile evitare questi tipi di problemi raggruppando i due messaggi in una transazione.</span><span class="sxs-lookup"><span data-stu-id="89883-152">You can avoid these kinds of problems by grouping the two messages into a transaction.</span></span> <span data-ttu-id="89883-153">Le transazioni contenenti i messaggi hanno esito positivo o negativo come singola unità, esattamente come nei database.</span><span class="sxs-lookup"><span data-stu-id="89883-153">Message transactions succeed or fail as a single unit - just like in the database world.</span></span> <span data-ttu-id="89883-154">Se il recapito del messaggio dei dettagli della carta di credito non riesce, anche il messaggio dei dettagli dell'ordine non verrà recapitato.</span><span class="sxs-lookup"><span data-stu-id="89883-154">If the credit card details message delivery fails, then so will the order details message.</span></span>

## <a name="which-service-should-i-choose"></a><span data-ttu-id="89883-155">Qual è il servizio da scegliere?</span><span class="sxs-lookup"><span data-stu-id="89883-155">Which service should I choose?</span></span>
<span data-ttu-id="89883-156">Dopo aver stabilito che la strategia di comunicazione per questa architettura deve essere un messaggio, è necessario scegliere se usare le code di archiviazione di Azure o il bus di servizio di Azure, entrambi servizi che possono essere usati per archiviare e recapitare messaggi tra i componenti.</span><span class="sxs-lookup"><span data-stu-id="89883-156">Having understood that the communication strategy for this architecture should be a message, you must choose whether to use Azure Storage queues or Azure Service Bus, both of which can be used to store and deliver messages between your components.</span></span> <span data-ttu-id="89883-157">Ogni tecnologia presenta un set di funzionalità leggermente diverso ed è quindi possibile scegliere l'una o l'altra, o entrambe, a seconda del problema da risolvere.</span><span class="sxs-lookup"><span data-stu-id="89883-157">Each has a slightly different feature set, which means you can choose one or the other, or use both, depending on the problem you are solving.</span></span>

#### <a name="choose-service-bus-topics-if"></a><span data-ttu-id="89883-158">Scegliere gli argomenti del bus di servizio se</span><span class="sxs-lookup"><span data-stu-id="89883-158">Choose Service Bus Topics if</span></span>

- <span data-ttu-id="89883-159">Sono necessari più ricevitori per la gestione di ogni messaggio</span><span class="sxs-lookup"><span data-stu-id="89883-159">you need multiple receivers to handle each message</span></span>


#### <a name="choose-service-bus-queues-if"></a><span data-ttu-id="89883-160">Scegliere le code del bus di servizio se:</span><span class="sxs-lookup"><span data-stu-id="89883-160">Choose Service Bus queues if:</span></span>

- <span data-ttu-id="89883-161">È necessaria una garanzia di recapito At-Most-Once.</span><span class="sxs-lookup"><span data-stu-id="89883-161">You need an At-Most-Once delivery guarantee.</span></span>
- <span data-ttu-id="89883-162">È necessaria una garanzia FIFO.</span><span class="sxs-lookup"><span data-stu-id="89883-162">You need a FIFO guarantee.</span></span>
- <span data-ttu-id="89883-163">È necessario raggruppare i messaggi in transazioni.</span><span class="sxs-lookup"><span data-stu-id="89883-163">You need to group messages into transactions.</span></span>
- <span data-ttu-id="89883-164">Si vuole ricevere messaggi senza polling della coda.</span><span class="sxs-lookup"><span data-stu-id="89883-164">You want to receive messages without polling the queue.</span></span>
- <span data-ttu-id="89883-165">È necessario fornire alle code un modello di accesso basato sui ruoli.</span><span class="sxs-lookup"><span data-stu-id="89883-165">You need to provide a role-based access model to the queues.</span></span>
- <span data-ttu-id="89883-166">È necessario gestire messaggi di dimensioni superiori a 64 KB, ma inferiori a 256 KB.</span><span class="sxs-lookup"><span data-stu-id="89883-166">You need to handle messages larger than 64 KB but less than 256 KB.</span></span>
- <span data-ttu-id="89883-167">Le dimensioni della coda non supereranno gli 80 GB.</span><span class="sxs-lookup"><span data-stu-id="89883-167">Your queue size will not grow larger than 80 GB.</span></span>
- <span data-ttu-id="89883-168">Si vuole poter pubblicare e utilizzare batch di messaggi.</span><span class="sxs-lookup"><span data-stu-id="89883-168">You would like to be able to publish and consume batches of messages.</span></span>

<span data-ttu-id="89883-169">Archiviazione code non ha altrettante funzionalità, ma se tali funzionalità non sono necessarie, può essere una scelta più semplice.</span><span class="sxs-lookup"><span data-stu-id="89883-169">Queue storage isn't quite as feature-rich, but if you don't need any of those features, it can be a simpler choice.</span></span> <span data-ttu-id="89883-170">È inoltre la soluzione migliore se l'app presenta uno qualsiasi dei requisiti seguenti.</span><span class="sxs-lookup"><span data-stu-id="89883-170">In addition, it's the best solution if your app has any of the following requirements.</span></span>

#### <a name="choose-queue-storage-if"></a><span data-ttu-id="89883-171">Scegliere Archiviazione code se:</span><span class="sxs-lookup"><span data-stu-id="89883-171">Choose Queue storage if:</span></span>

- <span data-ttu-id="89883-172">È necessario un audit trail di tutti i messaggi che passano attraverso la coda.</span><span class="sxs-lookup"><span data-stu-id="89883-172">You need an audit trail of all messages that pass through the queue.</span></span>
- <span data-ttu-id="89883-173">Si prevede che le dimensioni della coda possano superare gli 80 GB.</span><span class="sxs-lookup"><span data-stu-id="89883-173">You expect the queue to exceed 80 GB in size.</span></span>
- <span data-ttu-id="89883-174">Si vuole tenere traccia dello stato dell'elaborazione di un messaggio all'interno della coda.</span><span class="sxs-lookup"><span data-stu-id="89883-174">You want to track progress for processing a message inside of the queue.</span></span>

<span data-ttu-id="89883-175">Una coda è una semplice posizione di archiviazione temporanea per i messaggi inviati tra i componenti di un'applicazione distribuita.</span><span class="sxs-lookup"><span data-stu-id="89883-175">A queue is a simple, temporary storage location for messages sent between the components of a distributed application.</span></span> <span data-ttu-id="89883-176">Usare una coda per organizzare i messaggi e gestire correttamente i picchi nella domanda non prevedibili.</span><span class="sxs-lookup"><span data-stu-id="89883-176">Use a queue to organize messages and gracefully handle unpredictable surges in demand.</span></span> 

<span data-ttu-id="89883-177">Usare le code di archiviazione quando si vuole un sistema di accodamento semplice e facile da programmare.</span><span class="sxs-lookup"><span data-stu-id="89883-177">Use Storage queues when you want a simple and easy-to-code queue system.</span></span> <span data-ttu-id="89883-178">Per esigenze più avanzate, usare le code del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="89883-178">For more advanced needs, use Service Bus queues.</span></span> <span data-ttu-id="89883-179">Se per un singolo messaggio sono presenti più destinazioni, ma è necessario un comportamento simile a quello delle code, usare gli argomenti.</span><span class="sxs-lookup"><span data-stu-id="89883-179">If you have multiple destinations for a single message, but need queue-like behavior, use topics.</span></span>