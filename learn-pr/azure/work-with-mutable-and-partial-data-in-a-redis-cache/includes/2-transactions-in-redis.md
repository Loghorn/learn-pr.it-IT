<span data-ttu-id="78d4e-101">A volte è necessario garantire che più operazioni vengano eseguite insieme.</span><span class="sxs-lookup"><span data-stu-id="78d4e-101">There are times when you must guarantee that multiple operations execute together.</span></span> <span data-ttu-id="78d4e-102">Ad esempio, in un'applicazione di messaggistica istantanea, gli utenti possono inviare solo un'immagine, solo un messaggio di testo oppure un messaggio di testo e un'immagine insieme.</span><span class="sxs-lookup"><span data-stu-id="78d4e-102">For example, in your instant messaging application, users can send an individual picture, an individual text message, or a picture and text message together.</span></span> <span data-ttu-id="78d4e-103">Quando l'utente sceglie di inviare insieme un'immagine e un messaggio di testo, è necessario assicurarsi che gli altri membri del gruppo li ricevano nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="78d4e-103">When the user chooses to send a picture and text message together, you must ensure that other members of the group receive them at the same time.</span></span> <span data-ttu-id="78d4e-104">Questo è importante perché se l'immagine e il messaggio di testo non vengono ricevuti insieme, è possibile che venga inviato un altro messaggio che si interpone tra l'immagine e il messaggio di testo.</span><span class="sxs-lookup"><span data-stu-id="78d4e-104">This is important because if a picture and text message are not received together, it’s possible that a separate message could be sent in between the picture and text message.</span></span> <span data-ttu-id="78d4e-105">Ciò potrebbe generare confusione nella conversazione generale.</span><span class="sxs-lookup"><span data-stu-id="78d4e-105">That could make the overall conversation confusing.</span></span>

<span data-ttu-id="78d4e-106">In questa unità si vedrà come creare una transazione in Cache Redis di Azure per garantire che più operazioni vengano eseguite contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="78d4e-106">Here, we'll look at how to create a transaction in Azure Redis Cache to guarantee that multiple operations are executed together.</span></span>

## <a name="creating-and-running-transactions"></a><span data-ttu-id="78d4e-107">Creazione ed esecuzione di transazioni</span><span class="sxs-lookup"><span data-stu-id="78d4e-107">Creating and running transactions</span></span>

<span data-ttu-id="78d4e-108">Le transazioni in Redis funzionano accodando più comandi da eseguire come gruppo.</span><span class="sxs-lookup"><span data-stu-id="78d4e-108">Transactions in Redis work by queueing multiple commands to be executed as a group.</span></span> <span data-ttu-id="78d4e-109">Quando viene eseguita una transazione, i comandi in coda all'interno della transazione vengono sempre eseguiti senza che si interpongano altri comandi di altri client.</span><span class="sxs-lookup"><span data-stu-id="78d4e-109">When a transaction is executed, the commands queued inside of it are guaranteed to execute without any other commands from other clients interleaved between them.</span></span>

<span data-ttu-id="78d4e-110">Per avviare un blocco di transazione, immettere il comando `MULTI`.</span><span class="sxs-lookup"><span data-stu-id="78d4e-110">To begin a transaction block, enter the `MULTI` command.</span></span> <span data-ttu-id="78d4e-111">Ulteriori comandi verranno accodati e non eseguiti immediatamente.</span><span class="sxs-lookup"><span data-stu-id="78d4e-111">Further commands will be queued and not executed immediately.</span></span> <span data-ttu-id="78d4e-112">Eseguendo il comando `EXEC`, vengono eseguiti tutti i comandi in coda come un'unità transazionale.</span><span class="sxs-lookup"><span data-stu-id="78d4e-112">Running the `EXEC` command will execute all of the queued commands as a transactional unit.</span></span> <span data-ttu-id="78d4e-113">Se si decide di interrompere una transazione aperta mentre si accodano i comandi, l'esecuzione del comando `DISCARD` consente di chiudere il blocco di transazione senza eseguire _nessuno_ dei comandi in coda.</span><span class="sxs-lookup"><span data-stu-id="78d4e-113">If you decide you want to abort an open transaction while queuing commands, running the `DISCARD` command will close the transaction block without running _any_ of the queued commands.</span></span>

<span data-ttu-id="78d4e-114">Le transazioni Redis non supportano il concetto di ripristino dello stato precedente.</span><span class="sxs-lookup"><span data-stu-id="78d4e-114">Redis transactions do not support the concept of rollback.</span></span> <span data-ttu-id="78d4e-115">Se si accoda un comando con sintassi non corretta in un blocco di transazione, il blocco rimane aperto, ma viene automaticamente rimosso se si cerca di eseguirlo con `EXEC`.</span><span class="sxs-lookup"><span data-stu-id="78d4e-115">If you queue a command with incorrect syntax into a transaction block, the block will remain open, but will automatically be discarded if you attempt to execute it with `EXEC`.</span></span> <span data-ttu-id="78d4e-116">I comandi in una transazione che ha esito negativo _durante_ l'esecuzione (dopo la chiamata di `EXEC`) non provocano l'interruzione o il rollback di una transazione: Redis esegue comunque tutti i comandi e considera la transazione completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="78d4e-116">Commands in a transaction that fail _during_ execution (after `EXEC` is called) do not cause a transaction to be aborted or rolled back &mdash; Redis will still run all of the commands and consider the transaction to have completed successfully.</span></span>

## <a name="redis-transactions-with-servicestackredis"></a><span data-ttu-id="78d4e-117">Transazioni Redis con ServiceStack.Redis</span><span class="sxs-lookup"><span data-stu-id="78d4e-117">Redis transactions with ServiceStack.Redis</span></span>

<span data-ttu-id="78d4e-118">**ServiceStack.Redis** è una libreria client C# per l'interazione con Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="78d4e-118">**ServiceStack.Redis** is a C# client library for interacting with Azure Redis Cache.</span></span>

<span data-ttu-id="78d4e-119">Le transazioni in ServiceStack.Redis vengono create chiamando `IRedisClient.CreateTransaction()`.</span><span class="sxs-lookup"><span data-stu-id="78d4e-119">Transactions in ServiceStack.Redis are created by calling `IRedisClient.CreateTransaction()`.</span></span> <span data-ttu-id="78d4e-120">L'oggetto `IRedisTransaction` restituito può avere più comandi accodati con `QueueCommand()`.</span><span class="sxs-lookup"><span data-stu-id="78d4e-120">The `IRedisTransaction` object that is returned can have multiple commands queued into it with `QueueCommand()`.</span></span> <span data-ttu-id="78d4e-121">La chiamata di `Commit()` sull'oggetto transazione comporta la sua esecuzione.</span><span class="sxs-lookup"><span data-stu-id="78d4e-121">Calling `Commit()` on the transaction object will execute it.</span></span>

<span data-ttu-id="78d4e-122">Gli oggetti `IRedisTransaction` possono essere eliminati e viene inviato automaticamente un comando `DISCARD` se l'eliminazione avviene prima di chiamare `Commit()`.</span><span class="sxs-lookup"><span data-stu-id="78d4e-122">`IRedisTransaction` objects are disposable, and will automatically issue a `DISCARD` command if disposed before calling `Commit()`.</span></span> <span data-ttu-id="78d4e-123">Questa funzionalità è ideale con i blocchi `using` C#: se non si esegue il commit di una transazione per qualsiasi motivo, è possibile avere la certezza che la transazione verrà rimossa automaticamente in modo che sia possibile continuare a usare la connessione Redis.</span><span class="sxs-lookup"><span data-stu-id="78d4e-123">This feature works well with C#'s `using` blocks: if you don't commit a transaction for any reason, you can trust that the transaction will automatically be discarded so that the Redis connection can continue to be used.</span></span>

## <a name="create-a-transaction-using-c-and-the-servicestackredis-client"></a><span data-ttu-id="78d4e-124">Creare una transazione con C# e il client ServiceStack.Redis</span><span class="sxs-lookup"><span data-stu-id="78d4e-124">Create a transaction using C# and the ServiceStack.Redis client</span></span>

<span data-ttu-id="78d4e-125">Ecco un esempio dell'uso di ServiceStack.Redis per creare una transazione che può inviare un messaggio che include un URL di un'immagine e i contenuti di un messaggio di testo.</span><span class="sxs-lookup"><span data-stu-id="78d4e-125">Here's an example of using ServiceStack.Redis to create a transaction that can send a message that includes a picture URL and the contents of a text message.</span></span>

```csharp
public bool SendPictureAndText(string groupChatID, string text, string pictureURL)
{
    bool transactionResult = false;

    using (RedisClient redisClient = new RedisClient(redisConnectionString))
    using (var transaction = redisClient.CreateTransaction())
    {
        //Add multiple operations to the transaction
        transaction.QueueCommand(c => c.PublishMessage(groupChatID, pictureURL));
        transaction.QueueCommand(c => c.PublishMessage(groupChatID, text));

        //Commit and get result of transaction
        transactionResult = transaction.Commit();
    }

    return transactionResult;
}
```

<span data-ttu-id="78d4e-126">Le transazioni garantiscono che più operazioni vengano eseguite insieme senza interposizione di operazioni di altri client.</span><span class="sxs-lookup"><span data-stu-id="78d4e-126">Transactions ensure that multiple operations are executed together without operations from other clients in between them.</span></span> <span data-ttu-id="78d4e-127">È possibile creare una transazione usando il comando `MULTI`.</span><span class="sxs-lookup"><span data-stu-id="78d4e-127">You create a transaction using the `MULTI` command.</span></span> <span data-ttu-id="78d4e-128">Con ServiceStack.Redis, si usa il metodo `CreateTransaction()`.</span><span class="sxs-lookup"><span data-stu-id="78d4e-128">With ServiceStack.Redis, you use the `CreateTransaction()` method.</span></span>