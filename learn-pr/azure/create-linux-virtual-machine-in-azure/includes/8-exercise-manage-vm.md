<span data-ttu-id="b7eec-101">Applichiamo un gruppo di sicurezza di rete alla rete in modo che dal server possa transitare solo il traffico HTTP.</span><span class="sxs-lookup"><span data-stu-id="b7eec-101">Let's apply a Network Security Group to our network so that we only allow HTTP traffic through our server.</span></span>

## <a name="create-a-network-security-group"></a><span data-ttu-id="b7eec-102">Creare un gruppo di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="b7eec-102">Create a network security group</span></span>

<span data-ttu-id="b7eec-103">Azure dovrebbe aver creato un gruppo di sicurezza perché si era indicato di volere l'accesso SSH.</span><span class="sxs-lookup"><span data-stu-id="b7eec-103">Azure should have created a security group for us because we indicated we wanted SSH access.</span></span> <span data-ttu-id="b7eec-104">Verrà tuttavia creato un nuovo gruppo di sicurezza per poter eseguire l'intero processo.</span><span class="sxs-lookup"><span data-stu-id="b7eec-104">But let's create a new security group so you can walk through the entire process.</span></span> <span data-ttu-id="b7eec-105">Questo è particolarmente importante se si decide di creare la rete virtuale _prima_ delle VM.</span><span class="sxs-lookup"><span data-stu-id="b7eec-105">This is particularly important if you decide to create your virtual network _before_ your VMs.</span></span> <span data-ttu-id="b7eec-106">Come indicato in precedenza, i gruppi di sicurezza sono _facoltativi_ e non vengono necessariamente creati con la rete.</span><span class="sxs-lookup"><span data-stu-id="b7eec-106">As mentioned earlier, security groups are _optional_ and not necessarily created with the network.</span></span>

1. <span data-ttu-id="b7eec-107">Nel [portale di Azure](https://portal.azure.com?azure-portal=true) fare clic sul pulsante **Crea una risorsa** nella barra laterale nell'angolo a sinistra per avviare la creazione di una nuova risorsa.</span><span class="sxs-lookup"><span data-stu-id="b7eec-107">In the [Azure portal](https://portal.azure.com?azure-portal=true), click the **Create a resource** button in the left corner sidebar to start a new resource creation.</span></span>

1. <span data-ttu-id="b7eec-108">Digitare "Gruppo di sicurezza di rete" nella casella del filtro e selezionare l'elemento corrispondente nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="b7eec-108">Type "Network security group" into the filter box and select the matching item in the list.</span></span>

1. <span data-ttu-id="b7eec-109">Verificare che sia selezionato il modello di distribuzione **Resource Manager** e fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-109">Make sure the **Resource Manager** deployment model is selected and click **Create**.</span></span>

1. <span data-ttu-id="b7eec-110">Fornire un **nome** per il gruppo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b7eec-110">Provide a **Name** for your security group.</span></span> <span data-ttu-id="b7eec-111">Anche in questo caso, sono utili le convenzioni di denominazione. Si userà "test-web-eus-nsg1" per "Test Web Network Security Group #1 in East US".</span><span class="sxs-lookup"><span data-stu-id="b7eec-111">Again, naming conventions are a good idea here, let's use "test-web-eus-nsg1" for "Test Web Network Security Group #1 in East US".</span></span> <span data-ttu-id="b7eec-112">È consigliato modificare la parte di nome relativa alla località per riflettere quella inserita nel gruppo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b7eec-112">You'll likely want to change the location portion of the to reflect where you put the security group.</span></span>

1. <span data-ttu-id="b7eec-113">Selezionare la **sottoscrizione** appropriata e usare il **gruppo di risorse** esistente.</span><span class="sxs-lookup"><span data-stu-id="b7eec-113">Select the proper **Subscription** and use your existing **Resource group**.</span></span>

1. <span data-ttu-id="b7eec-114">Inserirlo infine nella stessa **località** della VM/rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="b7eec-114">Finally, put it into the same **Location** as the VM / Virtual Network.</span></span> <span data-ttu-id="b7eec-115">Questa operazione è importante perché non sarà possibile applicare questa risorsa se si trova in una località diversa.</span><span class="sxs-lookup"><span data-stu-id="b7eec-115">This is important; you won't be able to apply this resource if it's in a different location.</span></span>

1. <span data-ttu-id="b7eec-116">Fare clic su **Crea** per creare il gruppo.</span><span class="sxs-lookup"><span data-stu-id="b7eec-116">Click **Create** to create the group.</span></span>

## <a name="add-a-new-inbound-rule-to-our-network-security-group"></a><span data-ttu-id="b7eec-117">Aggiungere una nuova regola in ingresso al gruppo di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="b7eec-117">Add a new inbound rule to our Network Security Group</span></span>

<span data-ttu-id="b7eec-118">La distribuzione deve terminare in breve tempo. Al termine è possibile aggiungere nuove regole per il gruppo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b7eec-118">Deployment should complete quickly, when it's finished we can add new rules to our security group.</span></span>

1. <span data-ttu-id="b7eec-119">Trovare la nuova risorsa gruppo di sicurezza e selezionarla nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="b7eec-119">Find the new security group resource and select it in the Azure portal.</span></span>

1. <span data-ttu-id="b7eec-120">Nella pagina Panoramica si noterà che sono state create alcune regole predefinite create per bloccare la rete.</span><span class="sxs-lookup"><span data-stu-id="b7eec-120">On the overview page, you'll find that it has some default rules created to lock down the network.</span></span>

    <span data-ttu-id="b7eec-121">Sul lato in ingresso:</span><span class="sxs-lookup"><span data-stu-id="b7eec-121">On the inbound side:</span></span>

    - <span data-ttu-id="b7eec-122">Tutto il traffico in ingresso da una rete virtuale a un'altra è consentito.</span><span class="sxs-lookup"><span data-stu-id="b7eec-122">All incoming traffic from one VNet to another is allowed.</span></span> <span data-ttu-id="b7eec-123">In questo modo le risorse nella rete virtuale possono comunicare tra loro.</span><span class="sxs-lookup"><span data-stu-id="b7eec-123">This lets resources on the VNet talk to each other</span></span>
    - <span data-ttu-id="b7eec-124">Il "probe" di Azure Load Balancer richiede di verificare che la VM sia attiva</span><span class="sxs-lookup"><span data-stu-id="b7eec-124">Azure Load balancer "probe" requests to ensure the VM is alive</span></span>
    - <span data-ttu-id="b7eec-125">Tutto il traffico in ingresso viene rifiutato sul lato in uscita:</span><span class="sxs-lookup"><span data-stu-id="b7eec-125">All other inbound traffic is denied On the outbound side:</span></span>
    - <span data-ttu-id="b7eec-126">Tutto il traffico nella rete virtuale è consentito</span><span class="sxs-lookup"><span data-stu-id="b7eec-126">All in-network traffic on the VNet is allowed</span></span>
    - <span data-ttu-id="b7eec-127">Tutto il traffico in uscita verso Internet è consentito</span><span class="sxs-lookup"><span data-stu-id="b7eec-127">All outbound traffic to the Internet is permitted</span></span>
    - <span data-ttu-id="b7eec-128">Tutto il traffico in uscita di altro tipo viene rifiutato</span><span class="sxs-lookup"><span data-stu-id="b7eec-128">All other outbound traffic is denied</span></span>

> [!NOTE]
> <span data-ttu-id="b7eec-129">Queste regole predefinite vengono impostate con valori di priorità elevata e quindi vengono valutate per _ultime_.</span><span class="sxs-lookup"><span data-stu-id="b7eec-129">These default rules are set with high priority values, which means that they get evaluated _last_.</span></span> <span data-ttu-id="b7eec-130">Non possono essere modificate o eliminate, ma è possibile eseguirne l'_override_ creando regole più specifiche per il traffico con un valore di priorità più basso.</span><span class="sxs-lookup"><span data-stu-id="b7eec-130">They cannot be changed or deleted, but you can _override_ them by creating more specific rules to match your traffic with a lower priority value.</span></span>

1. <span data-ttu-id="b7eec-131">Fare clic sulla sezione **Regole di sicurezza in ingresso** nel pannello **Impostazioni** del gruppo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b7eec-131">Click the **Inbound security rules** section in the **Settings** panel for the security group.</span></span>

1. <span data-ttu-id="b7eec-132">Fare clic su **+ Aggiungi** per aggiungere una nuova regola di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b7eec-132">Click **+ Add** to add a new security rule.</span></span>

    ![Aggiungere una regola di sicurezza](../media-drafts/8-add-rule.png)

    <span data-ttu-id="b7eec-134">Esistono due modi per immettere le informazioni necessarie per una regola di sicurezza: di base e avanzato.</span><span class="sxs-lookup"><span data-stu-id="b7eec-134">There are two ways to enter the information necessary for a security rule: basic and advanced.</span></span> <span data-ttu-id="b7eec-135">È possibile passare da uno all'altro facendo clic sul pulsante nella parte superiore del pannello "Aggiungi".</span><span class="sxs-lookup"><span data-stu-id="b7eec-135">You can switch between them by clicking the button at the top of the "add" panel.</span></span>

    ![Input della regola di base e avanzata](../media-drafts/8-advanced-create-rule.png)

    <span data-ttu-id="b7eec-137">La modalità avanzata offre la possibilità di personalizzare completamente la regola. Se tuttavia si desidera configurare un protocollo noto, è più semplice usare la modalità di base.</span><span class="sxs-lookup"><span data-stu-id="b7eec-137">The advanced mode provides the ability to customize the rule completely, however, if you need to configure a known protocol, the basic mode is a bit easier to work with.</span></span>

1. <span data-ttu-id="b7eec-138">Passare alla modalità di base.</span><span class="sxs-lookup"><span data-stu-id="b7eec-138">Switch to the Basic mode.</span></span>

1. <span data-ttu-id="b7eec-139">Aggiungere le informazioni per la regola HTTP.</span><span class="sxs-lookup"><span data-stu-id="b7eec-139">Add the information for our HTTP rule.</span></span>

    - <span data-ttu-id="b7eec-140">Impostare il **servizio** su HTTP.</span><span class="sxs-lookup"><span data-stu-id="b7eec-140">Set the **Service** to be HTTP.</span></span> <span data-ttu-id="b7eec-141">Verrà automaticamente configurato l'intervallo di porte.</span><span class="sxs-lookup"><span data-stu-id="b7eec-141">This will set your port range up for you.</span></span>
    - <span data-ttu-id="b7eec-142">Impostare la **priorità** su "1000".</span><span class="sxs-lookup"><span data-stu-id="b7eec-142">Set the **Priority** to "1000".</span></span> <span data-ttu-id="b7eec-143">Deve essere un numero più basso di quello della regola predefinita **Nega**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-143">It has to be a lower number than the default **Deny** rule.</span></span> <span data-ttu-id="b7eec-144">È possibile far iniziare l'intervallo con qualsiasi valore, ma è consigliabile fare in modo di poter creare un'eccezione in un secondo momento, se necessario.</span><span class="sxs-lookup"><span data-stu-id="b7eec-144">You can start the range at any value, but it's recommended you give yourself some space in case an exception needs to be created later.</span></span>
    - <span data-ttu-id="b7eec-145">Assegnare un nome alla regola, ad esempio "allow-http-traffic".</span><span class="sxs-lookup"><span data-stu-id="b7eec-145">Give the rule a name; we'll use "allow-http-traffic".</span></span>
    - <span data-ttu-id="b7eec-146">Assegnare una descrizione alla regola.</span><span class="sxs-lookup"><span data-stu-id="b7eec-146">Give the rule a description.</span></span>

1. <span data-ttu-id="b7eec-147">Tornare alla modalità **avanzata**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-147">Switch back to the **Advanced** mode.</span></span> <span data-ttu-id="b7eec-148">Si noti che le impostazioni sono ancora presenti.</span><span class="sxs-lookup"><span data-stu-id="b7eec-148">Notice that our settings are still present.</span></span> <span data-ttu-id="b7eec-149">È possibile usare questo pannello per creare impostazioni con granularità più fine.</span><span class="sxs-lookup"><span data-stu-id="b7eec-149">We can use this panel to create more fine-grained settings.</span></span> <span data-ttu-id="b7eec-150">In particolare, l'**origine** deve essere un indirizzo IP specifico o un intervallo di indirizzi IP specifici delle telecamere.</span><span class="sxs-lookup"><span data-stu-id="b7eec-150">In particular, we would likely restrict the **Source** to be a specific IP address or range of IP addresses specific to the cameras.</span></span> <span data-ttu-id="b7eec-151">Se si conosce l'indirizzo IP corrente del computer locale, è possibile provare a usarlo.</span><span class="sxs-lookup"><span data-stu-id="b7eec-151">If you know the current IP address of your local computer, you can try that.</span></span> <span data-ttu-id="b7eec-152">In caso contrario, lasciare l'impostazione "Qualsiasi" in modo che sia possibile testare la regola.</span><span class="sxs-lookup"><span data-stu-id="b7eec-152">Otherwise, leave the setting as "Any" so you can test the rule.</span></span>

1. <span data-ttu-id="b7eec-153">Fare clic su **Aggiungi** per creare la regola.</span><span class="sxs-lookup"><span data-stu-id="b7eec-153">Click **Add** to create the rule.</span></span> <span data-ttu-id="b7eec-154">L'elenco di regole in ingresso verrà aggiornato. Si noti che sono in ordine di priorità, ovvero l'ordine in cui verranno esaminate.</span><span class="sxs-lookup"><span data-stu-id="b7eec-154">This will update the list of inbound rules - notice they are in priority order, which is how they will be examined.</span></span>
    
## <a name="apply-the-security-group"></a><span data-ttu-id="b7eec-155">Applicare il gruppo di sicurezza</span><span class="sxs-lookup"><span data-stu-id="b7eec-155">Apply the security group</span></span>

<span data-ttu-id="b7eec-156">Si ricordi che è possibile applicare il gruppo di sicurezza a un'interfaccia di rete per proteggere una singola VM o a una subnet per applicarlo a tutte le risorse in tale subnet.</span><span class="sxs-lookup"><span data-stu-id="b7eec-156">Recall that we can apply the security group to a network interface to guard a single VM, or to a subnet where it would apply to any resources on that subnet.</span></span> <span data-ttu-id="b7eec-157">Si userà il secondo approccio, che è il più comune.</span><span class="sxs-lookup"><span data-stu-id="b7eec-157">The latter approach tends to be the most common so let's do that.</span></span> <span data-ttu-id="b7eec-158">È possibile accedere a questa risorsa in Azure tramite la risorsa di rete virtuale o indirettamente tramite la VM che usa la rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="b7eec-158">We could get to this resource in Azure through either the virtual network resource or indirectly through the VM which is using the virtual network.</span></span>

1. <span data-ttu-id="b7eec-159">Passare al pannello **Panoramica** per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="b7eec-159">Switch to the **Overview** panel for the virtual machine.</span></span> <span data-ttu-id="b7eec-160">È possibile trovare la VM in **Tutte le risorse**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-160">You can find the VM under **All Resources**.</span></span>

1. <span data-ttu-id="b7eec-161">Selezionare l'elemento **Rete** nella sezione **Impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-161">Select the **Networking** item in the **Settings** section.</span></span>

    ![Elemento Rete nelle impostazioni della VM](../media-drafts/8-network-settings.png)

1. <span data-ttu-id="b7eec-163">Nelle proprietà della rete sono disponibili informazioni sulla rete applicata alla VM, tra cui la **rete virtuale/subnet**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-163">In the networking properties, you will find information about the networking applied to the VM including the **Virtual network/subnet**.</span></span> <span data-ttu-id="b7eec-164">Questo è un collegamento su cui è possibile fare clic per ottenere la risorsa.</span><span class="sxs-lookup"><span data-stu-id="b7eec-164">This is a clickable link to get to the resource.</span></span> <span data-ttu-id="b7eec-165">Fare clic per aprire la rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="b7eec-165">Click it to open the virtual network.</span></span> <span data-ttu-id="b7eec-166">Questo collegamento è disponibile _anche_ nel pannello **Panoramica** della VM.</span><span class="sxs-lookup"><span data-stu-id="b7eec-166">This link is _also_ available on the **Overview** panel of the VM.</span></span> <span data-ttu-id="b7eec-167">Entrambi i collegamenti apriranno la **panoramica** della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="b7eec-167">Either of these will open the **Overview** of the virtual network.</span></span>

1. <span data-ttu-id="b7eec-168">Nella sezione **Impostazioni** selezionare l'elemento **Subnet**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-168">In the **Settings** section, select the **Subnets** item.</span></span>

1. <span data-ttu-id="b7eec-169">Dovrebbe essere presente una sola subnet definita (predefinita) da quando prima sono state create la VM e la rete.</span><span class="sxs-lookup"><span data-stu-id="b7eec-169">We should have a single subnet defined (default) from when we created the VM + network earlier.</span></span> <span data-ttu-id="b7eec-170">Fare clic sull'elemento nell'elenco per aprire i dettagli.</span><span class="sxs-lookup"><span data-stu-id="b7eec-170">Click the item in the list to open the details.</span></span>

1. <span data-ttu-id="b7eec-171">Fare clic sulla voce **Gruppo di sicurezza di rete**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-171">Click the **Network security group** entry.</span></span>

1. <span data-ttu-id="b7eec-172">Selezionare il nuovo gruppo di sicurezza: **test-web-eus-nsg1**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-172">Select your new security group: **test-web-eus-nsg1**.</span></span> <span data-ttu-id="b7eec-173">Dovrebbe essere presente un altro gruppo oltre a quello creato con la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="b7eec-173">There should be another group here as well that was created with the VM.</span></span>

1. <span data-ttu-id="b7eec-174">Fare clic su **Salva** per salvare la modifica.</span><span class="sxs-lookup"><span data-stu-id="b7eec-174">Click **Save** to save the change.</span></span> <span data-ttu-id="b7eec-175">L'applicazione alla rete richiederà un minuto.</span><span class="sxs-lookup"><span data-stu-id="b7eec-175">It will take a minute to apply to the network.</span></span>

## <a name="verify-the-rules"></a><span data-ttu-id="b7eec-176">Verificare le regole</span><span class="sxs-lookup"><span data-stu-id="b7eec-176">Verify the rules</span></span>

<span data-ttu-id="b7eec-177">La modifica verrà ora convalidata.</span><span class="sxs-lookup"><span data-stu-id="b7eec-177">Let's validate the change.</span></span>

1. <span data-ttu-id="b7eec-178">Tornare al pannello **Panoramica** per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="b7eec-178">Switch back to the **Overview** panel for the virtual machine.</span></span> <span data-ttu-id="b7eec-179">È possibile trovare la VM in **Tutte le risorse**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-179">You can find the VM under **All Resources**.</span></span>

1. <span data-ttu-id="b7eec-180">Selezionare l'elemento **Rete** nella sezione **Impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="b7eec-180">Select the **Networking** item in the **Settings** section.</span></span>

1. <span data-ttu-id="b7eec-181">Nel pannello **Panoramica** della rete è presente un collegamento **Regole di sicurezza effettive** che consente di visualizzare rapidamente come verranno valutate le regole.</span><span class="sxs-lookup"><span data-stu-id="b7eec-181">In the **Overview** panel for the network, there is a link for **Effective security rules** that will quickly show you how rules are going to be evaluated.</span></span> <span data-ttu-id="b7eec-182">Fare clic sul collegamento per aprire l'analisi e assicurarsi che venga visualizzata la nuova regola.</span><span class="sxs-lookup"><span data-stu-id="b7eec-182">Click the link to open the analysis and make sure you see your new rule.</span></span>

    ![Regole di sicurezza effettive per la rete](../media-drafts/8-effective-rules.png)

1. <span data-ttu-id="b7eec-184">Naturalmente, il modo migliore per assicurarsi che tutto funzioni correttamente consiste nell'inviare al server una richiesta HTTP.</span><span class="sxs-lookup"><span data-stu-id="b7eec-184">Of course, the best way to validate it's all working is to hit our server with an HTTP request.</span></span> <span data-ttu-id="b7eec-185">Dovrebbe comunque funzionare.</span><span class="sxs-lookup"><span data-stu-id="b7eec-185">It should still work.</span></span> <span data-ttu-id="b7eec-186">È anche possibile eliminare la regola **HTTP** per verificare che le regole del gruppo di sicurezza vengano applicate.</span><span class="sxs-lookup"><span data-stu-id="b7eec-186">You can even delete the **HTTP** rule to verify that the security group rules are now being applied.</span></span>

## <a name="one-more-thing"></a><span data-ttu-id="b7eec-187">Ultimo passaggio</span><span class="sxs-lookup"><span data-stu-id="b7eec-187">One more thing</span></span>

<span data-ttu-id="b7eec-188">Le regole di sicurezza sono difficili da configurare correttamente.</span><span class="sxs-lookup"><span data-stu-id="b7eec-188">Security rules are tricky to get right.</span></span> <span data-ttu-id="b7eec-189">È stato commesso un errore quando si è applicato questo nuovo gruppo di sicurezza e l'accesso SSH.</span><span class="sxs-lookup"><span data-stu-id="b7eec-189">We made a mistake when we applied this new security group - we lost our SSH access!</span></span> <span data-ttu-id="b7eec-190">Per risolvere questo problema, è possibile aggiungere un'altra regola al gruppo di sicurezza per supportare l'accesso SSH.</span><span class="sxs-lookup"><span data-stu-id="b7eec-190">To fix this, you can add another rule to the security group to support SSH access.</span></span> <span data-ttu-id="b7eec-191">Assicurarsi di limitare gli indirizzi TCP/IP in ingresso della regola a quelli di cui si è proprietari.</span><span class="sxs-lookup"><span data-stu-id="b7eec-191">Make sure to restrict the inbound TCP/IP addresses for the rule to be the ones you own.</span></span>

> [!WARNING]
> <span data-ttu-id="b7eec-192">Assicurarsi sempre di bloccare le porte usate per l'accesso amministrativo.</span><span class="sxs-lookup"><span data-stu-id="b7eec-192">Always make sure to lock down ports used for administrative access.</span></span> <span data-ttu-id="b7eec-193">Un approccio ancora migliore consiste nel creare una VPN per collegare la rete virtuale alla rete privata e consentire solo le richieste RDP o SSH da tale intervallo di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="b7eec-193">An even better approach is to create a VPN to link the virtual network to your private network and only allow RDP or SSH requests from that address range.</span></span> <span data-ttu-id="b7eec-194">È anche possibile sostituire la porta usata da SSH con una diversa da quella predefinita.</span><span class="sxs-lookup"><span data-stu-id="b7eec-194">You can also change the port used by SSH to be something other than the default.</span></span> <span data-ttu-id="b7eec-195">Tenere presente che cambiare le porte non è sufficiente per arrestare gli attacchi, ma semplicemente diventa un po' più difficile individuarle.</span><span class="sxs-lookup"><span data-stu-id="b7eec-195">Keep in mind that changing ports is not sufficient to stop attacks, it simply makes it a little harder to discover.</span></span>