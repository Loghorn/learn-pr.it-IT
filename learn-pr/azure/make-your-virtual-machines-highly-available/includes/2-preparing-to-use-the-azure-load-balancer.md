<span data-ttu-id="bd62d-101">Si supponga che l'azienda voglia verificare se Azure Load Balancer supporterà l'applicazione ERP (Enterprise Resource Planning).</span><span class="sxs-lookup"><span data-stu-id="bd62d-101">Suppose your company wants to see if the Azure Load Balancer will support your Enterprise Resource Planning (ERP) application.</span></span> <span data-ttu-id="bd62d-102">L'applicazione ha un'interfaccia Web per gli utenti e viene eseguita in più server.</span><span class="sxs-lookup"><span data-stu-id="bd62d-102">Your application has a web interface for users and runs on multiple servers.</span></span> <span data-ttu-id="bd62d-103">Ogni server ha una copia locale del database ERP che viene sincronizzata in tutti i server.</span><span class="sxs-lookup"><span data-stu-id="bd62d-103">Each server has a local copy of the ERP database which is synced across all servers.</span></span>

<span data-ttu-id="bd62d-104">Di seguito si esaminerà come un servizio di bilanciamento del carico può consentire di garantire la disponibilità elevata dei servizi.</span><span class="sxs-lookup"><span data-stu-id="bd62d-104">Here, you will look at how a load balancer can help provide high availability of services.</span></span> <span data-ttu-id="bd62d-105">Si identificherà la differenza tra le opzioni Basic e Standard del servizio di bilanciamento del carico e si osserverà come creare un servizio di bilanciamento del carico per Macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="bd62d-105">You will identify the difference between the basic and standard load balancer options and see how to create a load balancer for Azure Virtual Machines.</span></span>

## <a name="what-is-load-balancing"></a><span data-ttu-id="bd62d-106">Informazioni sul bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="bd62d-106">What is load balancing?</span></span>

<span data-ttu-id="bd62d-107">Il _bilanciamento del carico_ include varie tecniche per distribuire i carichi di lavoro, ad esempio di calcolo, di archiviazione e di rete, tra più dispositivi.</span><span class="sxs-lookup"><span data-stu-id="bd62d-107">_Load balancing_ describes various techniques for distributing workloads across multiple devices, such as compute, storage, and networking.</span></span> <span data-ttu-id="bd62d-108">L'obiettivo del bilanciamento del carico è ottimizzare l'uso di più risorse, in modo da garantirne la massima efficienza in caso di aumento del numero di istanze nell'infrastruttura e da assicurare il mantenimento dei servizi se alcuni componenti risultano non disponibili.</span><span class="sxs-lookup"><span data-stu-id="bd62d-108">The goal of load balancing is to optimize the use of multiple resources, to make the most efficient use these resources as an infrastructure is scaled out, and to ensure services are maintained if some components are unavailable.</span></span>

<span data-ttu-id="bd62d-109">Di seguito verrà esaminato il supporto del bilanciamento del carico offerto da Azure per le macchine virtuali (VM).</span><span class="sxs-lookup"><span data-stu-id="bd62d-109">Here, will look at Azure's load balancing support for virtual machines (VMs).</span></span>

### <a name="what-is-high-availability"></a><span data-ttu-id="bd62d-110">Informazioni sulla disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="bd62d-110">What is High Availability?</span></span>

<span data-ttu-id="bd62d-111">La disponibilità elevata misura la capacità di un'applicazione o un servizio di rimanere accessibile nonostante un errore in qualsiasi componente del sistema.</span><span class="sxs-lookup"><span data-stu-id="bd62d-111">High availability (HA) measures the ability of an application or service to remain accessible despite a failure in any system component.</span></span> <span data-ttu-id="bd62d-112">Idealmente, non dovrebbe verificarsi alcuna perdita evidente di servizio.</span><span class="sxs-lookup"><span data-stu-id="bd62d-112">Ideally, there will be not be any noticeable loss of service.</span></span>

<span data-ttu-id="bd62d-113">Il bilanciamento del carico è fondamentale per garantire la disponibilità elevata perché consente a più VM di fungere da pool di server.</span><span class="sxs-lookup"><span data-stu-id="bd62d-113">Load balancing is fundamental to the delivery of HA because it allows multiple VMs to act as a pool of servers.</span></span> <span data-ttu-id="bd62d-114">Il pool può continuare a gestire le richieste anche se alcune VM si arrestano in modo anomalo o vengono portate offline a scopo di manutenzione.</span><span class="sxs-lookup"><span data-stu-id="bd62d-114">The pool can continue to service requests even if some VMs crash or are taken offline for maintenance.</span></span>

## <a name="what-is-the-azure-load-balancer"></a><span data-ttu-id="bd62d-115">Informazioni su Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="bd62d-115">What is the Azure Load Balancer?</span></span>

<span data-ttu-id="bd62d-116">**Azure Load Balancer** è un servizio di Azure che distribuisce le richieste in ingresso tra più VM di un pool.</span><span class="sxs-lookup"><span data-stu-id="bd62d-116">The **Azure Load Balancer** is an Azure service that distributes incoming requests across multiple VMs in a pool.</span></span> <span data-ttu-id="bd62d-117">Distribuisce il traffico di rete in ingresso tra un set di VM integre evitando le VM che non possono rispondere.</span><span class="sxs-lookup"><span data-stu-id="bd62d-117">It distributes incoming network traffic across a set of healthy VMs and avoids any VM that is not able to respond.</span></span>

<span data-ttu-id="bd62d-118">Azure Load Balancer opera al livello 4 (TCP, UDP) del modello a 7 livelli OSI.</span><span class="sxs-lookup"><span data-stu-id="bd62d-118">The Azure Load Balancer operates at Layer-4 (TCP, UDP) of the OSI 7-layer model.</span></span> <span data-ttu-id="bd62d-119">Può essere configurato per supportare scenari di applicazione TCP e UDP con traffico in ingresso verso VM di Azure nonché scenari in uscita in cui altri servizi di Azure passano traffico TCP e UDP a endpoint esterni tramite VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="bd62d-119">It can be configured to support TCP and UDP application scenarios where the traffic is inbound to Azure VMs, as well as outbound scenarios where other Azure services are passing TCP and UDP traffic out through Azure VMs to external endpoints.</span></span>

## <a name="public-vs-internal-load-balancers"></a><span data-ttu-id="bd62d-120">Servizi di bilanciamento del carico pubblici e interni</span><span class="sxs-lookup"><span data-stu-id="bd62d-120">Public vs. internal load balancers</span></span>

<span data-ttu-id="bd62d-121">Un'istanza di Azure Load Balancer può essere _pubblica_ o _interna_ a seconda dell'origine delle richieste in ingresso.</span><span class="sxs-lookup"><span data-stu-id="bd62d-121">An Azure Load Balancer can be either _public_ or _internal_ depending on the source of incoming requests.</span></span>

<span data-ttu-id="bd62d-122">Un **servizio di bilanciamento del carico pubblico** gestisce le richieste client provenienti dall'esterno dell'infrastruttura di Azure.</span><span class="sxs-lookup"><span data-stu-id="bd62d-122">A **public load balancer** handles client requests from outside of your Azure infrastructure.</span></span> <span data-ttu-id="bd62d-123">L'indirizzo IP pubblico del servizio di bilanciamento del carico viene configurato automaticamente come front-end di tale servizio quando si creano l'indirizzo IP pubblico e la risorsa del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="bd62d-123">The public IP address of the load balancer is automatically configured as the load balancer's front end when you create the public IP and the load balancer resource.</span></span> <span data-ttu-id="bd62d-124">La figura seguente illustra un servizio di bilanciamento del carico pubblico.</span><span class="sxs-lookup"><span data-stu-id="bd62d-124">The following illustration shows a public load balancer.</span></span>

![Figura con un servizio di bilanciamento del carico pubblico che distribuisce le richieste client da Internet a tre VM in una rete virtuale.](../media-draft/2-public-load-balancer.png)

<span data-ttu-id="bd62d-126">Un **servizio di bilanciamento del carico interno** elabora le richieste provenienti dall'interno di una rete virtuale o tramite una VPN.</span><span class="sxs-lookup"><span data-stu-id="bd62d-126">An **internal load balancer** processes requests from within a virtual network (or through a VPN).</span></span> <span data-ttu-id="bd62d-127">Distribuisce le richieste alle risorse in tale rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="bd62d-127">It distributes requests to resources within that vNet.</span></span> <span data-ttu-id="bd62d-128">Il servizio di bilanciamento del carico, gli indirizzi IP front-end e le reti virtuali non sono direttamente accessibili da Internet.</span><span class="sxs-lookup"><span data-stu-id="bd62d-128">The load balancer, frontend IP addresses, and virtual networks are not directly accessible from the internet.</span></span> <span data-ttu-id="bd62d-129">La figura seguente illustra un'architettura contenente sia un servizio di bilanciamento del carico pubblico che uno interno.</span><span class="sxs-lookup"><span data-stu-id="bd62d-129">The following illustration shows an architecture containing both a public and internal load balancer.</span></span> <span data-ttu-id="bd62d-130">Il servizio di bilanciamento del carico pubblico gestisce le richieste esterne, mentre quello interno inoltra le richieste alle VM e ai database interni per l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="bd62d-130">The public load balancer handles external requests while the internal load balancer forwards the requests to the internal VMs and databases for processing.</span></span>

![Figura con un servizio di bilanciamento del carico pubblico che inoltra le richieste client a un servizio di bilanciamento del carico interno.](../media-draft/2-internal-load-balancer.png)

## <a name="how-does-the-azure-load-balancer-work"></a><span data-ttu-id="bd62d-134">Funzionamento di Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="bd62d-134">How does the Azure Load Balancer work?</span></span>

<span data-ttu-id="bd62d-135">Azure Load Balancer usa le informazioni configurate nelle **regole** e nei **probe di integrità** per determinare come il nuovo traffico in ingresso ricevuto nel **front-end** di Load Balancer verrà distribuito alle istanze di VM di un **pool back-end**.</span><span class="sxs-lookup"><span data-stu-id="bd62d-135">The Azure Load Balancer uses information configured in **rules** and **health probes** to determine how new inbound traffic that is received on the Load Balancer's **frontend** is distributed to VM instances in a **backend pool**.</span></span>

### <a name="frontend"></a><span data-ttu-id="bd62d-136">Front-end</span><span class="sxs-lookup"><span data-stu-id="bd62d-136">Frontend</span></span>

<span data-ttu-id="bd62d-137">Il front-end del servizio di bilanciamento del carico è una configurazione IP contenente uno o più indirizzi IP pubblici che consente l'accesso al servizio di bilanciamento del carico e alle relative applicazioni tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="bd62d-137">The load balancer frontend is an IP configuration, containing one or more public IP addresses, that enables access to the load balancer and its applications over the Internet.</span></span>

### <a name="backend-address-pool"></a><span data-ttu-id="bd62d-138">Pool di indirizzi back-end</span><span class="sxs-lookup"><span data-stu-id="bd62d-138">Backend address pool</span></span>

<span data-ttu-id="bd62d-139">Le macchine virtuali si connettono a un servizio di bilanciamento del carico usando una scheda di interfaccia di rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="bd62d-139">Virtual machines connect to a load balancer using their virtual network interface card (vNIC).</span></span> <span data-ttu-id="bd62d-140">Il pool di indirizzi back-end contiene gli indirizzi IP delle schede di interfaccia di rete virtuali connesse al servizio bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="bd62d-140">The back-end address pool contains the IP addresses of the vNICs that are connected to the load balancer.</span></span> <span data-ttu-id="bd62d-141">Se si inseriscono tutte le VM in un set di disponibilità, è possibile usare tale set per aggiungere facilmente le VM al pool back-end durante la configurazione del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="bd62d-141">If you place all your VMs in an availability set, you can use this to easily add your VMs to a backend pool when configuring the load balancer.</span></span>

### <a name="health-probe"></a><span data-ttu-id="bd62d-142">Probe di integrità</span><span class="sxs-lookup"><span data-stu-id="bd62d-142">Health probe</span></span>

<span data-ttu-id="bd62d-143">I servizi di bilanciamento del carico usano i _probe di integrità_ per determinare quali macchine virtuali possono gestire le richieste.</span><span class="sxs-lookup"><span data-stu-id="bd62d-143">Load balancers use _health probes_ to determine which virtual machines can service requests.</span></span> <span data-ttu-id="bd62d-144">Il servizio di bilanciamento del carico distribuirà il traffico solo alle VM disponibili e operative.</span><span class="sxs-lookup"><span data-stu-id="bd62d-144">The load balancer will only distribute traffic to VMs that are available and operational.</span></span> 

<span data-ttu-id="bd62d-145">Un probe di integrità monitora porte specifiche in ogni VM.</span><span class="sxs-lookup"><span data-stu-id="bd62d-145">A health probe monitors specific ports on each VM.</span></span> <span data-ttu-id="bd62d-146">È possibile definire il tipo di risposta corrispondente all'integrità. Da un'applicazione Web, ad esempio, si può richiedere una risposta `HTTP 200 Available`.</span><span class="sxs-lookup"><span data-stu-id="bd62d-146">You can define what type of response corresponds to "health"; for example, you might require an `HTTP 200 Available` response from a web application.</span></span> <span data-ttu-id="bd62d-147">Per impostazione predefinita, una VM verrà contrassegnata come non disponibile dopo due errori consecutivi a intervalli di 15 secondi.</span><span class="sxs-lookup"><span data-stu-id="bd62d-147">By default, a VM will be marked as "unavailable" after two consecutive failures at 15-second intervals.</span></span>

### <a name="load-balancer-rules"></a><span data-ttu-id="bd62d-148">Regole del servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="bd62d-148">Load balancer rules</span></span>

<span data-ttu-id="bd62d-149">Le _regole_ del servizio di bilanciamento del carico definiscono come verrà distribuito il traffico alle VM back-end.</span><span class="sxs-lookup"><span data-stu-id="bd62d-149">Load balancer _rules_ define how traffic is distributed to backend VMs.</span></span> <span data-ttu-id="bd62d-150">L'obiettivo è distribuire equamente le richieste tra le VM integre del pool back-end.</span><span class="sxs-lookup"><span data-stu-id="bd62d-150">The goal is to distribute request fairly across the healthy VMs in the backend pool.</span></span>

<span data-ttu-id="bd62d-151">Azure Load Balancer usa un algoritmo basato su hash per riscrivere le intestazioni dei pacchetti in ingresso.</span><span class="sxs-lookup"><span data-stu-id="bd62d-151">The Azure Load Balancer uses a hash-based algorithm to rewrite the headers of inbound packets.</span></span> <span data-ttu-id="bd62d-152">Per impostazione predefinita, Load Balancer crea un hash da quanto segue:</span><span class="sxs-lookup"><span data-stu-id="bd62d-152">By default, the Load Balancer creates a hash from:</span></span>

- <span data-ttu-id="bd62d-153">Indirizzo IP di origine</span><span class="sxs-lookup"><span data-stu-id="bd62d-153">source IP address</span></span>
- <span data-ttu-id="bd62d-154">Porta di origine</span><span class="sxs-lookup"><span data-stu-id="bd62d-154">source port</span></span>
- <span data-ttu-id="bd62d-155">Indirizzo IP di destinazione</span><span class="sxs-lookup"><span data-stu-id="bd62d-155">destination IP address</span></span>
- <span data-ttu-id="bd62d-156">Porta di destinazione</span><span class="sxs-lookup"><span data-stu-id="bd62d-156">destination port</span></span>
- <span data-ttu-id="bd62d-157">Numero di protocollo IP</span><span class="sxs-lookup"><span data-stu-id="bd62d-157">IP protocol number</span></span>

<span data-ttu-id="bd62d-158">Questo meccanismo garantisce che tutti i pacchetti in un flusso client di pacchetti vengano inviati alla stessa istanza di VM back-end.</span><span class="sxs-lookup"><span data-stu-id="bd62d-158">This mechanism ensures that all packets within a packet client flow are sent to the same backend VM instance.</span></span> <span data-ttu-id="bd62d-159">Un nuovo flusso da un client userà una diversa porta di origine allocata in modo casuale, di conseguenza l'hash sarà diverso e il servizio di bilanciamento del carico potrebbe inviare tale flusso a un altro endpoint back-end.</span><span class="sxs-lookup"><span data-stu-id="bd62d-159">A new flow from a client will use a different randomly allocated source port, so the hash will change, and the load balancer may send this flow to a different backend endpoint.</span></span>

## <a name="basic-vs-standard-load-balancer-skus"></a><span data-ttu-id="bd62d-160">SKU Basic e Standard di Load Balancer</span><span class="sxs-lookup"><span data-stu-id="bd62d-160">Basic vs. Standard load balancer SKUs</span></span>

<span data-ttu-id="bd62d-161">Sono disponibili due tipi di Azure Load Balancer: **Basic** e **Standard**,</span><span class="sxs-lookup"><span data-stu-id="bd62d-161">There are two types of Azure Load Balancers: **Basic** and **Standard**.</span></span> <span data-ttu-id="bd62d-162">con differenze di scalabilità, funzionalità e prezzo.</span><span class="sxs-lookup"><span data-stu-id="bd62d-162">They differ in scale, features, and pricing.</span></span> <span data-ttu-id="bd62d-163">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="bd62d-163">For example:</span></span>

- <span data-ttu-id="bd62d-164">HTTPS è supportato dallo SKU Standard ma non da Basic.</span><span class="sxs-lookup"><span data-stu-id="bd62d-164">Standard supports HTTPS while Basic does not</span></span>
- <span data-ttu-id="bd62d-165">Standard supporta dimensioni dei pool notevolmente superiori.</span><span class="sxs-lookup"><span data-stu-id="bd62d-165">Pool size can be much larger in Standard</span></span>
- <span data-ttu-id="bd62d-166">Basic è gratuito, mentre lo SKU Standard comporta l'addebito di costi in base alle regole e alla velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="bd62d-166">Basic is no-cost while Standard is charged based on rules and throughput.</span></span>

<span data-ttu-id="bd62d-167">Lo SKU Standard è una soprainsieme di Basic, quindi qualsiasi scenario per cui è idoneo Basic funzionerà anche in Standard.</span><span class="sxs-lookup"><span data-stu-id="bd62d-167">Standard is a superset of Basic, so any scenario suitable for Basic should also work on Standard.</span></span> <span data-ttu-id="bd62d-168">Lo SKU Basic è in genere da usare solo per prototipi e test, mentre lo SKU Standard è consigliato per la produzione.</span><span class="sxs-lookup"><span data-stu-id="bd62d-168">The Basic SKU is generally intended for prototyping and testing while Standard is recommended for production.</span></span>

## <a name="start-the-deployment-of-a-basic-public-load-balancer"></a><span data-ttu-id="bd62d-169">Avviare la distribuzione di un servizio di bilanciamento del carico pubblico Basic</span><span class="sxs-lookup"><span data-stu-id="bd62d-169">Start the deployment of a Basic Public Load Balancer</span></span>

<span data-ttu-id="bd62d-170">Per creare un sistema di VM con carico bilanciato, è necessario creare il servizio di bilanciamento del carico e una rete virtuale che conterrà le macchine virtuali e quindi aggiungere le VM alla rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="bd62d-170">To create a load-balanced VM system, you need to create the load balancer itself, create a virtual network to contain your virtual machines, and then add VMs to the virtual network.</span></span>

<span data-ttu-id="bd62d-171">Per creare il servizio di bilanciamento del carico con il portale di Azure, si definiscono gli elementi seguenti.</span><span class="sxs-lookup"><span data-stu-id="bd62d-171">To create the load balancer using the Azure portal, you define:</span></span>

- <span data-ttu-id="bd62d-172">Nome del servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="bd62d-172">Load balancer name</span></span>
- <span data-ttu-id="bd62d-173">Tipo: pubblico o interno</span><span class="sxs-lookup"><span data-stu-id="bd62d-173">Type: Public or Internal</span></span>
- <span data-ttu-id="bd62d-174">SKU: Basic o Standard</span><span class="sxs-lookup"><span data-stu-id="bd62d-174">SKU: Basic or Standard</span></span>
- <span data-ttu-id="bd62d-175">Indirizzo IP pubblico: dinamico o statico</span><span class="sxs-lookup"><span data-stu-id="bd62d-175">Public IP address: Dynamic or Static</span></span>
- <span data-ttu-id="bd62d-176">Gruppo di risorse e località</span><span class="sxs-lookup"><span data-stu-id="bd62d-176">Resource group and Location</span></span>

<span data-ttu-id="bd62d-177">Dato che le VM back-end verranno tutte connesse alla stessa rete virtuale, sarà quindi necessario configurare questa risorsa:</span><span class="sxs-lookup"><span data-stu-id="bd62d-177">Your backend VMs will all be connected to the same virtual network (vNET), so you next need to configure this resource:</span></span>

- <span data-ttu-id="bd62d-178">Nome della rete virtuale</span><span class="sxs-lookup"><span data-stu-id="bd62d-178">vNET name</span></span>
- <span data-ttu-id="bd62d-179">Spazio indirizzi da usare, ad esempio 172.20.0.0/16</span><span class="sxs-lookup"><span data-stu-id="bd62d-179">Address space to use, such as 172.20.0.0/16</span></span>
- <span data-ttu-id="bd62d-180">Gruppo di risorse</span><span class="sxs-lookup"><span data-stu-id="bd62d-180">Resource group</span></span>
- <span data-ttu-id="bd62d-181">Nome della subnet da usare</span><span class="sxs-lookup"><span data-stu-id="bd62d-181">Name for the subnet to use</span></span>
- <span data-ttu-id="bd62d-182">Spazio indirizzi della subnet (che deve essere incluso nello spazio principale), ad esempio 172.20.0.0/24</span><span class="sxs-lookup"><span data-stu-id="bd62d-182">Address space for the subnet (must be within the main space), such as 172.20.0.0/24</span></span>

<span data-ttu-id="bd62d-183">È quindi necessario creare e distribuire le VM back-end e configurarle per l'uso della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="bd62d-183">You then need to create and deploy your backend VMs and configure them to use your vNET.</span></span> <span data-ttu-id="bd62d-184">È anche consigliabile inserire le VM nello stesso set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="bd62d-184">You should also place your VMs into the same availability set.</span></span> <span data-ttu-id="bd62d-185">I set di disponibilità definiscono il livello di tolleranza di errore in un gruppo di VM, ma per il bilanciamento del carico facilitano anche l'assegnazione delle VM ai pool back-end.</span><span class="sxs-lookup"><span data-stu-id="bd62d-185">Availability sets define the level of fault tolerance across a group of VMs, but for load balancing, they also help you assign your VMs to backend pools.</span></span>

<span data-ttu-id="bd62d-186">È stato illustrato come usare un'istanza di Azure Load Balancer nell'ambito di una soluzione a disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="bd62d-186">You have now seen how to use an Azure Load Balancer as part of a high-availability solution.</span></span> <span data-ttu-id="bd62d-187">Questi passaggi verranno successivamente usati per distribuire un servizio di bilanciamento del carico personalizzato.</span><span class="sxs-lookup"><span data-stu-id="bd62d-187">Next, you will use these steps to deploy your own load balancer.</span></span>