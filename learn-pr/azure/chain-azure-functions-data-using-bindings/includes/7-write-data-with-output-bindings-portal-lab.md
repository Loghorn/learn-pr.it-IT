<span data-ttu-id="b0451-101">Nell'esercizio precedente è stato implementato uno scenario per cercare i segnalibri in un database Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="b0451-101">In our last exercise, we implemented a scenario to look up bookmarks in an Azure Cosmos DB database.</span></span> <span data-ttu-id="b0451-102">È stata inoltre configurata un'associazione di input per leggere i dati dalla raccolta di segnalibri.</span><span class="sxs-lookup"><span data-stu-id="b0451-102">We configured an input binding to read data from our bookmarks collection.</span></span> <span data-ttu-id="b0451-103">Ma si può fare di più.</span><span class="sxs-lookup"><span data-stu-id="b0451-103">But, we can do more.</span></span> <span data-ttu-id="b0451-104">Ad esempio, è possibile espandere lo scenario per includere anche la scrittura.</span><span class="sxs-lookup"><span data-stu-id="b0451-104">Let's expand the scenario to include writing.</span></span> <span data-ttu-id="b0451-105">Prendere in considerazione il diagramma di flusso seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-105">Consider the following flowchart:</span></span>

![Diagramma di flusso che illustra il processo per trovare un segnalibro nel back-end di Cosmos DB.](../media/7-add-bookmark-flow-small.png)

<span data-ttu-id="b0451-110">In questo scenario si riceveranno richieste per aggiungere segnalibri alla raccolta.</span><span class="sxs-lookup"><span data-stu-id="b0451-110">In this scenario, we'll receive requests to add bookmarks to our collection.</span></span> <span data-ttu-id="b0451-111">Le richieste passano la chiave desiderata, o ID, insieme all'URL del segnalibro.</span><span class="sxs-lookup"><span data-stu-id="b0451-111">The requests pass in the desired key, or ID, along with the bookmark URL.</span></span> <span data-ttu-id="b0451-112">Come si può notare nel diagramma di flusso, si riceverà un errore se la chiave esiste già nel back-end.</span><span class="sxs-lookup"><span data-stu-id="b0451-112">As you can see in the flowchart, we'll respond with an error if the key already exists in our back end.</span></span>

<span data-ttu-id="b0451-113">Se la chiave che è stata passata *non* viene trovata, il nuovo segnalibro verrà aggiunto al database.</span><span class="sxs-lookup"><span data-stu-id="b0451-113">If the key that was passed to us is *not* found, we'll add the new bookmark to our database.</span></span> <span data-ttu-id="b0451-114">È possibile andare anche oltre.</span><span class="sxs-lookup"><span data-stu-id="b0451-114">We could stop there, but let's do a little more.</span></span>

<span data-ttu-id="b0451-115">Si può infatti notare un altro passaggio nel diagramma di flusso.</span><span class="sxs-lookup"><span data-stu-id="b0451-115">Notice another step in the flowchart?</span></span> <span data-ttu-id="b0451-116">Finora non si è fatto molto con i dati ricevuti in termini di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="b0451-116">So far we haven't done much with the data that we receive in terms of processing.</span></span> <span data-ttu-id="b0451-117">Sono stati semplicemente spostati in un database.</span><span class="sxs-lookup"><span data-stu-id="b0451-117">We move what we receive into a database.</span></span> <span data-ttu-id="b0451-118">Tuttavia, in una soluzione reale è possibile che i dati vengano in qualche modo elaborati.</span><span class="sxs-lookup"><span data-stu-id="b0451-118">However, in a real solution, it is possible that we'd probably process the data in some fashion.</span></span> <span data-ttu-id="b0451-119">Si può decidere di eseguire l'intera elaborazione nella stessa funzione, ma in questo lab verrà illustrato un modello che trasferisce l'ulteriore elaborazione a un altro componente o a un'altra parte della logica di business.</span><span class="sxs-lookup"><span data-stu-id="b0451-119">We can decide to do all processing in the same function, but in this lab we'll show a pattern that offloads further processing to another component or piece of business logic.</span></span>

<span data-ttu-id="b0451-120">Un valido esempio di questo offload del lavoro nello scenario basato sui segnalibri</span><span class="sxs-lookup"><span data-stu-id="b0451-120">What might be a good example of this offloading of work in our bookmarks scenario?</span></span> <span data-ttu-id="b0451-121">potrebbe essere l'invio di un nuovo segnalibro a un servizio di generazione di codice a matrice.</span><span class="sxs-lookup"><span data-stu-id="b0451-121">Well, what if we send the new bookmark to a QR code generation service?</span></span> <span data-ttu-id="b0451-122">Questo servizio potrebbe, a sua volta, generare un codice a matrice per l'URL, archiviare l'immagine nell'archivio BLOB e aggiungere l'indirizzo dell'immagine del codice a matrice nella voce della raccolta di segnalibri.</span><span class="sxs-lookup"><span data-stu-id="b0451-122">That service would, in turn, generate a QR code for the URL, store the image in blob storage, and add the address of the QR image back into the entry in our bookmarks collection.</span></span> <span data-ttu-id="b0451-123">Chiamare un servizio per generare un'immagine del codice a matrice può richiedere molto tempo, pertanto invece di attendere il risultato è consigliabile trasferire l'operazione a una funzione che se ne occuperà in modalità asincrona.</span><span class="sxs-lookup"><span data-stu-id="b0451-123">Calling a service to generate a QR image is time consuming so, rather than wait for the result, we hand it off to a function and let it take care of this asynchronously.</span></span>

<span data-ttu-id="b0451-124">Proprio come Funzioni di Azure supporta associazioni di input per varie origini di integrazione, include anche un set di modelli di associazioni di output per semplificare la scrittura dei dati nelle origini dati.</span><span class="sxs-lookup"><span data-stu-id="b0451-124">Just as Azure Functions supports input bindings for various integration sources, it also has a set of output bindings templates to make it easy for you to write data to data sources.</span></span> <span data-ttu-id="b0451-125">Le associazioni di output vengono configurate anche nel file *function.json*.</span><span class="sxs-lookup"><span data-stu-id="b0451-125">Output bindings are also configured in the *function.json* file.</span></span>  <span data-ttu-id="b0451-126">Come si vedrà in questo esercizio, è possibile configurare la funzione per lavorare con più origini dati e servizi.</span><span class="sxs-lookup"><span data-stu-id="b0451-126">As you'll see in this exercise, we can configure our function to work with multiple data sources and services.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b0451-127">Questo esercizio si basa su quello precedente.</span><span class="sxs-lookup"><span data-stu-id="b0451-127">This exercise builds on the previous one.</span></span> <span data-ttu-id="b0451-128">Usa lo stesso database di Azure Cosmos DB e la stessa associazione di input.</span><span class="sxs-lookup"><span data-stu-id="b0451-128">It uses the same Azure Cosmos DB database and input binding.</span></span> <span data-ttu-id="b0451-129">Se non si è ancora svolta tale unità, è consigliabile farlo prima di procedere con questa.</span><span class="sxs-lookup"><span data-stu-id="b0451-129">If you haven't worked through that unit, we recommend doing so before you proceed with this one.</span></span>

## <a name="create-an-http-triggered-function"></a><span data-ttu-id="b0451-130">Creare una funzione attivata da HTTP</span><span class="sxs-lookup"><span data-stu-id="b0451-130">Create an HTTP-triggered function</span></span>

1. <span data-ttu-id="b0451-131">Assicurarsi di aver eseguito l'accesso al [portale di Azure](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true) usando lo stesso account con cui è stata attivata la sandbox.</span><span class="sxs-lookup"><span data-stu-id="b0451-131">Make sure you are signed into the [Azure portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true) using the same account you activated the sandbox with.</span></span>

2. <span data-ttu-id="b0451-132">Nel portale passare all'app per le funzioni creata in questo modulo.</span><span class="sxs-lookup"><span data-stu-id="b0451-132">In the portal, navigate to the function app that you created in this module.</span></span>

3. <span data-ttu-id="b0451-133">Selezionare il pulsante Aggiungi (**+**) accanto a **Funzioni**.</span><span class="sxs-lookup"><span data-stu-id="b0451-133">Select the Add (**+**) button next to **Functions**.</span></span> <span data-ttu-id="b0451-134">Questa azione avvia il processo di creazione della funzione.</span><span class="sxs-lookup"><span data-stu-id="b0451-134">This action starts the function creation process.</span></span> 
4. <span data-ttu-id="b0451-135">La pagina mostra il set corrente di trigger supportati.</span><span class="sxs-lookup"><span data-stu-id="b0451-135">The page shows us the current set of supported triggers.</span></span> <span data-ttu-id="b0451-136">Selezionare **Trigger HTTP**.</span><span class="sxs-lookup"><span data-stu-id="b0451-136">Select **HTTP trigger**.</span></span>

5. <span data-ttu-id="b0451-137">Compilare il riquadro **Nuova funzione** visualizzato a destra usando i valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="b0451-137">Fill out the **New Function** pane that's displayed at the right by using the following values:</span></span>

    |<span data-ttu-id="b0451-138">Campo</span><span class="sxs-lookup"><span data-stu-id="b0451-138">Field</span></span>  |<span data-ttu-id="b0451-139">Valore</span><span class="sxs-lookup"><span data-stu-id="b0451-139">Value</span></span>  |
    |---------|---------|
    |<span data-ttu-id="b0451-140">Nome</span><span class="sxs-lookup"><span data-stu-id="b0451-140">Name</span></span>     |   [!INCLUDE [func-name-add](./func-name-add.md)]     |
    | <span data-ttu-id="b0451-141">Livello di autorizzazione</span><span class="sxs-lookup"><span data-stu-id="b0451-141">Authorization level</span></span> | <span data-ttu-id="b0451-142">**Funzione**</span><span class="sxs-lookup"><span data-stu-id="b0451-142">**Function**</span></span> |

6. <span data-ttu-id="b0451-143">Selezionare **Crea** per creare la funzione.</span><span class="sxs-lookup"><span data-stu-id="b0451-143">Select **Create** to create your function.</span></span> <span data-ttu-id="b0451-144">Verrà aperto il file **index.js** nell'editor di codice e visualizzata un'implementazione predefinita della funzione attivata da HTTP.</span><span class="sxs-lookup"><span data-stu-id="b0451-144">This action opens the **index.js** file in the code editor and displays a default implementation of the HTTP-triggered function.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b0451-145">In questo esercizio sarà possibile velocizzare le operazioni usando il *codice* e la *configurazione* dell'unità precedente come punto di partenza.</span><span class="sxs-lookup"><span data-stu-id="b0451-145">In this exercise, we'll speed up things by using the *code* and *configuration* from the previous unit as a starting point.</span></span>

7. <span data-ttu-id="b0451-146">Sostituire tutto il codice nel file **index.js** con il codice del frammento seguente e quindi selezionare **Salva** per salvare la modifica:</span><span class="sxs-lookup"><span data-stu-id="b0451-146">Replace all code in the **index.js** file with the code from the following snippet, and then select **Save** to save the change:</span></span>

   [!code-javascript[](../code/find-bookmark-single.js)]

   <span data-ttu-id="b0451-147">Se questo codice ha un'aria familiare, è perché si tratta dell'implementazione della funzione [!INCLUDE [func-name-find](./func-name-find.md)].</span><span class="sxs-lookup"><span data-stu-id="b0451-147">If this code looks familiar, that's because it's the implementation of our [!INCLUDE [func-name-find](./func-name-find.md)] function.</span></span> <span data-ttu-id="b0451-148">Come si può immaginare, la funzione non potrà essere usata finché non si definiscono le stesse associazioni.</span><span class="sxs-lookup"><span data-stu-id="b0451-148">As you would expect, the function won't work until we define the same bindings.</span></span>

1. <span data-ttu-id="b0451-149">Aprire il file **function.json** dalla funzione [!INCLUDE [func-name-add](./func-name-add.md)].</span><span class="sxs-lookup"><span data-stu-id="b0451-149">Open the **function.json** file from the [!INCLUDE [func-name-add](./func-name-add.md)] function.</span></span>

11. <span data-ttu-id="b0451-150">Sostituire il contenuto del file con il codice JSON seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-150">Replace the contents of this file with the following JSON:</span></span>

    ```json
    {
      "bindings": [
        {
          "authLevel": "function",
          "type": "httpTrigger",
          "direction": "in",
          "name": "req"
        },
        {
          "type": "http",
          "direction": "out",
          "name": "res"
        },
        {
          "type": "documentDB",
          "name": "bookmark",
          "databaseName": "func-io-learn-db",
          "collectionName": "Bookmarks",
          "connection": "unit3test_DOCUMENTDB",
          "direction": "in",
          "id": "{id}"
        }
      ],
      "disabled": false
    }
    ```

12. <span data-ttu-id="b0451-151">Assicurarsi di fare clic su **Salva** per salvare tutte le modifiche.</span><span class="sxs-lookup"><span data-stu-id="b0451-151">Make sure to **Save** all changes.</span></span>

<span data-ttu-id="b0451-152">Nei passaggi precedenti sono state configurate le associazioni per la nuova funzione copiando le rispettive definizioni da un'altra funzione.</span><span class="sxs-lookup"><span data-stu-id="b0451-152">In the preceding steps, you configured bindings for your new function by copying binding definitions from another function.</span></span> <span data-ttu-id="b0451-153">Naturalmente è possibile creare una nuova associazione tramite l'interfaccia utente, ma è importante comprendere che è disponibile anche questa alternativa.</span><span class="sxs-lookup"><span data-stu-id="b0451-153">Of course, you could have created a new binding through the UI, but it is good to understand that this alternative is available to you.</span></span>

## <a name="try-it-out"></a><span data-ttu-id="b0451-154">Provare questa operazione</span><span class="sxs-lookup"><span data-stu-id="b0451-154">Try it out</span></span>

1. <span data-ttu-id="b0451-155">Selezionare **Recupera URL della funzione** in alto a destra, selezionare **default (Function key)** (predefinita - tasto funzione) e quindi selezionare **Copia** per copiare l'URL della funzione.</span><span class="sxs-lookup"><span data-stu-id="b0451-155">Select **Get function URL** at the top right, select **default (Function key)**, and then select **Copy** to copy the function's URL.</span></span>

2. <span data-ttu-id="b0451-156">Incollare l'URL copiato nella barra degli indirizzi del browser.</span><span class="sxs-lookup"><span data-stu-id="b0451-156">Paste the copied URL into your browser's address bar.</span></span> <span data-ttu-id="b0451-157">Aggiungere il valore di stringa di query `&id=docs` alla fine dell'URL e quindi premere INVIO per eseguire la richiesta.</span><span class="sxs-lookup"><span data-stu-id="b0451-157">Add the query string value `&id=docs` to the end of the URL, and then press Enter to execute the request.</span></span> <span data-ttu-id="b0451-158">Se tutto funziona, verrà visualizzata una risposta che include un URL per tale risorsa.</span><span class="sxs-lookup"><span data-stu-id="b0451-158">If all goes well, you should see a response that includes a URL to that resource.</span></span>

<span data-ttu-id="b0451-159">Come procedere a questo punto?</span><span class="sxs-lookup"><span data-stu-id="b0451-159">So, where are we at?</span></span> <span data-ttu-id="b0451-160">Finora si è semplicemente replicata la procedura eseguita nel lab precedente</span><span class="sxs-lookup"><span data-stu-id="b0451-160">Well, so far we've really just replicated what we did in the previous lab.</span></span> <span data-ttu-id="b0451-161">ed è corretto.</span><span class="sxs-lookup"><span data-stu-id="b0451-161">But that's okay.</span></span> <span data-ttu-id="b0451-162">Quello che è stato fatto nell'ultimo lab serve infatti come punto di partenza per questo.</span><span class="sxs-lookup"><span data-stu-id="b0451-162">We're copying what we did in the last lab to serve as a starting point for this one.</span></span> <span data-ttu-id="b0451-163">Ora è il momento di provare nuove funzionalità,</span><span class="sxs-lookup"><span data-stu-id="b0451-163">We'll work on the new stuff next.</span></span> <span data-ttu-id="b0451-164">nello specifico per scrivere nel database.</span><span class="sxs-lookup"><span data-stu-id="b0451-164">That is, we'll write to our database.</span></span> <span data-ttu-id="b0451-165">A questo scopo, è necessaria un'*associazione di output*.</span><span class="sxs-lookup"><span data-stu-id="b0451-165">For that, we'll need an *output binding*.</span></span>

## <a name="define-azure-cosmos-db-output-binding"></a><span data-ttu-id="b0451-166">Definire l'associazione di output di Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="b0451-166">Define Azure Cosmos DB output binding</span></span>

<span data-ttu-id="b0451-167">Invece di definire una nuova associazione di output tramite l'interfaccia utente, l'associazione verrà creata aggiornando manualmente il file di configurazione *function.json*.</span><span class="sxs-lookup"><span data-stu-id="b0451-167">Rather than define a new output binding by going through the user interface, you'll create this binding by updating the configuration file, *function.json*, by hand.</span></span>

1. <span data-ttu-id="b0451-168">Assicurarsi che il file *function.json* per [!INCLUDE [func-name-add](./func-name-add.md)] sia aperto nell'editor.</span><span class="sxs-lookup"><span data-stu-id="b0451-168">Make sure the *function.json* file for [!INCLUDE [func-name-add](./func-name-add.md)] is open in the editor.</span></span>

1. <span data-ttu-id="b0451-169">Copiare l'associazione denominata `bookmark` in tale file.</span><span class="sxs-lookup"><span data-stu-id="b0451-169">Copy the binding that's named `bookmark` in that file.</span></span>

1. <span data-ttu-id="b0451-170">Posizionare il cursore subito dopo la parentesi graffa chiusa (}) e immediatamente prima della parentesi quadra chiusa (]).</span><span class="sxs-lookup"><span data-stu-id="b0451-170">Place your cursor directly after the closing curly bracket (}), and right before the closing square bracket (]).</span></span> <span data-ttu-id="b0451-171">Aggiungere una virgola (,) e quindi incollare la copia dell'associazione in questo punto.</span><span class="sxs-lookup"><span data-stu-id="b0451-171">Add a comma (,), and then paste the copy of the binding here.</span></span> <span data-ttu-id="b0451-172">Il file config *function.json* dovrebbe avere un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-172">Your *function.json* config file should now look like the following:</span></span>

   [!code-json[](../code/config-new-entry.json?highlight=22-31)]

1. <span data-ttu-id="b0451-173">Modificare l'associazione incollata, con le modifiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="b0451-173">Edit the binding you pasted, with the following changes:</span></span>

    |<span data-ttu-id="b0451-174">Proprietà</span><span class="sxs-lookup"><span data-stu-id="b0451-174">Property</span></span>   |<span data-ttu-id="b0451-175">Valore precedente</span><span class="sxs-lookup"><span data-stu-id="b0451-175">Old value</span></span>  |<span data-ttu-id="b0451-176">Nuovo valore</span><span class="sxs-lookup"><span data-stu-id="b0451-176">New value</span></span>  |
    |---------|---------|---------|
    |<span data-ttu-id="b0451-177">name</span><span class="sxs-lookup"><span data-stu-id="b0451-177">name</span></span>     |   <span data-ttu-id="b0451-178">bookmark</span><span class="sxs-lookup"><span data-stu-id="b0451-178">bookmark</span></span>      |  <span data-ttu-id="b0451-179">**newbookmark**</span><span class="sxs-lookup"><span data-stu-id="b0451-179">**newbookmark**</span></span>       |
    |<span data-ttu-id="b0451-180">direction</span><span class="sxs-lookup"><span data-stu-id="b0451-180">direction</span></span>     |   <span data-ttu-id="b0451-181">in</span><span class="sxs-lookup"><span data-stu-id="b0451-181">in</span></span>      |   <span data-ttu-id="b0451-182">**out**</span><span class="sxs-lookup"><span data-stu-id="b0451-182">**out**</span></span>      |
    |<span data-ttu-id="b0451-183">id</span><span class="sxs-lookup"><span data-stu-id="b0451-183">id</span></span>     |      <span data-ttu-id="b0451-184">{id}</span><span class="sxs-lookup"><span data-stu-id="b0451-184">{id}</span></span>   |   <span data-ttu-id="b0451-185">**eliminare questa proprietà. Non esiste per l'associazione di output.**</span><span class="sxs-lookup"><span data-stu-id="b0451-185">**delete this property. It does not exist for the output binding.**</span></span>      |

1. <span data-ttu-id="b0451-186">Dopo aver apportato queste modifiche, il file è simile al codice JSON seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-186">After you've made these changes, your file looks like the following JSON:</span></span>

    [!code-json[](../code/config-q-complete.json?highlight=22-30)]

<span data-ttu-id="b0451-187">Questa è una semplice dimostrazione di come sia anche possibile creare associazioni direttamente nel file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="b0451-187">That was just a demo of how you can also create bindings directly in the configuration file.</span></span> <span data-ttu-id="b0451-188">In questo esempio, questa operazione ha senso perché si riutilizzano le proprietà di un'altra associazione,</span><span class="sxs-lookup"><span data-stu-id="b0451-188">In this example, it makes sense because you are reusing the properties from another binding.</span></span> <span data-ttu-id="b0451-189">vale a dire le proprietà `databaseName`, `collectionName` e `connection` che sono già state configurate per l'associazione di input di Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="b0451-189">That is, you're reusing the `databaseName`, `collectionName`, and `connection` that you already configured for your Azure Cosmos DB input binding.</span></span>

> [!NOTE]
> <span data-ttu-id="b0451-190">Il valore effettivo di `connection` nel file JSON precedente è il nome assegnato alla connessione al momento della creazione.</span><span class="sxs-lookup"><span data-stu-id="b0451-190">The actual value of `connection` in the preceding JSON file is whatever name your connection was given when it was created.</span></span>

<span data-ttu-id="b0451-191">Prima di aggiornare il codice, è possibile aggiungere un'altra associazione che consentirà di pubblicare messaggi in una coda.</span><span class="sxs-lookup"><span data-stu-id="b0451-191">Before we update our code, let's add one more binding that will enable us to post messages to a queue.</span></span>

## <a name="define-azure-queue-storage-output-binding"></a><span data-ttu-id="b0451-192">Definire l'associazione di output dell'archiviazione code di Azure</span><span class="sxs-lookup"><span data-stu-id="b0451-192">Define Azure Queue Storage output binding</span></span>

<span data-ttu-id="b0451-193">Archiviazione code di Azure è un servizio che consente di archiviare messaggi a cui è possibile accedere da qualsiasi parte del mondo.</span><span class="sxs-lookup"><span data-stu-id="b0451-193">Azure Queue storage is a service for storing messages that can be accessed from anywhere in the world.</span></span> <span data-ttu-id="b0451-194">Le dimensioni di un singolo messaggio possono essere al massimo 64 KB e una coda può contenere milioni di messaggi, fino alla capacità complessiva dell'account di archiviazione in cui viene definita.</span><span class="sxs-lookup"><span data-stu-id="b0451-194">The size of a single message can be as much as 64 KB, and a queue can contain millions of messages&mdash;up to the total capacity of the storage account in which it is defined.</span></span> <span data-ttu-id="b0451-195">Il diagramma seguente illustra a livello generale come viene usata una coda in questo scenario:</span><span class="sxs-lookup"><span data-stu-id="b0451-195">The following diagram shows at a high level how a queue is used in our scenario:</span></span>

![Un'illustrazione che mostra una coda di archiviazione e due funzioni, una che esegue il push dei messaggi e l'altra che preleva i messaggi nella coda](../media/7-q-logical-small.png)

<span data-ttu-id="b0451-197">In questo esempio è possibile vedere che la nuova funzione [!INCLUDE [func-name-add](./func-name-add.md)] aggiunge messaggi a una coda.</span><span class="sxs-lookup"><span data-stu-id="b0451-197">Here you can see that the new function, [!INCLUDE [func-name-add](./func-name-add.md)], adds messages to a queue.</span></span> <span data-ttu-id="b0451-198">Un'altra funzione, ad esempio una funzione fittizia denominata *gen-qr-code*, preleverà i messaggi dalla stessa coda ed elaborerà la richiesta.</span><span class="sxs-lookup"><span data-stu-id="b0451-198">Another function&mdash;for example, a fictitious function called *gen-qr-code*&mdash;will pop messages from the same queue and process the request.</span></span>  <span data-ttu-id="b0451-199">Scrivendo o eseguendo il *push* dei messaggi nella coda da [!INCLUDE [func-name-add](./func-name-add.md)], si aggiungerà una nuova associazione di output alla soluzione.</span><span class="sxs-lookup"><span data-stu-id="b0451-199">Since we write, or *push*, messages to the queue from [!INCLUDE [func-name-add](./func-name-add.md)], we'll add a new output binding to your solution.</span></span> <span data-ttu-id="b0451-200">Questa volta l'associazione verrà creata tramite l'interfaccia utente del portale.</span><span class="sxs-lookup"><span data-stu-id="b0451-200">Let's create the binding through the portal UI this time.</span></span>

1. <span data-ttu-id="b0451-201">Selezionare **Integrazione** nel menu della funzione a sinistra per aprire la scheda Integrazione.</span><span class="sxs-lookup"><span data-stu-id="b0451-201">Select **Integrate** in the left function menu to open the integration tab.</span></span>

2. <span data-ttu-id="b0451-202">Selezionare **Nuovo output** nella colonna **Output**.</span><span class="sxs-lookup"><span data-stu-id="b0451-202">Select **New Output** in the **Outputs** column.</span></span>
    <span data-ttu-id="b0451-203">Viene visualizzato un elenco di tutti i tipi di associazioni di output possibili.</span><span class="sxs-lookup"><span data-stu-id="b0451-203">A list of all possible output binding types is displayed.</span></span>

3. <span data-ttu-id="b0451-204">Nell'elenco selezionare **Archiviazione code di Azure** e quindi **Seleziona**.</span><span class="sxs-lookup"><span data-stu-id="b0451-204">In the list, select **Azure Queue Storage**, then select **Select**.</span></span>
    <span data-ttu-id="b0451-205">Questa azione apre la pagina di configurazione di output di Archiviazione code di Azure.</span><span class="sxs-lookup"><span data-stu-id="b0451-205">This action opens the Azure Queue Storage output configuration page.</span></span>

   <span data-ttu-id="b0451-206">Successivamente, si configurerà una connessione dell'account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="b0451-206">Next, we'll set up a storage account connection.</span></span> <span data-ttu-id="b0451-207">per l'hosting della coda.</span><span class="sxs-lookup"><span data-stu-id="b0451-207">This is where our queue will be hosted.</span></span>

4. <span data-ttu-id="b0451-208">A destra del campo **Connessione dell'account di archiviazione** selezionare **Nuova**.</span><span class="sxs-lookup"><span data-stu-id="b0451-208">To the right of the **Storage account connection** field, select **new**.</span></span>
   <span data-ttu-id="b0451-209">Verrà visualizzato il riquadro di selezione **Account di archiviazione**.</span><span class="sxs-lookup"><span data-stu-id="b0451-209">The **Storage Account** selection pane opens.</span></span>

5. <span data-ttu-id="b0451-210">All'inizio di questo modulo quando è stata creata l'app per le funzioni, è stato creato anche un account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="b0451-210">When we started this module and you created your function app, a storage account was also created at that time.</span></span> <span data-ttu-id="b0451-211">L'account è elencato in questo riquadro, quindi selezionarlo.</span><span class="sxs-lookup"><span data-stu-id="b0451-211">It's listed in this pane, so select it.</span></span> <span data-ttu-id="b0451-212">Il campo **Connessione dell'account di archiviazione** viene popolato con il nome di una connessione.</span><span class="sxs-lookup"><span data-stu-id="b0451-212">The **Storage account connection** field is populated with the name of a connection.</span></span> <span data-ttu-id="b0451-213">Se si vuole visualizzare il valore della stringa di connessione, selezionare **Mostra valore**.</span><span class="sxs-lookup"><span data-stu-id="b0451-213">If you want to see the connection string value, select **show value**.</span></span>

6. <span data-ttu-id="b0451-214">Anche se per tutti gli altri campi possono essere lasciati i valori predefiniti, verranno modificati i valori seguenti per rendere più significative le proprietà:</span><span class="sxs-lookup"><span data-stu-id="b0451-214">Although we could keep the default values in all the other fields, let's change the following to lend more meaning to the properties:</span></span>

    |<span data-ttu-id="b0451-215">Proprietà</span><span class="sxs-lookup"><span data-stu-id="b0451-215">Property</span></span>  |<span data-ttu-id="b0451-216">Valore precedente</span><span class="sxs-lookup"><span data-stu-id="b0451-216">Old value</span></span>  |<span data-ttu-id="b0451-217">Nuovo valore</span><span class="sxs-lookup"><span data-stu-id="b0451-217">New value</span></span>  | <span data-ttu-id="b0451-218">Descrizione</span><span class="sxs-lookup"><span data-stu-id="b0451-218">Description</span></span> |
    |---------|---------|---------|---------|
    |<span data-ttu-id="b0451-219">Nome della coda</span><span class="sxs-lookup"><span data-stu-id="b0451-219">Queue name</span></span>     |    <span data-ttu-id="b0451-220">outqueue</span><span class="sxs-lookup"><span data-stu-id="b0451-220">outqueue</span></span>     |  <span data-ttu-id="b0451-221">**bookmarks-post-process**</span><span class="sxs-lookup"><span data-stu-id="b0451-221">**bookmarks-post-process**</span></span>      | <span data-ttu-id="b0451-222">Si tratta del nome della coda usata per l'inserimento dei segnalibri, in modo che possano essere ulteriormente elaborati da un'altra funzione.</span><span class="sxs-lookup"><span data-stu-id="b0451-222">The name of the queue where we're placing bookmarks so that they can be processed further by another function.</span></span> |
    | <span data-ttu-id="b0451-223">Nome del parametro del messaggio</span><span class="sxs-lookup"><span data-stu-id="b0451-223">Message parameter name</span></span>    |  <span data-ttu-id="b0451-224">outputQueueItem</span><span class="sxs-lookup"><span data-stu-id="b0451-224">outputQueueItem</span></span>       |   <span data-ttu-id="b0451-225">**newmessage**</span><span class="sxs-lookup"><span data-stu-id="b0451-225">**newmessage**</span></span>      | <span data-ttu-id="b0451-226">Proprietà di associazione che verrà usata nel codice.</span><span class="sxs-lookup"><span data-stu-id="b0451-226">The binding property we'll use in code.</span></span> |

7. <span data-ttu-id="b0451-227">Ricordarsi di selezionare **Salva** per salvare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="b0451-227">Remember to select **Save** to save your changes.</span></span>

## <a name="update-function-implementation"></a><span data-ttu-id="b0451-228">Aggiornare l'implementazione della funzione</span><span class="sxs-lookup"><span data-stu-id="b0451-228">Update function implementation</span></span>

<span data-ttu-id="b0451-229">Tutte le associazioni sono ora impostate per la funzione [!INCLUDE [func-name-add](./func-name-add.md)].</span><span class="sxs-lookup"><span data-stu-id="b0451-229">We now have all our bindings set up for the [!INCLUDE [func-name-add](./func-name-add.md)] function.</span></span> <span data-ttu-id="b0451-230">È il momento di usarle nell'ambito della funzione.</span><span class="sxs-lookup"><span data-stu-id="b0451-230">It's time to use them in our function.</span></span>

1.  <span data-ttu-id="b0451-231">Selezionare la funzione [!INCLUDE [func-name-add](./func-name-add.md)] per aprire il file **index.js** nell'editor di codice.</span><span class="sxs-lookup"><span data-stu-id="b0451-231">Select your function, [!INCLUDE [func-name-add](./func-name-add.md)], to open the **index.js** file in the code editor.</span></span>

2. <span data-ttu-id="b0451-232">Sostituire tutto il codice nel file *index.js* con il codice del frammento seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-232">Replace all the code in the *index.js* file with the code from the following snippet:</span></span>

   [!code-javascript[](../code/add-bookmark.js)]

<span data-ttu-id="b0451-233">Verrà ora esaminato in dettaglio il funzionamento di questo codice:</span><span class="sxs-lookup"><span data-stu-id="b0451-233">Let's break down what this code does:</span></span>

* <span data-ttu-id="b0451-234">Dato che questa funzione modifica i dati, si prevede che la richiesta HTTP sia di tipo POST e che i dati del segnalibro facciano parte del corpo della richiesta.</span><span class="sxs-lookup"><span data-stu-id="b0451-234">Because this function changes our data, we expect the HTTP request to be a POST and the bookmark data to be part of the request body.</span></span>
* <span data-ttu-id="b0451-235">L'associazione di input di Azure Cosmos DB tenta di recuperare un documento o un segnalibro usando l'oggetto `id` ricevuto.</span><span class="sxs-lookup"><span data-stu-id="b0451-235">Our Azure Cosmos DB input binding attempts to retrieve a document, or bookmark, by using the `id` that we receive.</span></span> <span data-ttu-id="b0451-236">Se viene trovata una voce, l'oggetto `bookmark` verrà impostato.</span><span class="sxs-lookup"><span data-stu-id="b0451-236">If it finds an entry, the `bookmark` object will be set.</span></span> <span data-ttu-id="b0451-237">La condizione `if(bookmark)` verifica se è stata trovata una voce.</span><span class="sxs-lookup"><span data-stu-id="b0451-237">The `if(bookmark)` condition checks to see whether an entry was found.</span></span>
* <span data-ttu-id="b0451-238">L'aggiunta al database è un'operazione estremamente semplice che implica l'impostazione del parametro di associazione `context.bindings.newbookmark` sulla nuova voce del segnalibro, creata sotto forma di stringa JSON.</span><span class="sxs-lookup"><span data-stu-id="b0451-238">Adding to the database is as simple as setting the `context.bindings.newbookmark` binding parameter to the new bookmark entry, which we have created as a JSON string.</span></span>
* <span data-ttu-id="b0451-239">Anche pubblicare un messaggio nella coda è un'operazione semplice che prevede l'impostazione di `context.bindings.newmessage parameter`.</span><span class="sxs-lookup"><span data-stu-id="b0451-239">Posting a message to our queue is as simple as setting the  `context.bindings.newmessage parameter`.</span></span>

> [!NOTE]
> <span data-ttu-id="b0451-240">L'unica attività eseguita è stata quella di creare un'associazione di coda.</span><span class="sxs-lookup"><span data-stu-id="b0451-240">The only task you performed was to create a queue binding.</span></span> <span data-ttu-id="b0451-241">In modo esplicito non è stata creata alcuna coda,</span><span class="sxs-lookup"><span data-stu-id="b0451-241">You never created the queue explicitly.</span></span> <span data-ttu-id="b0451-242">il tutto è avvenuto automaticamente grazie alle associazioni.</span><span class="sxs-lookup"><span data-stu-id="b0451-242">You are witnessing the power of bindings!</span></span> <span data-ttu-id="b0451-243">Come riportato nel callout seguente, la coda viene infatti creata automaticamente se non esiste già.</span><span class="sxs-lookup"><span data-stu-id="b0451-243">As the following callout says, the queue is automatically created for you if it doesn't exist.</span></span>

![Screenshot che illustra che la coda verrà creata automaticamente.](../media/7-q-auto-create-small.png)

<span data-ttu-id="b0451-245">Questo è tutto.</span><span class="sxs-lookup"><span data-stu-id="b0451-245">So, that's it.</span></span> <span data-ttu-id="b0451-246">Nella sezione successiva verrà messo in pratica il lavoro svolto.</span><span class="sxs-lookup"><span data-stu-id="b0451-246">Let's see our work in action in the next section.</span></span>

## <a name="try-it-out"></a><span data-ttu-id="b0451-247">Provare questa operazione</span><span class="sxs-lookup"><span data-stu-id="b0451-247">Try it out</span></span>

<span data-ttu-id="b0451-248">Ora che sono disponibili più associazioni di output, i test diventano un po' più complessi.</span><span class="sxs-lookup"><span data-stu-id="b0451-248">Now that we have multiple output bindings, testing becomes a little trickier.</span></span> <span data-ttu-id="b0451-249">Nei lab precedenti i test sono stati eseguiti inviando una richiesta HTTP e una stringa di query, ma questa volta viene inviata una richiesta HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="b0451-249">In previous labs we were content to test by sending an HTTP request and a query string, but we'll want to perform an HTTP post this time.</span></span> <span data-ttu-id="b0451-250">È anche necessario verificare se i messaggi vengono inseriti in una coda.</span><span class="sxs-lookup"><span data-stu-id="b0451-250">We also need to check to see whether messages are making it into a queue.</span></span>

1. <span data-ttu-id="b0451-251">Con la funzione [!INCLUDE [func-name-add](./func-name-add.md)] selezionata nel portale delle app per le funzioni, selezionare la voce di menu Test all'estrema sinistra per espanderla.</span><span class="sxs-lookup"><span data-stu-id="b0451-251">With our function, [!INCLUDE [func-name-add](./func-name-add.md)], selected in the Function Apps portal, select the Test menu item at the far left to expand it.</span></span>

2. <span data-ttu-id="b0451-252">Selezionare la voce di menu **Test** e verificare che il riquadro Test sia aperto.</span><span class="sxs-lookup"><span data-stu-id="b0451-252">Select the **Test** menu item, and verify that you have the test pane open.</span></span> <span data-ttu-id="b0451-253">Lo screenshot seguente riporta il risultato:</span><span class="sxs-lookup"><span data-stu-id="b0451-253">The following screenshot shows what it should look like:</span></span>

    ![Screenshot che mostra il pannello Test della funzione espanso.](../media/7-test-panel-open-small.png)

    > [!IMPORTANT]
    > <span data-ttu-id="b0451-255">Assicurarsi che nell'elenco a discesa del metodo HTTP sia selezionato **POST**.</span><span class="sxs-lookup"><span data-stu-id="b0451-255">Make sure that **POST** is selected in the HTTP method drop-down list.</span></span>

3. <span data-ttu-id="b0451-256">Sostituire il contenuto del corpo della richiesta con il payload JSON seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-256">Replace the content of the request body with the following JSON payload:</span></span>

    ```json
    {
        "id": "docs",
        "url": "https://docs.microsoft.com/azure"
    }
    ```

4. <span data-ttu-id="b0451-257">Selezionare **Esegui** nella parte inferiore del riquadro Test.</span><span class="sxs-lookup"><span data-stu-id="b0451-257">Select **Run** at the bottom of the test pane.</span></span>

5. <span data-ttu-id="b0451-258">Verificare che nella finestra **Output** sia visualizzato il messaggio che indica che il segnalibro esiste già, come illustrato nella figura seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-258">Verify that the **Output** window displays the "Bookmark already exists" message, as shown in the following diagram:</span></span>

    ![Screenshot che mostra il pannello Test e il risultato di un test con esito negativo.](../media/7-test-exists-small.png)

6. <span data-ttu-id="b0451-260">Sostituire il corpo della richiesta con il payload seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-260">Replace the request body with the following payload:</span></span>

    ```json
    {
        "id": "github",
        "url": "https://www.github.com"
    }
    ```
7. <span data-ttu-id="b0451-261">Selezionare **Esegui** nella parte inferiore del riquadro Test.</span><span class="sxs-lookup"><span data-stu-id="b0451-261">Select **Run** at the bottom of the test pane.</span></span>

8. <span data-ttu-id="b0451-262">Verificare che nella casella *Output* sia visualizzato un messaggio che indica che il segnalibro è stato aggiunto, come illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="b0451-262">Verify the that *Output* box displays the "bookmark added" message as shown in the following diagram.</span></span>

    ![Screenshot che mostra il pannello Test e il risultato di un test con esito positivo.](../media/7-test-success-small.png)

<span data-ttu-id="b0451-264">La procedura è stata completata.</span><span class="sxs-lookup"><span data-stu-id="b0451-264">Congratulations!</span></span> <span data-ttu-id="b0451-265">[!INCLUDE [func-name-add](./func-name-add.md)] funziona come previsto, ma è necessario occuparsi dell'operazione di accodamento presente nel codice.</span><span class="sxs-lookup"><span data-stu-id="b0451-265">The [!INCLUDE [func-name-add](./func-name-add.md)] works as designed, but what about that queue operation we had in the code?</span></span> <span data-ttu-id="b0451-266">Per prima cosa, occorre verificare se è stato scritto qualcosa in una coda.</span><span class="sxs-lookup"><span data-stu-id="b0451-266">Well, let's go see whether something was written to a queue.</span></span>

### <a name="verify-that-a-message-is-written-to-the-queue"></a><span data-ttu-id="b0451-267">Verificare che sia stato scritto un messaggio nella coda</span><span class="sxs-lookup"><span data-stu-id="b0451-267">Verify that a message is written to the queue</span></span>

<span data-ttu-id="b0451-268">Le code di Archiviazione code di Azure sono ospitate in un account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="b0451-268">Azure Queue Storage queues are hosted in a storage account.</span></span> <span data-ttu-id="b0451-269">L'account di archiviazione è già stato selezionato in questo esercizio quando si è creata l'associazione di output.</span><span class="sxs-lookup"><span data-stu-id="b0451-269">You already selected the storage account in this exercise when you created the output binding.</span></span>

1. <span data-ttu-id="b0451-270">Nella casella di ricerca principale nel portale di Azure digitare **account di archiviazione** e nei risultati della ricerca selezionare **Account di archiviazione** in **Servizi**.</span><span class="sxs-lookup"><span data-stu-id="b0451-270">In the main search box in the Azure portal, type **storage accounts**, and in the results list, under **Services**, select **Storage accounts**.</span></span>

      ![Screenshot che mostra i risultati della ricerca per Account di archiviazione nella casella di ricerca principale.](../media/7-search-for-sa-small.png)

2. <span data-ttu-id="b0451-272">Nell'elenco degli account di archiviazione restituiti selezionare l'account di archiviazione usato per creare l'associazione di output **newmessage**.</span><span class="sxs-lookup"><span data-stu-id="b0451-272">In the list of storage accounts that are returned, select the storage account that you used to create the **newmessage** output binding.</span></span>
   <span data-ttu-id="b0451-273">Le impostazioni dell'account di archiviazione sono visualizzate nella finestra principale del portale.</span><span class="sxs-lookup"><span data-stu-id="b0451-273">The storage account settings are displayed in the main window of the portal.</span></span>

3. <span data-ttu-id="b0451-274">Selezionare la voce **Code** nell'elenco **Servizi**.</span><span class="sxs-lookup"><span data-stu-id="b0451-274">In the **Services** list, select the **Queues** item.</span></span>
   <span data-ttu-id="b0451-275">Viene visualizzato un elenco di code ospitate da questo account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="b0451-275">A list of queues hosted by this storage account is displayed.</span></span> <span data-ttu-id="b0451-276">Verificare che la coda **bookmarks-post-process** esista, come illustrato nello screenshot seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-276">Verify that the **bookmarks-post-process** queue exists, as shown in the following screenshot:</span></span>

      ![Screenshot che mostra la coda nell'elenco delle code ospitate da questo account di archiviazione](../media/7-q-in-list-small.png)

4. <span data-ttu-id="b0451-278">Selezionare **bookmarks-post-process** per aprire la coda.</span><span class="sxs-lookup"><span data-stu-id="b0451-278">Select **bookmarks-post-process** to open the queue.</span></span>
   <span data-ttu-id="b0451-279">I messaggi presenti nella coda vengono visualizzati sotto forma di elenco.</span><span class="sxs-lookup"><span data-stu-id="b0451-279">The messages that are in the queue are displayed in a list.</span></span> <span data-ttu-id="b0451-280">In assenza di errori, la coda include il messaggio inviato al momento dell'aggiunta di un segnalibro al database.</span><span class="sxs-lookup"><span data-stu-id="b0451-280">If all went according to plan, the queue includes the message that you posted when you added a bookmark to the database.</span></span> <span data-ttu-id="b0451-281">Il messaggio sarà simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="b0451-281">It should look like the following:</span></span>

    ![Screenshot che mostra il messaggio nella coda](../media/7-message-in-q-small.png)

   <span data-ttu-id="b0451-283">In questo esempio si noterà che al messaggio è stato assegnato un ID univoco e che nel campo **MESSAGE TEXT** (Testo del messaggio) viene visualizzato il segnalibro in formato di stringa JSON.</span><span class="sxs-lookup"><span data-stu-id="b0451-283">In this example, you can see that the message was given a unique ID, and the **MESSAGE TEXT** field displays your bookmark in JSON string format.</span></span>

5. <span data-ttu-id="b0451-284">È possibile testare la funzione ulteriormente modificando il corpo della richiesta nel riquadro Test con nuovi set di ID/URL ed eseguendo la funzione.</span><span class="sxs-lookup"><span data-stu-id="b0451-284">You can test the function further by changing the request body in the test pane with new id/url sets and running the function.</span></span> <span data-ttu-id="b0451-285">Prestare attenzione alla coda per vedere se arrivano altri messaggi.</span><span class="sxs-lookup"><span data-stu-id="b0451-285">Watch this queue to see more messages arrive.</span></span> <span data-ttu-id="b0451-286">È anche possibile esaminare il database per verificare se sono state aggiunte nuove voci.</span><span class="sxs-lookup"><span data-stu-id="b0451-286">You can also look at the database to verify that new entries have been added.</span></span>

<span data-ttu-id="b0451-287">In questo lab sono state approfondite le competenze sulle associazioni prendendo in esame le associazioni di output e scrivendo dati in Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="b0451-287">In this lab, we expanded your knowledge of bindings to output bindings, writing data to your Azure Cosmos DB.</span></span> <span data-ttu-id="b0451-288">È stata inoltre aggiunta un'altra associazione di output per pubblicare messaggi in una coda di Azure.</span><span class="sxs-lookup"><span data-stu-id="b0451-288">We went further and added another output binding to post messages to an Azure queue.</span></span> <span data-ttu-id="b0451-289">Ciò dimostra tutta l'efficacia delle associazioni, che consentono di modellare e spostare i dati dalle origini in ingresso a una vasta gamma di destinazioni.</span><span class="sxs-lookup"><span data-stu-id="b0451-289">This demonstrates the true power of bindings to help you shape and move data from incoming sources to a variety of destinations.</span></span> <span data-ttu-id="b0451-290">Non è stato necessario scrivere il codice del database, né gestire manualmente le stringhe di connessione.</span><span class="sxs-lookup"><span data-stu-id="b0451-290">We haven't written any database code or had to manage connection strings ourselves.</span></span> <span data-ttu-id="b0451-291">Al contrario, le associazioni sono state configurate in modo dichiarativo e si è fatto in modo che la piattaforma si occupasse automaticamente della protezione delle connessioni, oltre che del ridimensionamento della funzione e delle connessioni.</span><span class="sxs-lookup"><span data-stu-id="b0451-291">Instead, we configured bindings declaratively and let the platform take care of securing connections, scaling our function, and scaling our connections.</span></span>