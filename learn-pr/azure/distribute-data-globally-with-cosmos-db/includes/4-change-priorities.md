<span data-ttu-id="c46f7-101">Dopo aver eseguito la replica dei dati in più aree, è possibile sfruttare i vantaggi delle soluzioni di failover automatico offerte da Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c46f7-101">Once you've replicated your data in multiple regions, you can take advantage of the automated failover solutions Azure Cosmos DB provides.</span></span> <span data-ttu-id="c46f7-102">Il failover automatico è una funzionalità attivata in caso di un'emergenza o di altri eventi che accetta una delle aree di lettura o scrittura offline e reindirizza le richieste dall'area successiva con maggiore priorità.</span><span class="sxs-lookup"><span data-stu-id="c46f7-102">Automated failover is a feature that comes into play when there's a disaster or other event that takes one of your read or write regions offline, and it redirects requests from the offline region to the next most prioritized region.</span></span> 

<span data-ttu-id="c46f7-103">Per il sito di abbigliamento online, replicato nelle aree Stati Uniti orientali, Stati Uniti occidentali e Regno Unito occidentale, è possibile assegnare una priorità in modo che se l'area Stati Uniti orientali entra in modalità offline, le letture possano essere reindirizzate all'area Stati Uniti occidentali anziché all'area Regno Unito occidentale per limitare la latenza.</span><span class="sxs-lookup"><span data-stu-id="c46f7-103">For your online clothing site, which you just replicated into East US, West US, and West UK, you can prioritize that if the East US goes offline, you can redirect reads to West US instead of West UK, to limit latency.</span></span> 

<span data-ttu-id="c46f7-104">In questa unità viene descritto il funzionamento del failover e il modo in cui impostare la priorità per le aree in cui sono stati replicati i dati dell'azienda.</span><span class="sxs-lookup"><span data-stu-id="c46f7-104">In this unit you'll learn about how failover works and set the priority for the regions in which your company's data has been replicated.</span></span>

## <a name="failover-basics"></a><span data-ttu-id="c46f7-105">Nozioni di base sul failover</span><span class="sxs-lookup"><span data-stu-id="c46f7-105">Failover basics</span></span>

<span data-ttu-id="c46f7-106">Nel raro caso di un'interruzione a livello di area di Azure o del data center, Azure Cosmos DB attiva automaticamente i failover di tutti gli account Azure Cosmos DB presenti nell'area interessata.</span><span class="sxs-lookup"><span data-stu-id="c46f7-106">In the rare event of an Azure regional outage or data center outage, Azure Cosmos DB automatically triggers failovers of all Azure Cosmos DB accounts with a presence in the affected region.</span></span>

<span data-ttu-id="c46f7-107">**Cosa accade se si verifica un'interruzione del servizio in un'area di lettura?**</span><span class="sxs-lookup"><span data-stu-id="c46f7-107">**What happens if a read region has an outage?**</span></span>

<span data-ttu-id="c46f7-108">Gli account Azure Cosmos DB con un'area di lettura in una delle aree interessate vengono automaticamente disconnessi dalla rispettiva area di scrittura e contrassegnati come offline.</span><span class="sxs-lookup"><span data-stu-id="c46f7-108">Azure Cosmos DB accounts with a read region in one of the affected regions are automatically disconnected from their write region and marked offline.</span></span> <span data-ttu-id="c46f7-109">Gli SDK di Cosmos DB implementano un protocollo di individuazione area che consente di rilevare automaticamente quando un'area è disponibile e reindirizzare le chiamate di lettura all'area successiva disponibile nell'elenco delle aree preferite.</span><span class="sxs-lookup"><span data-stu-id="c46f7-109">The Cosmos DB SDKs implement a regional discovery protocol that allows them to automatically detect when a region is available and redirect read calls to the next available region in the preferred region list.</span></span> <span data-ttu-id="c46f7-110">Se nessuna delle aree presenti nell'elenco è disponibile, viene eseguito il fallback automatico delle chiamate all'area di scrittura corrente.</span><span class="sxs-lookup"><span data-stu-id="c46f7-110">If none of the regions in the preferred region list is available, calls automatically fall back to the current write region.</span></span> <span data-ttu-id="c46f7-111">Non sono necessarie modifiche nel codice dell'applicazione per gestire i failover regionali.</span><span class="sxs-lookup"><span data-stu-id="c46f7-111">No changes are required in your application code to handle regional failovers.</span></span> <span data-ttu-id="c46f7-112">Durante l'intero processo, Azure Cosmos DB continua a rispettare garanzie di coerenza.</span><span class="sxs-lookup"><span data-stu-id="c46f7-112">During this entire process, consistency guarantees continue to be honored by Azure Cosmos DB.</span></span>

<span data-ttu-id="c46f7-113">Dopo il ripristino dell'area interessata da un'interruzione del servizio, tutti gli account Azure Cosmos DB interessati nell'area vengono ripristinati automaticamente dal servizio.</span><span class="sxs-lookup"><span data-stu-id="c46f7-113">Once the affected region recovers from the outage, all the affected Azure Cosmos DB accounts in the region are automatically recovered by the service.</span></span> <span data-ttu-id="c46f7-114">Gli account Azure Cosmos DB con un'area di lettura nell'area interessata vengono quindi sincronizzati automaticamente con l'area di scrittura corrente e passano in modalità online.</span><span class="sxs-lookup"><span data-stu-id="c46f7-114">Azure Cosmos DB accounts that had a read region in the affected region will then automatically sync with current write region and turn online.</span></span> <span data-ttu-id="c46f7-115">Gli SDK di Azure Cosmos DB rilevano la disponibilità della nuova area e valutano se deve essere selezionata come area di lettura corrente in base all'elenco delle aree preferite configurato dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c46f7-115">The Azure Cosmos DB SDKs discover the availability of the new region and evaluate whether the region should be selected as the current read region based on the preferred region list configured by the application.</span></span> <span data-ttu-id="c46f7-116">Le letture successive vengono reindirizzate all'area ripristinata senza richiedere alcuna modifica del codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c46f7-116">Subsequent reads are redirected to the recovered region without requiring any changes to your application code.</span></span>

<span data-ttu-id="c46f7-117">**Cosa accade se si verifica un'interruzione del servizio in un'area di scrittura?**</span><span class="sxs-lookup"><span data-stu-id="c46f7-117">**What happens if a write region has an outage?**</span></span>

<span data-ttu-id="c46f7-118">Se l'area interessata è l'area di scrittura corrente e per l'account Azure Cosmos DB è abilitato il failover automatico, l'area viene automaticamente contrassegnata come offline.</span><span class="sxs-lookup"><span data-stu-id="c46f7-118">If the affected region is the current write region and automatic failover is enabled for the Azure Cosmos DB account, then the region is automatically marked as offline.</span></span> <span data-ttu-id="c46f7-119">Viene quindi promossa un'area alternativa come area di scrittura per l'account Azure Cosmos DB interessato.</span><span class="sxs-lookup"><span data-stu-id="c46f7-119">Then, an alternative region is promoted as the write region for the affected Azure Cosmos DB account.</span></span>

<span data-ttu-id="c46f7-120">Durante i failover automatici, Azure Cosmos DB sceglie automaticamente l'area di scrittura successiva per un determinato account Azure Cosmos DB in base all'ordine di priorità specificato.</span><span class="sxs-lookup"><span data-stu-id="c46f7-120">During automatic failovers, Azure Cosmos DB automatically chooses the next write region for a given Azure Cosmos DB account based on the specified priority order.</span></span> <span data-ttu-id="c46f7-121">Le applicazioni possono usare la proprietà WriteEndpoint della classe DocumentClient per rilevare le modifiche dell'area di scrittura.</span><span class="sxs-lookup"><span data-stu-id="c46f7-121">Applications can use the WriteEndpoint property of DocumentClient class to detect the change in write region.</span></span>

<span data-ttu-id="c46f7-122">Dopo il ripristino dell'area interessata da un'interruzione del servizio, tutti gli account Cosmos DB interessati nell'area vengono ripristinati automaticamente dal servizio.</span><span class="sxs-lookup"><span data-stu-id="c46f7-122">Once the affected region recovers from the outage, all the affected Cosmos DB accounts in the region are automatically recovered by the service.</span></span>

<span data-ttu-id="c46f7-123">A questo punto si modifica l'area di lettura per il database.</span><span class="sxs-lookup"><span data-stu-id="c46f7-123">Now let's modify the read region for your database.</span></span>

## <a name="set-read-region-priorities"></a><span data-ttu-id="c46f7-124">Impostare le priorità dell'area di lettura</span><span class="sxs-lookup"><span data-stu-id="c46f7-124">Set read region priorities</span></span>

1. <span data-ttu-id="c46f7-125">Nella schermata **Replica i dati a livello globale** del portale di Azure fare clic su **Failover automatico**.</span><span class="sxs-lookup"><span data-stu-id="c46f7-125">In the Azure portal, on the **Replicate data globally** screen, click **Automatic Failover**.</span></span> <span data-ttu-id="c46f7-126">Il failover automatico è abilitato solo se il database è già stato replicato in più di un'area.</span><span class="sxs-lookup"><span data-stu-id="c46f7-126">Automatic failover is only enabled if the database has already been replicated to more than one region.</span></span>
2. <span data-ttu-id="c46f7-127">Nella schermata **Failover automatico** impostare **Abilita failover automatico** su **Attivato**.</span><span class="sxs-lookup"><span data-stu-id="c46f7-127">On the **Automatic Failover** screen, change **Enable Automatic Failover** to **ON**.</span></span>
3. <span data-ttu-id="c46f7-128">Nella sezione **Aree di lettura** fare clic sulla parte sinistra della riga **Stati Uniti orientali** e quindi trascinarla nella posizione superiore.</span><span class="sxs-lookup"><span data-stu-id="c46f7-128">In the **Read regions** section, click the left portion of the **East US** row, and then drag and drop at the top position.</span></span>
4. <span data-ttu-id="c46f7-129">Fare clic sulla parte sinistra della riga **Giappone orientale** e quindi trascinarla in seconda posizione.</span><span class="sxs-lookup"><span data-stu-id="c46f7-129">Click the left portion of the **Japan East** row, and then drag and drop to the second position.</span></span>
5. <span data-ttu-id="c46f7-130">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="c46f7-130">Click **OK**.</span></span>

    ![Modificare le aree di lettura nel portale](../media/4-change-priorities/change-read-priorities.gif)

## <a name="summary"></a><span data-ttu-id="c46f7-132">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="c46f7-132">Summary</span></span>

<span data-ttu-id="c46f7-133">In questa unità sono stati descritti i risultati del failover automatico, il modo in cui è possibile usarlo per la protezione da interruzioni impreviste e il modo in cui modificare le priorità di un'area di lettura.</span><span class="sxs-lookup"><span data-stu-id="c46f7-133">In this unit, you've learned what automatic failover provides, how you can use it to protect against unforeseen outages, and how to modify read region priorities.</span></span>