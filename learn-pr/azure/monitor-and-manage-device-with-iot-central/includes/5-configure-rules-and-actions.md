<span data-ttu-id="cf775-101">Si è connessa la macchina per il caffè all'applicazione Azure IoT Central, abilitando lo scambio di dati che consente di monitorare e gestire la macchina per il caffè.</span><span class="sxs-lookup"><span data-stu-id="cf775-101">You have connected your coffee machine to the Azure IoT Central application, enabling the exchange of data that allows you to monitor and manage your coffee machine.</span></span> <span data-ttu-id="cf775-102">In questa unità vengono create regole che attivano azioni quando la temperatura dell'acqua della macchina per il caffè non rientra nell'intervallo normale.</span><span class="sxs-lookup"><span data-stu-id="cf775-102">In this unit, you create rules that trigger actions when the water temperature of the coffee machine is outside the normal range.</span></span> <span data-ttu-id="cf775-103">Le azioni sono messaggi di posta elettronica o notifiche a dispositivi mobili, a seconda che la macchina sia o meno coperta da garanzia.</span><span class="sxs-lookup"><span data-stu-id="cf775-103">The actions are either emails or mobile notifications depending on whether or not the machine is under warranty.</span></span> <span data-ttu-id="cf775-104">Per aggiungere Microsoft Flow come azione, è necessaria una sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="cf775-104">To add Microsoft Flow as an action, you need an Azure subscription.</span></span> <span data-ttu-id="cf775-105">Se non si ha una sottoscrizione di Azure, l'aggiunta di Microsoft Flow come azione è facoltativa.</span><span class="sxs-lookup"><span data-stu-id="cf775-105">If you do not have an Azure subscription, adding Microsoft Flow as an action is optional.</span></span>

## <a name="create-rules-in-iot-central-with-email-as-the-action"></a><span data-ttu-id="cf775-106">Creare regole in IoT Central con invio di messaggio di posta elettronica come azione</span><span class="sxs-lookup"><span data-stu-id="cf775-106">Create rules in IoT Central with Email as the action</span></span>
<span data-ttu-id="cf775-107">Azure IoT Central include funzionalità native di posta elettronica per l'invio di notifiche.</span><span class="sxs-lookup"><span data-stu-id="cf775-107">Azure IoT Central has its native email capabilities to send notifications.</span></span> <span data-ttu-id="cf775-108">In questo scenario se la macchina per il caffè non rientra nell'intervallo di temperatura ottimale e non è coperta dalla garanzia, IoT Central invia un messaggio di posta elettronica al reparto di manutenzione del cliente.</span><span class="sxs-lookup"><span data-stu-id="cf775-108">In this scenario, if the coffee machine is outside the optimal temperature range and is not protected by the warranty, an email is sent by IoT Central to the client’s maintenance department.</span></span>

<span data-ttu-id="cf775-109">Passare alla pagina **Rules** (Regole) per gli esercizi in questa unità.</span><span class="sxs-lookup"><span data-stu-id="cf775-109">Navigate to the **Rules** page for the exercises in this unit.</span></span> <span data-ttu-id="cf775-110">Selezionare **+ New Rule** (Nuova regola), quindi **Telemetry** (Telemetria).</span><span class="sxs-lookup"><span data-stu-id="cf775-110">Select **+ New Rule**, then **Telemetry**.</span></span> <span data-ttu-id="cf775-111">Aggiungere le due regole seguenti quando la garanzia della macchina per il caffè è scaduta e la temperatura dell'acqua non è compresa nell'intervallo ottimale.</span><span class="sxs-lookup"><span data-stu-id="cf775-111">Add the following two rules when the coffee machine warranty has expired and the water temperature is outside the optimal range.</span></span> <span data-ttu-id="cf775-112">Al termine, scegliere **Save** (Salva).</span><span class="sxs-lookup"><span data-stu-id="cf775-112">When you're finished, choose **Save**.</span></span> 

> [!NOTE]
> <span data-ttu-id="cf775-113">Quando vengono applicate condizioni, per l'esecuzione delle regole tutte le affermazioni devono essere vere.</span><span class="sxs-lookup"><span data-stu-id="cf775-113">When conditions are applied, all statements have to be true for the rules to be executed.</span></span> <span data-ttu-id="cf775-114">Se la condizione è un'istruzione "or" come in questo scenario (ad esempio, la temperatura ottimale è minore o maggiore dei valori predefiniti quando la garanzia è scaduta), dividere l'istruzione in due regole come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="cf775-114">If your condition is an "or" statement as in this scenario (e.g. the optimal temperature is less or greater than the predefined values while the warranty has expired), split the statement into two rules as shown here.</span></span>

1. <span data-ttu-id="cf775-115">Assegnare alla regola il nome: Coffee Maker Water Too Cold (Expired)</span><span class="sxs-lookup"><span data-stu-id="cf775-115">Name the rule: Coffee Maker Water Too Cold (Expired)</span></span>

    <span data-ttu-id="cf775-116">Aggiungere le condizioni:</span><span class="sxs-lookup"><span data-stu-id="cf775-116">Add the conditions:</span></span>      
    * <span data-ttu-id="cf775-117">Device Warranty Expired equals 1</span><span class="sxs-lookup"><span data-stu-id="cf775-117">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="cf775-118">Water Temperature is less than Coffee Makers Min Temperature</span><span class="sxs-lookup"><span data-stu-id="cf775-118">Water Temperature is less than Coffee Makers Min Temperature</span></span>

    ![Uso della regola](../images/5-flow-a.png)

1. <span data-ttu-id="cf775-120">Assegnare alla regola il nome: Coffee Maker Water Too Hot (Expired)</span><span class="sxs-lookup"><span data-stu-id="cf775-120">Name the rule: Coffee Maker Water Too Hot (Expired)</span></span>

    <span data-ttu-id="cf775-121">Aggiungere le condizioni:</span><span class="sxs-lookup"><span data-stu-id="cf775-121">Add the conditions:</span></span>      
    * <span data-ttu-id="cf775-122">Device Warranty Expired equals 1</span><span class="sxs-lookup"><span data-stu-id="cf775-122">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="cf775-123">Water Temperature is greater than Coffee Makers Max Temperature</span><span class="sxs-lookup"><span data-stu-id="cf775-123">Water Temperature is greater than Coffee Makers Max Temperature</span></span>

1. <span data-ttu-id="cf775-124">Per aggiungere un'**azione**, scorrere verso il basso fino al pannello Configure Telemetry Rule (Configura regola di telemetria) e scegliere l'icona **+** accanto ad Actions (Azioni), quindi scegliere **Email** (Messaggio di posta elettronica).</span><span class="sxs-lookup"><span data-stu-id="cf775-124">To add an **Action**, scroll down on the Configure Telemetry Rule panel and choose **+** next to Actions, then choose **Email**.</span></span>

1. <span data-ttu-id="cf775-125">Per definire l'azione, aggiungere l'indirizzo di posta elettronica usato per accedere all'applicazione IoT Central.</span><span class="sxs-lookup"><span data-stu-id="cf775-125">To define the action, add the email address that you used to sign in to the IoT Central application.</span></span> <span data-ttu-id="cf775-126">Aggiungere il messaggio di notifica quando la temperatura dell'acqua è troppo alta: "Coffee maker's water is too hot.</span><span class="sxs-lookup"><span data-stu-id="cf775-126">Add the notification message when the water temperature is too hot: "Coffee maker's water is too hot.</span></span> <span data-ttu-id="cf775-127">Maintenance is required.</span><span class="sxs-lookup"><span data-stu-id="cf775-127">Maintenance is required.</span></span>  <span data-ttu-id="cf775-128">Warranty has expired."</span><span class="sxs-lookup"><span data-stu-id="cf775-128">Warranty has expired."</span></span> <span data-ttu-id="cf775-129">Ripetere gli stessi passaggi per quando la temperatura dell'acqua è troppo fredda.</span><span class="sxs-lookup"><span data-stu-id="cf775-129">Repeat the same steps for when the water temperature is too cold.</span></span> <span data-ttu-id="cf775-130">Aggiungere il messaggio: "Coffee maker's water is too cold.</span><span class="sxs-lookup"><span data-stu-id="cf775-130">Add the message: "Coffee maker's water is too cold.</span></span> <span data-ttu-id="cf775-131">Maintenance is required.</span><span class="sxs-lookup"><span data-stu-id="cf775-131">Maintenance is required.</span></span>  <span data-ttu-id="cf775-132">Warranty has expired."</span><span class="sxs-lookup"><span data-stu-id="cf775-132">Warranty has expired."</span></span>

1. <span data-ttu-id="cf775-133">Scegliere **Save** (Salva).</span><span class="sxs-lookup"><span data-stu-id="cf775-133">Choose **Save**.</span></span> <span data-ttu-id="cf775-134">La regola viene elencata nella pagina Rules (Regole).</span><span class="sxs-lookup"><span data-stu-id="cf775-134">Your rule is listed on the Rules page.</span></span>

1. <span data-ttu-id="cf775-135">Per attivare la regola, configurare la temperatura ottimale nelle impostazioni come esterna all'intervallo specificato nelle proprietà.</span><span class="sxs-lookup"><span data-stu-id="cf775-135">To trigger the rule, set the optimal temperature in Settings outside the range that you specified under Properties.</span></span> <span data-ttu-id="cf775-136">Al termine della convalida, disattivare le regole per evitare di ricevere troppi messaggi nella posta in arrivo.</span><span class="sxs-lookup"><span data-stu-id="cf775-136">Once you are done with the validation, turn off the rules to avoid flooding your Inbox with emails.</span></span> 

## <a name="create-rules-in-iot-central-with-microsoft-flow-as-the-action"></a><span data-ttu-id="cf775-137">Creare regole in IoT Central con Microsoft Flow come azione</span><span class="sxs-lookup"><span data-stu-id="cf775-137">Create rules in IoT Central with Microsoft Flow as the action</span></span>

<span data-ttu-id="cf775-138">Microsoft Flow automatizza i flussi di lavoro tra molte applicazioni.</span><span class="sxs-lookup"><span data-stu-id="cf775-138">Microsoft Flow automates workflows across many applications.</span></span> <span data-ttu-id="cf775-139">È una delle azioni che possono essere attivate quando viene eseguita una regola in IoT Central.</span><span class="sxs-lookup"><span data-stu-id="cf775-139">It’s one of the actions that can be triggered when a rule is fired in IoT Central.</span></span> <span data-ttu-id="cf775-140">In questo scenario, Microsoft Flow invia una notifica sul dispositivo mobile di un tecnico locale quando la macchina per il caffè raggiunge una determinata soglia di temperatura ed è in garanzia.</span><span class="sxs-lookup"><span data-stu-id="cf775-140">In this scenario, Microsoft Flow sends a mobile notification to a local technician when the coffee machine reaches certain temperature threshold and is under warranty.</span></span> <span data-ttu-id="cf775-141">Passare a **Rules** (Regole) per configurare le condizioni e aggiungere un flusso come azione quando la regola viene attivata.</span><span class="sxs-lookup"><span data-stu-id="cf775-141">Navigate to **Rules** to configure conditions and add a Flow as an action when the rule is fired.</span></span> 
 
> [!NOTE]
> <span data-ttu-id="cf775-142">Questo esercizio è facoltativo se non si ha una sottoscrizione di Azure per attivare Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="cf775-142">This exercise is optional if you do not have an Azure subscription to turn on Microsoft Flow.</span></span>


### <a name="extend-your-iot-central-trial-to-30-days"></a><span data-ttu-id="cf775-143">Estendere la versione di valutazione gratuita di IoT Central fino a 30 giorni</span><span class="sxs-lookup"><span data-stu-id="cf775-143">Extend your IoT Central trial to 30 days</span></span>

1. <span data-ttu-id="cf775-144">Per attivare Microsoft Flow, è necessario estendere la versione di valutazione gratuita fino a 30 giorni.</span><span class="sxs-lookup"><span data-stu-id="cf775-144">To turn on Microsoft Flow, you need to extend your trial to 30 days.</span></span> <span data-ttu-id="cf775-145">A questo scopo, selezionare **Extend Trial to 30 days** (Estendi la versione di valutazione a 30 giorni) nella pagina di fatturazione e scegliere una sottoscrizione di Azure Active Directory e Azure.</span><span class="sxs-lookup"><span data-stu-id="cf775-145">To do so, select **Extend Trial to 30 days** on the Billing page, choose an Azure Active Directory and Azure subscription.</span></span> <span data-ttu-id="cf775-146">Una sottoscrizione di Azure consente di creare istanze dei servizi di Azure.</span><span class="sxs-lookup"><span data-stu-id="cf775-146">An Azure subscription enables you to create instances of Azure services.</span></span> <span data-ttu-id="cf775-147">Azure IoT Central rileva automaticamente tutte le sottoscrizioni di Azure a cui è possibile accedere e le mostra in un elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="cf775-147">Azure IoT Central automatically finds all the Azure Subscriptions you have access to, and displays them in the drop-down.</span></span>
    
1. <span data-ttu-id="cf775-148">Se non si ha una sottoscrizione di Azure, è possibile crearne una nella [pagina di iscrizione ad Azure](https://aka.ms/createazuresubscription).</span><span class="sxs-lookup"><span data-stu-id="cf775-148">If you don’t have an Azure subscription, you can create one on the [Azure sign-up page](https://aka.ms/createazuresubscription).</span></span> <span data-ttu-id="cf775-149">Dopo aver creato la sottoscrizione di Azure, tornare alla pagina **Application Manager** (Gestione applicazioni).</span><span class="sxs-lookup"><span data-stu-id="cf775-149">After you create the Azure subscription, navigate back to the **Application Manager** page.</span></span> <span data-ttu-id="cf775-150">La nuova sottoscrizione viene visualizzata nell'elenco a discesa **Azure Subscription** (Sottoscrizione di Azure).</span><span class="sxs-lookup"><span data-stu-id="cf775-150">Your new subscription appears in the **Azure Subscription** drop-down.</span></span>
        

### <a name="add-the-following-rules-when-the-coffee-machine-is-under-warranty"></a><span data-ttu-id="cf775-151">Aggiungere le regole seguenti quando la macchina per il caffè è in garanzia.</span><span class="sxs-lookup"><span data-stu-id="cf775-151">Add the following rules when the coffee machine is under warranty.</span></span> 

1. <span data-ttu-id="cf775-152">Assegnare alla regola il nome: Coffee Maker Water Too Cold (Warranty)</span><span class="sxs-lookup"><span data-stu-id="cf775-152">Name the rule: Coffee Maker Water Too Cold (Warranty)</span></span>

    <span data-ttu-id="cf775-153">Aggiungere le condizioni:</span><span class="sxs-lookup"><span data-stu-id="cf775-153">Add the conditions:</span></span>      
    * <span data-ttu-id="cf775-154">Device Warranty Expired equals 0</span><span class="sxs-lookup"><span data-stu-id="cf775-154">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="cf775-155">Water Temperature is less than Coffee Makers Min Temperature</span><span class="sxs-lookup"><span data-stu-id="cf775-155">Water Temperature is less than Coffee Makers Min Temperature</span></span>

1. <span data-ttu-id="cf775-156">Assegnare alla regola il nome: Coffee Maker Water Too Hot (Warranty)</span><span class="sxs-lookup"><span data-stu-id="cf775-156">Name the rule: Coffee Maker Water Too Hot (Warranty)</span></span>

    <span data-ttu-id="cf775-157">Aggiungere le condizioni:</span><span class="sxs-lookup"><span data-stu-id="cf775-157">Add the conditions:</span></span>      
    * <span data-ttu-id="cf775-158">Device Warranty Expired equals 0</span><span class="sxs-lookup"><span data-stu-id="cf775-158">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="cf775-159">Water Temperature is greater than Coffee Makers Max Temperature</span><span class="sxs-lookup"><span data-stu-id="cf775-159">Water Temperature is greater than Coffee Makers Max Temperature</span></span>

1. <span data-ttu-id="cf775-160">Dopo aver salvato le condizioni della regola, scegliere Microsoft Flow come nuova azione quando la macchina per il caffè è in garanzia.</span><span class="sxs-lookup"><span data-stu-id="cf775-160">After you save the rule conditions, choose Microsoft Flow as a new action when the coffee maker is under warranty.</span></span> <span data-ttu-id="cf775-161">Nel browser si aprirà una nuova scheda o finestra che indirizzerà a Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="cf775-161">A new tab or window should open in your browser, taking you to Microsoft Flow.</span></span> <span data-ttu-id="cf775-162">Si aprirà una pagina di panoramica con un connettore IoT Central connesso a un'azione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="cf775-162">You land on an overview page showing an IoT Central connector connecting to a custom action.</span></span> <span data-ttu-id="cf775-163">Scegliere **Continue** (Continua).</span><span class="sxs-lookup"><span data-stu-id="cf775-163">Choose **Continue**.</span></span> 

    <span data-ttu-id="cf775-164">Viene visualizzata la finestra di progettazione di Microsoft Flow in cui creare il flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cf775-164">You are taken to the Microsoft Flow designer to build your workflow.</span></span> <span data-ttu-id="cf775-165">Il flusso di lavoro include un trigger di IoT Central in cui l'applicazione e la regola sono già inserite.</span><span class="sxs-lookup"><span data-stu-id="cf775-165">The workflow has an IoT Central trigger that has your Application and Rule already filled in.</span></span>

    <span data-ttu-id="cf775-166">A questo punto è possibile aggiungere qualsiasi azione che si desidera al flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cf775-166">At this point, you can add any action you want to your workflow.</span></span> <span data-ttu-id="cf775-167">Ad esempio, è possibile inviare una notifica per dispositivo mobile.</span><span class="sxs-lookup"><span data-stu-id="cf775-167">As an example, let's send a mobile notification.</span></span> <span data-ttu-id="cf775-168">Cercare notification (notifica), quindi scegliere Notifications - Send me a mobile notification (Notifiche - Inviami una notifica sul dispositivo mobile).</span><span class="sxs-lookup"><span data-stu-id="cf775-168">Search for notification, and choose Notifications - Send me a mobile notification.</span></span>

    <span data-ttu-id="cf775-169">Compilare il campo Text (Testo) dell'azione con ciò che la notifica deve comunicare.</span><span class="sxs-lookup"><span data-stu-id="cf775-169">In the action, fill in the Text field with what you want your notification to say.</span></span> <span data-ttu-id="cf775-170">È possibile includere contenuto dinamico proveniente dalla regola di IoT Central per trasmettere informazioni importanti, quali l'ID del dispositivo e il timestamp.</span><span class="sxs-lookup"><span data-stu-id="cf775-170">You can include Dynamic content from your IoT Central rule, passing along important information such as device ID and name.</span></span>
    
    ![Uso di Microsoft Flow come azione](../images/5-flow-b.png)

1. <span data-ttu-id="cf775-172">Dopo aver configurato il flusso di lavoro in Microsoft Flow, scaricare l'[app Flow](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) da Microsoft Store sul dispositivo mobile.</span><span class="sxs-lookup"><span data-stu-id="cf775-172">Once you've set up the workflow in Microsoft Flow, download the [Flow app](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) from Microsoft Store to your mobile device.</span></span> <span data-ttu-id="cf775-173">Accedere con lo stesso account usato per configurare il flusso nell'app Web Flow.</span><span class="sxs-lookup"><span data-stu-id="cf775-173">Sign in using the same account that you used to set up the flow in the Flow web app.</span></span> <span data-ttu-id="cf775-174">A scopo di test, impostare la temperatura ottimale fuori dall'intervallo per attivare la regola.</span><span class="sxs-lookup"><span data-stu-id="cf775-174">For testing purposes, set the optimal temperature out of range to trigger the rule.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="cf775-175">La proprietà del dispositivo Device Warranty Expired (1 per scaduta o 0 per coperto da garanzia nel codice del dispositivo) viene generata in modo casuale dal dispositivo e quindi inviata dal dispositivo all'applicazione Azure IoT Central.</span><span class="sxs-lookup"><span data-stu-id="cf775-175">Device Property: Device Warranty Expired (1 for expired or 0 for under warranty in the device code) is randomly generated by the device and then sent by the device to the Azure IoT Central application.</span></span> <span data-ttu-id="cf775-176">A scopo di testing, se si vuole controllare la proprietà Device Warranty Expired (1 o 0), riavviare la macchina per il caffè finché non viene visualizzato lo stato di garanzia desiderato per attivare l'azione che si sta testando.</span><span class="sxs-lookup"><span data-stu-id="cf775-176">For testing purposes, if you'd like to control Device Warranty Expired (1 or 0), reboot your coffee machine until you receive the intended warranty state to trigger the action that you're testing.</span></span> <span data-ttu-id="cf775-177">Per ricevere una notifica sul dispositivo mobile, riavviare la macchina per il caffè finché nel log della console non viene visualizzato che Device Warranty Expired è 0.</span><span class="sxs-lookup"><span data-stu-id="cf775-177">To receive a mobile notification, reboot your coffee machine until you see that Device Warranty Expired is 0 in the console log.</span></span> 

    <span data-ttu-id="cf775-178">Dopo alcuni minuti, la notifica compare nell'app per dispositivi mobili Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="cf775-178">After several minutes, notifications appear in the Flow mobile app.</span></span>

    ![Uso di Microsoft Flow come azione](../images/5-flow-c.png)

## <a name="summary"></a><span data-ttu-id="cf775-180">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="cf775-180">Summary</span></span>
<span data-ttu-id="cf775-181">Si è appreso come creare regole in IoT Central e attivare azioni quando la regola viene eseguita, ad esempio l'invio di un messaggio di posta elettronica o una di notifica per dispositivi mobili tramite Microsoft Flow.</span><span class="sxs-lookup"><span data-stu-id="cf775-181">You’ve learned to create rules in IoT Central and triggered actions such as an email or a mobile notification through Microsoft Flow when the rule is fired.</span></span> <span data-ttu-id="cf775-182">In questo caso, quando la temperatura dell'acqua della macchina per il caffè non è compresa nell'intervallo ottimale, vengono inviate notifiche a un tecnico specializzato o al cliente, a seconda dello stato della garanzia.</span><span class="sxs-lookup"><span data-stu-id="cf775-182">In this case, when the water temperature of the coffee machine is out of the optimal range, notifications are sent to either a repair technician or the client depending on the status of the warranty.</span></span> 


