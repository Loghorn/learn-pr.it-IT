<span data-ttu-id="b7b33-101">Si supponga di dover pianificare l'architettura di un'applicazione per la condivisione di musica.</span><span class="sxs-lookup"><span data-stu-id="b7b33-101">Suppose you are planning the architecture for your music-sharing application.</span></span> <span data-ttu-id="b7b33-102">È necessario assicurarsi che i file musicali vengano caricati nell'API Web in modo affidabile dall'app per dispositivi mobili.</span><span class="sxs-lookup"><span data-stu-id="b7b33-102">You want to ensure that music files are uploaded to the web API reliably from the mobile app.</span></span>

<span data-ttu-id="b7b33-103">Dopo aver stabilito che questa comunicazione deve essere un messaggio, è necessario scegliere se usare le code di archiviazione di Azure o il bus di servizio di Azure, entrambi servizi che possono essere usati per archiviare code di messaggi in attesa dell'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="b7b33-103">Having understood that this communication should be a message, you must choose whether to use Azure Storage queues or Azure Service Bus, both of which can be used to store queues of messages as they await processing.</span></span>

## <a name="delivery-guarantees"></a><span data-ttu-id="b7b33-104">Garanzie di recapito</span><span class="sxs-lookup"><span data-stu-id="b7b33-104">Delivery Guarantees</span></span>

<span data-ttu-id="b7b33-105">I sistemi di accodamento in genere garantiscono il recapito di ogni messaggio nella coda a un componente di destinazione.</span><span class="sxs-lookup"><span data-stu-id="b7b33-105">Queuing systems usually guarantee delivery of each message in the queue to a destination component.</span></span> <span data-ttu-id="b7b33-106">Per queste garanzie si possono adottare tuttavia approcci diversi:</span><span class="sxs-lookup"><span data-stu-id="b7b33-106">However, these guarantees can take different approaches:</span></span>

- <span data-ttu-id="b7b33-107">**Recapito At-Least-Once.**</span><span class="sxs-lookup"><span data-stu-id="b7b33-107">**At-Least-Once Delivery.**</span></span> <span data-ttu-id="b7b33-108">Con questo approccio, è garantito il recapito di ogni messaggio ad almeno uno dei componenti che recuperano i messaggi dalla coda.</span><span class="sxs-lookup"><span data-stu-id="b7b33-108">In this approach, each message is guaranteed to be delivered to at least one of the components that retrieve messages from the queue.</span></span> <span data-ttu-id="b7b33-109">Si noti, tuttavia, che in determinate circostanze, è possibile che lo stesso messaggio venga recapitato più di una volta.</span><span class="sxs-lookup"><span data-stu-id="b7b33-109">Note, however, that in certain circumstances, it is possible that the same message may be delivered more than once.</span></span> <span data-ttu-id="b7b33-110">Ad esempio, se sono presenti due istanze di un'app Web che recuperano i messaggi da una coda, in genere ogni messaggio viene recapitato a una sola di tali istanze.</span><span class="sxs-lookup"><span data-stu-id="b7b33-110">For example, if there are two instances of a web app retrieving messages from a queue, ordinarily each message goes to only one of those instances.</span></span> <span data-ttu-id="b7b33-111">Tuttavia, se un'istanza richiede molto tempo per elaborare il messaggio e scade un timeout, il messaggio potrebbe essere inviato anche all'altra istanza.</span><span class="sxs-lookup"><span data-stu-id="b7b33-111">However, if one instance takes a long time to process the message, and a time-out expires, the message may be sent to the other instance as well.</span></span> <span data-ttu-id="b7b33-112">Il codice dell'app Web deve essere progettato tenendo in considerazione questa eventualità.</span><span class="sxs-lookup"><span data-stu-id="b7b33-112">Your web app code should be designed with this possibility in mind.</span></span>
- <span data-ttu-id="b7b33-113">**Recapito At-Most-Once.**</span><span class="sxs-lookup"><span data-stu-id="b7b33-113">**At-Most-Once Delivery.**</span></span> <span data-ttu-id="b7b33-114">Con questo approccio, il recapito di ogni messaggio non è garantito ed esiste una probabilità molto piccola che possa non arrivare.</span><span class="sxs-lookup"><span data-stu-id="b7b33-114">In this approach, each message is not guaranteed to be delivered, and there is a very small chance that it may not arrive.</span></span> <span data-ttu-id="b7b33-115">Tuttavia, a differenza del recapito At-Least-Once, non vi è alcuna possibilità che il messaggio venga recapitato due volte.</span><span class="sxs-lookup"><span data-stu-id="b7b33-115">However, unlike At-Least-Once delivery, there is no chance that the message will be delivered twice.</span></span>
- <span data-ttu-id="b7b33-116">**First-In-First-Out (FIFO).**</span><span class="sxs-lookup"><span data-stu-id="b7b33-116">**First-In-First-Out (FIFO).**</span></span> <span data-ttu-id="b7b33-117">Nella maggior parte dei sistemi di messaggistica, i messaggi in genere lasciano la coda nello stesso ordine in cui sono stati aggiunti, ma è necessario considerare se quest'ordine è garantito.</span><span class="sxs-lookup"><span data-stu-id="b7b33-117">In most messaging systems, messages usually leave the queue in the same order in which they were added, but you should consider whether this order is guaranteed.</span></span> <span data-ttu-id="b7b33-118">Se l'applicazione distribuita richiede che i messaggi vengano elaborati con precisione nell'ordine corretto, è necessario scegliere un sistema di accodamento che include una garanzia FIFO.</span><span class="sxs-lookup"><span data-stu-id="b7b33-118">If your distributed application requires that messages are processed in precisely the correct order, you must choose a queue system that includes a FIFO guarantee.</span></span>

## <a name="transactions"></a><span data-ttu-id="b7b33-119">Transazioni</span><span class="sxs-lookup"><span data-stu-id="b7b33-119">Transactions</span></span>

<span data-ttu-id="b7b33-120">Alcuni gruppi di messaggi strettamente correlati possono causare problemi quando si verifica un errore di recapito per un messaggio nel gruppo.</span><span class="sxs-lookup"><span data-stu-id="b7b33-120">Some closely related groups of messages may cause problems when delivery fails for one message in the group.</span></span>

<span data-ttu-id="b7b33-121">Si consideri, ad esempio, un'applicazione di e-commerce.</span><span class="sxs-lookup"><span data-stu-id="b7b33-121">For example, consider an e-commerce application.</span></span> <span data-ttu-id="b7b33-122">Quando l'utente fa clic sul pulsante "Acquista", viene inviato un messaggio con i dettagli degli ordini oltre a un messaggio con i dettagli della carta di credito.</span><span class="sxs-lookup"><span data-stu-id="b7b33-122">When the user clicks the "Buy" button, a message with the order details is sent along with a message with the credit card details.</span></span> <span data-ttu-id="b7b33-123">Se il messaggio per la carta di credito non viene recapitato, l'ordine potrebbe essere spedito senza pagamento.</span><span class="sxs-lookup"><span data-stu-id="b7b33-123">If the credit card message is not delivered, the order may be dispatched without payment.</span></span>

<span data-ttu-id="b7b33-124">È possibile evitare questi tipi di problemi raggruppando i due messaggi in una transazione.</span><span class="sxs-lookup"><span data-stu-id="b7b33-124">You can avoid these kinds of problems by grouping the two messages into a transaction.</span></span> <span data-ttu-id="b7b33-125">Le transazioni devono avere esito positivo o negativo come singola unità.</span><span class="sxs-lookup"><span data-stu-id="b7b33-125">Transactions succeed or fail as a single unit.</span></span> <span data-ttu-id="b7b33-126">Se il recapito del messaggio dei dettagli della carta di credito non riesce, anche il messaggio dei dettagli dell'ordine non verrà recapitato.</span><span class="sxs-lookup"><span data-stu-id="b7b33-126">If the credit card details message delivery fails, then so will the order details message.</span></span>

## <a name="when-to-use-storage-queues"></a><span data-ttu-id="b7b33-127">Quando usare le code di archiviazione</span><span class="sxs-lookup"><span data-stu-id="b7b33-127">When to use Storage queues</span></span>

<span data-ttu-id="b7b33-128">Le code vengono usate per i messaggi, ma non per gli eventi.</span><span class="sxs-lookup"><span data-stu-id="b7b33-128">Queues are used for messages, but not events.</span></span>

<span data-ttu-id="b7b33-129">Gli account di archiviazione di Azure includono le code, che possono essere usate dalle applicazioni distribuite come semplici posizioni di archiviazione temporanea per i messaggi.</span><span class="sxs-lookup"><span data-stu-id="b7b33-129">Azure storage accounts include queues, which can be used by distributed applications as simple, temporary storage locations for messages.</span></span> <span data-ttu-id="b7b33-130">Un componente di origine può aggiungere un messaggio alla coda.</span><span class="sxs-lookup"><span data-stu-id="b7b33-130">A source component can add a message to the queue.</span></span> <span data-ttu-id="b7b33-131">I componenti di destinazione recuperano il messaggio all'inizio della coda per l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="b7b33-131">Destination components retrieve the message at the front of the queue for processing.</span></span> <span data-ttu-id="b7b33-132">Queste code migliorano l'affidabilità dello scambio di messaggi poiché, nei momenti di picco, i messaggi possono attendere semplicemente che un componente di destinazione sia pronto per elaborarli.</span><span class="sxs-lookup"><span data-stu-id="b7b33-132">Such queues increase the reliability of the message exchange because, at times of high demand, messages can simply wait until a destination component is ready to process them.</span></span>

<span data-ttu-id="b7b33-133">Le code vengono fornite anche come parte della messaggistica del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="b7b33-133">Queues are also provided as part of Service Bus messaging.</span></span> <span data-ttu-id="b7b33-134">Se si è deciso di usare una coda in Azure per una comunicazione specifica, è necessario stabilire se usare una coda di archiviazione o una coda del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="b7b33-134">If you have decided to use a queue in Azure for a specific communication, you must decide whether to use a Storage queue or a Service Bus queue.</span></span>

<span data-ttu-id="b7b33-135">Per effettuare questa scelta, considerare le domande seguenti:</span><span class="sxs-lookup"><span data-stu-id="b7b33-135">To make this choice, consider the following questions:</span></span>

- <span data-ttu-id="b7b33-136">È necessaria una garanzia di recapito At-Most-Once?</span><span class="sxs-lookup"><span data-stu-id="b7b33-136">Do you need an At-Most-Once delivery guarantee?</span></span>
- <span data-ttu-id="b7b33-137">È necessaria una garanzia FIFO?</span><span class="sxs-lookup"><span data-stu-id="b7b33-137">Do you need a FIFO guarantee?</span></span>
- <span data-ttu-id="b7b33-138">È necessario raggruppare i messaggi in transazioni?</span><span class="sxs-lookup"><span data-stu-id="b7b33-138">Do you need to group messages into transactions?</span></span>
- <span data-ttu-id="b7b33-139">È necessario archiviare messaggi di dimensioni maggiori di 64 KB?</span><span class="sxs-lookup"><span data-stu-id="b7b33-139">Do you need to store messages larger than 64 KB?</span></span>

<span data-ttu-id="b7b33-140">Se la risposta a una di queste domande è affermativa, è necessario scegliere di usare una coda del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="b7b33-140">If the answer to any of these questions is yes, you must choose to use a Service Bus queue.</span></span>

<span data-ttu-id="b7b33-141">Tenere in considerazione anche le domande seguenti:</span><span class="sxs-lookup"><span data-stu-id="b7b33-141">In addition, consider the following questions:</span></span>

- <span data-ttu-id="b7b33-142">Sono necessari log sul lato server per tutti i messaggi che passano attraverso la coda?</span><span class="sxs-lookup"><span data-stu-id="b7b33-142">Do you need server-side logs of all messages that pass through the queue?</span></span>
- <span data-ttu-id="b7b33-143">Si prevede che le dimensioni della coda possano superare gli 80 GB?</span><span class="sxs-lookup"><span data-stu-id="b7b33-143">Do you expect the queue to exceed 80 GB in size?</span></span>

<span data-ttu-id="b7b33-144">Se la risposta a una di queste domande è affermativa, è necessario scegliere di usare una coda di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="b7b33-144">If the answer to any of these questions is yes, you must choose to use a Storage queue.</span></span>

## <a name="summary"></a><span data-ttu-id="b7b33-145">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="b7b33-145">Summary</span></span>

<span data-ttu-id="b7b33-146">Una coda è una semplice posizione di archiviazione temporanea per i messaggi inviati tra i componenti di un'applicazione distribuita.</span><span class="sxs-lookup"><span data-stu-id="b7b33-146">A queue is a simple, temporary storage location for messages sent between the components of a distributed application.</span></span> <span data-ttu-id="b7b33-147">Usare una coda per organizzare i messaggi e gestire correttamente i picchi nella domanda non prevedibili.</span><span class="sxs-lookup"><span data-stu-id="b7b33-147">Use a queue to organize messages and gracefully handle unpredictable surges in demand.</span></span>

<span data-ttu-id="b7b33-148">Usare le code di archiviazione quando si vuole un sistema di accodamento semplice e facile da programmare.</span><span class="sxs-lookup"><span data-stu-id="b7b33-148">Use Storage queues when you want a simple and easy-to-code queue system.</span></span> <span data-ttu-id="b7b33-149">Per esigenze più avanzate, usare le code del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="b7b33-149">For more advanced needs, use Service Bus queues.</span></span>