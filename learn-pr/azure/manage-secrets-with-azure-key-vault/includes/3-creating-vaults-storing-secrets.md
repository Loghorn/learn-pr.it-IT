## <a name="creating-key-vaults-for-your-applications"></a><span data-ttu-id="72831-101">Creazione di insiemi di credenziali delle chiavi per le applicazioni</span><span class="sxs-lookup"><span data-stu-id="72831-101">Creating Key Vaults for your applications</span></span>

<span data-ttu-id="72831-102">È consigliabile creare un insieme di credenziali separato per ogni ambiente di distribuzione, ad esempio sviluppo, test e produzione, in ogni applicazione.</span><span class="sxs-lookup"><span data-stu-id="72831-102">Good practice is to create a separate vault for each deployment environment of each of your applications, such as development, test, and production.</span></span> <span data-ttu-id="72831-103">È possibile usare gli insiemi di credenziali per condividere segreti tra le app. Tuttavia, se un utente malintenzionato ottiene l'accesso in lettura a un insieme di credenziali, l'impatto è proporzionale al numero di segreti nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="72831-103">It's possible to use vaults to share secrets across multiple apps, but the impact of an attacker gaining read access to a vault increases with the number of secrets in the vault.</span></span>

> [!TIP]
> <span data-ttu-id="72831-104">Se si usano gli stessi nomi per i segreti nei diversi ambienti di un'applicazione, l'unica configurazione specifica dell'ambiente da modificare nell'app è l'URL dell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="72831-104">If you use the same names for secrets across different environments for an application, the only environment-specific configuration that has to change in your app is the vault URL.</span></span>

<span data-ttu-id="72831-105">Per creare un insieme di credenziali non è necessaria alcuna configurazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="72831-105">Creating a vault requires no initial configuration.</span></span> <span data-ttu-id="72831-106">All'identità utente viene automaticamente concesso il set completo di autorizzazioni per la gestione dei segreti e si può iniziare ad aggiungere segreti immediatamente.</span><span class="sxs-lookup"><span data-stu-id="72831-106">Your user identity is automatically granted the full set of secret management permissions and you can start adding secrets immediately.</span></span> <span data-ttu-id="72831-107">Quando si ha un insieme di credenziali, l'aggiunta e la gestione dei segreti possono essere eseguite da qualsiasi interfaccia amministrativa di Azure, come il portale di Azure, l'interfaccia della riga di comando di Azure e Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="72831-107">Once you have a vault, adding and managing secrets can be done from any Azure administrative interface, including the Azure portal, the Azure CLI, and Azure PowerShell.</span></span> <span data-ttu-id="72831-108">Quando si configura l'applicazione per l'uso dell'insieme di credenziali, è necessario assegnare le autorizzazioni corrette. Questo verrà illustrato nell'unità successiva.</span><span class="sxs-lookup"><span data-stu-id="72831-108">When you set up your application to use the vault, you'll need to assign the correct permissions to it; we'll see that in the next unit.</span></span>

## <a name="vault-authentication-and-permissions"></a><span data-ttu-id="72831-109">Autenticazione e autorizzazioni per gli insiemi di credenziali</span><span class="sxs-lookup"><span data-stu-id="72831-109">Vault authentication and permissions</span></span>

<span data-ttu-id="72831-110">Per l'autenticazione degli utenti e delle applicazioni, l'API di Azure Key Vault usa Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="72831-110">Azure Key Vault's API uses Azure Active Directory to authenticate users and applications.</span></span> <span data-ttu-id="72831-111">I criteri di accesso agli insiemi di credenziali sono basati su *azioni* e vengono applicati in un intero insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="72831-111">Vault access policies are based on *actions*, and are applied across an entire vault.</span></span> <span data-ttu-id="72831-112">Ad esempio, un'applicazione con autorizzazioni **Get** (per leggere i valori dei segreti), **List** (per elencare i nomi di tutti i segreti) e **Set** (per creare o aggiornare i valori dei segreti) per un insieme di credenziali può creare segreti, elencare i nomi di tutti i segreti e recuperarne e impostarne i valori in tale insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="72831-112">For example, an application with **Get** (read secret values), **List** (list names of all secrets), and **Set** (create or update secret values) permissions to a vault is able to create secrets, list all secret names, and get and set all secret values in that vault.</span></span>

<span data-ttu-id="72831-113">Per *tutte* le azioni eseguite su un insieme di credenziali sono necessarie l'autenticazione e l'autorizzazione. Non è possibile concedere alcun tipo di accesso anonimo.</span><span class="sxs-lookup"><span data-stu-id="72831-113">*All* actions performed on a vault require authentication and authorization &mdash; there is no way to grant any kind of anonymous access.</span></span>

> [!TIP]
> <span data-ttu-id="72831-114">Quando si concede l'accesso all'insieme di credenziali a sviluppatori e app, concedere solo il set di autorizzazioni minimo necessario.</span><span class="sxs-lookup"><span data-stu-id="72831-114">When granting vault access to developers and apps, grant only the minimum set of permissions needed.</span></span> <span data-ttu-id="72831-115">Le limitazioni delle autorizzazioni consentono di evitare gli incidenti causati da bug nel codice e di ridurre l'impatto del furto di credenziali o dell'inserimento di codice dannoso nell'app.</span><span class="sxs-lookup"><span data-stu-id="72831-115">Permissions restrictions help avoid accidents caused by code bugs and reduce the impact of stolen credentials or malicious code injected into your app.</span></span>

<span data-ttu-id="72831-116">Per un insieme di credenziali dell'ambiente di sviluppo, per gli sviluppatori sono in genere sufficienti le autorizzazioni **Get** e **List**.</span><span class="sxs-lookup"><span data-stu-id="72831-116">Developers will usually only need **Get** and **List** permissions to a development-environment vault.</span></span> <span data-ttu-id="72831-117">Un responsabile o uno sviluppatore senior dovrà avere autorizzazioni complete per l'insieme di credenziali per modificare e aggiungere i segreti quando necessario.</span><span class="sxs-lookup"><span data-stu-id="72831-117">A lead or senior developer will need full permissions to the vault to change and add secrets when necessary.</span></span> <span data-ttu-id="72831-118">Le autorizzazioni complete per gli insiemi di credenziali dell'ambiente di produzione sono in genere riservate al personale operativo senior.</span><span class="sxs-lookup"><span data-stu-id="72831-118">Full permissions to production-environment vaults are typically reserved for senior operations staff.</span></span>

<span data-ttu-id="72831-119">Per le app sono in genere sufficienti autorizzazioni **Get**.</span><span class="sxs-lookup"><span data-stu-id="72831-119">For apps, typically only **Get** permissions are required.</span></span> <span data-ttu-id="72831-120">A seconda delle modalità di implementazioni delle app, per alcune potrebbero essere necessarie autorizzazioni **List**.</span><span class="sxs-lookup"><span data-stu-id="72831-120">Some apps may require **List** depending on the way the app is implemented.</span></span> <span data-ttu-id="72831-121">A causa della tecnica usata per leggere i segreti dall'insieme di credenziali, l'app che verrà implementata nell'esercizio di questo modulo richiede l'autorizzazione **List**.</span><span class="sxs-lookup"><span data-stu-id="72831-121">The app we'll implement in this module's exercise requires the **List** permission because of the technique it uses to read secrets from the vault.</span></span>

<span data-ttu-id="72831-122">A causa di tutti i problemi verificatisi in azienda con i segreti delle applicazioni, i dirigenti hanno chiesto di creare una piccola app di base per indicare agli altri sviluppatori il percorso corretto.</span><span class="sxs-lookup"><span data-stu-id="72831-122">Given all the trouble the company's been having with application secrets, management has asked you to create a small starter app to set the other developers on the right path.</span></span> <span data-ttu-id="72831-123">L'app deve illustrare le procedure consigliate per gestire i segreti nel modo più semplice e sicuro possibile.</span><span class="sxs-lookup"><span data-stu-id="72831-123">The app needs to demonstrate best practices for managing secrets as simply and securely as possible.</span></span>

## <a name="create-the-vault-and-store-the-secret-in-it"></a><span data-ttu-id="72831-124">Creare l'insieme di credenziali e archiviare il segreto</span><span class="sxs-lookup"><span data-stu-id="72831-124">Create the vault and store the secret in it</span></span>
<span data-ttu-id="72831-125">Per iniziare, si creerà un insieme di credenziali e si archivierà un segreto.</span><span class="sxs-lookup"><span data-stu-id="72831-125">To start, you'll create a vault and store one secret.</span></span>

###  <a name="create-the-vault"></a><span data-ttu-id="72831-126">Creare l'insieme di credenziali</span><span class="sxs-lookup"><span data-stu-id="72831-126">Create the vault</span></span>

<span data-ttu-id="72831-127">Si creerà per prima cosa l'insieme di credenziali e vi si archivierà un segreto.</span><span class="sxs-lookup"><span data-stu-id="72831-127">First, we'll create the vault and store our secret in it.</span></span>

[!include[](../../../includes/azure-sandbox-activate.md)]

<span data-ttu-id="72831-128">**I nomi degli insiemi di credenziali delle chiavi devono essere univoci a livello globale. Sarà quindi necessario scegliere un nome univoco**.</span><span class="sxs-lookup"><span data-stu-id="72831-128">**Key Vault names must be globally unique, so you'll need to pick a unique name**.</span></span> <span data-ttu-id="72831-129">I nomi degli insiemi di credenziali devono avere una lunghezza compresa tra 3 e 24 caratteri e contenere solo caratteri alfanumerici e trattini.</span><span class="sxs-lookup"><span data-stu-id="72831-129">Vault names must be 3-24 characters long and contain only alphanumeric characters and dashes.</span></span> <span data-ttu-id="72831-130">Prendere nota del nome dell'insieme di credenziali scelto perché verrà usato in questo esercizio.</span><span class="sxs-lookup"><span data-stu-id="72831-130">Make a note of the vault name you choose, as you'll need it throughout this exercise.</span></span>

[!include[](../../../includes/azure-sandbox-regions-first-mention-note.md)]

<span data-ttu-id="72831-131">In Cloud Shell eseguire questo comando per creare l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="72831-131">Run the following command in the Cloud Shell to create your vault.</span></span> <span data-ttu-id="72831-132">È possibile sostituire il valore `--location` se si vuole inserirlo in una posizione diversa dalle selezioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="72831-132">You can replace the `--location` value if you want to put it into a different location from the above selections.</span></span>

```azurecli
az keyvault create \
    --name <your-unique-vault-name> \
    --resource-group <rgn>[Sandbox resource group name]</rgn> \
    --location eastus
```

<span data-ttu-id="72831-133">Al termine verrà visualizzato l'output JSON che descrive il nuovo insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="72831-133">When it finishes, you'll see JSON output describing the new vault.</span></span>

> [!TIP]
> <span data-ttu-id="72831-134">Comando usato per il gruppo di risorse precedentemente creato denominato **<rgn>[Gruppo di risorse sandbox]</rgn>**.</span><span class="sxs-lookup"><span data-stu-id="72831-134">The command used the pre-created resource group named **<rgn>[Sandbox Resource Group]</rgn>**.</span></span> <span data-ttu-id="72831-135">Quando si lavora con la propria sottoscrizione, si potrebbe voler creare un nuovo gruppo di risorse o usarne uno esistente creato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="72831-135">When working with your own subscription, you would want to either create a new Resource Group, or use an existing one you have previously created.</span></span>

### <a name="add-the-secret"></a><span data-ttu-id="72831-136">Aggiungere il segreto</span><span class="sxs-lookup"><span data-stu-id="72831-136">Add the secret</span></span>

<span data-ttu-id="72831-137">Aggiungere quindi un segreto denominato **SecretPassword** con il valore **reindeer_flotilla**.</span><span class="sxs-lookup"><span data-stu-id="72831-137">Now add the secret: our secret will be named **SecretPassword** with a value of **reindeer_flotilla**.</span></span>

```azurecli
az keyvault secret set \
    --name SecretPassword \
    --value reindeer_flotilla \
    --vault-name <your-unique-vault-name>
```

<span data-ttu-id="72831-138">A breve si scriverà il codice per l'applicazione, ma è prima necessario apprendere come l'app eseguirà l'autenticazione a un insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="72831-138">We'll write the code for our application shortly, but first we need to learn a little bit about how our app is going to authenticate to a vault.</span></span>